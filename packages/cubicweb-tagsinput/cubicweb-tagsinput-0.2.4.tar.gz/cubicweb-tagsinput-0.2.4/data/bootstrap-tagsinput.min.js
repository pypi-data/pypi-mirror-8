(function(e){"use strict";function n(t,n){this.itemsArray=[],this.$element=e(t),this.$element.hide(),this.isSelect=t.tagName==="SELECT",this.multiple=this.isSelect&&t.hasAttribute("multiple"),this.objectItems=n&&n.itemValue,this.placeholderText=t.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=e('<div class="bootstrap-tagsinput"></div>'),this.$input=e('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container),this.build(n)}function r(e,t){if(typeof e[t]!="function"){var n=e[t];e[t]=function(e){return e[n]}}}function i(e,t){if(typeof e[t]!="function"){var n=e[t];e[t]=function(){return n}}}function o(e){return e?s.text(e).html():""}function u(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else if(e.selectionStart||e.selectionStart=="0")t=e.selectionStart;return t}var t={tagClass:function(e){return"label label-info"},itemValue:function(e){return e?e.toString():e},itemText:function(e){return this.itemValue(e)},itemHtml:function(e){return o(this.itemText(e))},freeInput:!0,maxTags:undefined,confirmKeys:[13],onTagExists:function(e,t){t.hide().fadeIn()}};n.prototype={constructor:n,add:function(t,n){var r=this;if(r.options.maxTags&&r.itemsArray.length>=r.options.maxTags)return;if(t!==!1&&!t)return;if(typeof t=="object"&&!r.objectItems)throw"Can't add objects when itemValue option is not set";if(t.toString().match(/^\s*$/))return;r.isSelect&&!r.multiple&&r.itemsArray.length>0&&r.remove(r.itemsArray[0]);if(typeof t=="string"&&this.$element[0].tagName==="INPUT"){var i=t.split(",");if(i.length>1){for(var s=0;s<i.length;s++)this.add(i[s],!0);n||r.pushVal();return}}var u=r.options.itemValue(t),a=r.options.itemText(t),f=r.options.itemHtml(t),l=r.options.tagClass(t),c=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)===u})[0];if(c){if(r.options.onTagExists){var h=e(".tag",r.$container).filter(function(){return e(this).data("item")===c});r.options.onTagExists(t,h)}return}r.itemsArray.push(t);var p=e('<span class="tag '+o(l)+'">'+f+'<span data-role="remove"></span></span>');p.data("item",t),r.findInputWrapper().before(p),p.after(" ");if(r.isSelect&&!e('option[value="'+escape(u)+'"]',r.$element)[0]){var d=e("<option selected>"+f+"</option>");d.data("item",t),d.attr("value",u),r.$element.append(d)}n||r.pushVal(),r.options.maxTags===r.itemsArray.length&&r.$container.addClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemAdded",{item:t}))},remove:function(t,n){var r=this;r.objectItems&&(typeof t=="object"?t=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)==r.options.itemValue(t)})[0]:t=e.grep(r.itemsArray,function(e){return r.options.itemValue(e)==t})[0]),t&&(e(".tag",r.$container).filter(function(){return e(this).data("item")===t}).remove(),e("option",r.$element).filter(function(){return e(this).data("item")===t}).remove(),r.itemsArray.splice(e.inArray(t,r.itemsArray),1)),n||r.pushVal(),r.options.maxTags>r.itemsArray.length&&r.$container.removeClass("bootstrap-tagsinput-max"),r.$element.trigger(e.Event("itemRemoved",{item:t}))},setOptions:function(t){var n=this;e.extend(n.options,t)},getOptions:function(){var e=this;return e.options},removeAll:function(){var t=this;e(".tag",t.$container).remove(),e("option",t.$element).remove();while(t.itemsArray.length>0)t.itemsArray.pop();t.pushVal(),t.$container.removeClass("bootstrap-tagsinput-max")},refresh:function(){var t=this;e(".tag",t.$container).each(function(){var n=e(this),r=n.data("item"),i=t.options.itemValue(r),s=t.options.itemText(r),u=t.options.itemHtml(r),a=t.options.tagClass(r);n.attr("class",null),n.addClass("tag "+o(a)),n.contents().filter(function(){return this.nodeType==3})[0].nodeValue=u;if(t.isSelect){var f=e("option",t.$element).filter(function(){return e(this).data("item")===r});f.attr("value",i)}})},items:function(){return this.itemsArray},pushVal:function(){var t=this,n=e.map(t.items(),function(e){return t.options.itemValue(e).toString()});t.$element.val(n,!0).trigger("change")},build:function(n){var s=this;s.options=e.extend({},t,n);var o=s.options.typeahead||{};s.objectItems&&(s.options.freeInput=!1),r(s.options,"itemValue"),r(s.options,"itemText"),r(s.options,"itemHtml"),r(s.options,"tagClass"),s.options.source&&(o.source=s.options.source),o.source&&e.fn.typeahead&&(i(o,"source"),s.$input.typeahead({source:function(t,n){function r(e){var t=[];for(var r=0;r<e.length;r++){var o=s.options.itemText(e[r]);i[o]=e[r],t.push(o)}n(t)}this.map={};var i=this.map,u=o.source(t);e.isFunction(u.success)?u.success(r):e.when(u).then(r)},updater:function(e){s.add(this.map[e])},matcher:function(e){return e.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1},sorter:function(e){return e.sort()},highlighter:function(e){var t=new RegExp("("+this.query+")","gi");return e.replace(t,"<strong>$1</strong>")}})),s.$container.on("click",e.proxy(function(e){s.$input.focus()},s)),s.$container.on("keydown","input",e.proxy(function(t){var n=e(t.target),r=s.findInputWrapper();switch(t.which){case 8:if(u(n[0])===0){var i=r.prev();i&&s.remove(i.data("item"))}break;case 46:if(u(n[0])===0){var o=r.next();o&&s.remove(o.data("item"))}break;case 37:var a=r.prev();n.val().length===0&&a[0]&&(a.before(r),n.focus());break;case 39:var f=r.next();n.val().length===0&&f[0]&&(f.after(r),n.focus());break;default:s.options.freeInput&&e.inArray(t.which,s.options.confirmKeys)>=0&&(s.add(n.val()),n.val(""),t.preventDefault())}n.attr("size",Math.max(this.inputSize,n.val().length))},s)),s.$container.on("click","[data-role=remove]",e.proxy(function(t){s.remove(e(t.target).closest(".tag").data("item"))},s)),s.options.itemValue===t.itemValue&&(s.$element[0].tagName==="INPUT"?s.add(s.$element.val()):e("option",s.$element).each(function(){s.add(e(this).attr("value"),!0)}))},destroy:function(){var e=this;e.$container.off("keypress","input"),e.$container.off("click","[role=remove]"),e.$container.remove(),e.$element.removeData("tagsinput"),e.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var t=this.$input[0],n=this.$container[0];while(t&&t.parentNode!==n)t=t.parentNode;return e(t)}},e.fn.tagsinput=function(t,r){var i=[];return this.each(function(){var s=e(this).data("tagsinput");if(!s)s=new n(this,t),e(this).data("tagsinput",s),i.push(s),this.tagName==="SELECT"&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val());else{var o=s[t](r);o!==undefined&&i.push(o)}}),typeof t=="string"?i.length>1?i:i[0]:i},e.fn.tagsinput.Constructor=n;var s=e("<div />");e(function(){e("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);