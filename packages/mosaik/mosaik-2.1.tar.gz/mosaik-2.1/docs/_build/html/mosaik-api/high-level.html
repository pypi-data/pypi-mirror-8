

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The high-level API &mdash; mosaik 2.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'2.0',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="mosaik 2.0 documentation" href="../index.html"/>
        <link rel="up" title="The mosaik API" href="index.html"/>
        <link rel="next" title="Scenario definition" href="../scenario-definition.html"/>
        <link rel="prev" title="The low-level API" href="low-level.html"/> 

  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> mosaik</a>
        <form class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#linux">Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#os-x">OS X</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#windows">Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#what-s-mosaik-supposed-to-do">What&#8217;s mosaik supposed to do?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../overview.html#mosaik-s-main-components">Mosaik&#8217;s main components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ecosystem.html">The mosaik ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/examplesim.html">Integrating a simulation model into the mosaik ecosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/demo1.html">Creating and running simple simulation scenarios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/examplectrl.html">Adding a control mechanism to a scenario</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/demo2.html">Integrating a control mechanism</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">The mosaik API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">How mosaik communicates with a simulator</a></li>
<li class="toctree-l2"><a class="reference internal" href="low-level.html">The low-level API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">The high-level API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scenario-definition.html">Scenario definition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#the-setup">The setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#starting-simulators">Starting simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#instantiating-simulation-models">Instantiating simulation models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#connecting-entities">Connecting entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#running-the-simulation">Running the simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-achieve-bi-directional-data-flows">How to achieve bi-directional data-flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-filter-entity-sets">How to filter entity sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-create-user-defined-connection-rules">How to create user-defined connection rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-retrieve-static-data-from-entities">How to retrieve static data from entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-access-topology-and-data-flow-information">How to access topology and data-flow information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-destroy-a-world">How to destroy a world</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-to-real-time-simulations">How to to real-time simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scenario-definition.html#how-to-call-extra-methods-of-a-simulator">How to call extra methods of a simulator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../simmanager.html">The simulator manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler.html">Scheduling and simulation execution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html#anatomy-of-a-step">Anatomy of a step</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html#synchronization-and-data-flows">Synchronization and data-flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html#cyclic-data-flows">Cyclic data-flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html#stepping-and-simulation-duration">Stepping and simulation duration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#general-questions">General questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#coupling-models-with-mosaik">Coupling models with mosaik</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq.html#the-mosaik-demo">The mosaik demo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Developer&#8217;s Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/setup.html">Development setup and tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/release_process.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/requirements.html">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/design-decisions.html">Discussion of design decisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/logo-ci.html">Logo and corporate identity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/mosaik.html"><tt class="docutils literal"><span class="pre">mosaik</span></tt> &#8212; The ende-user API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/mosaik.exceptions.html"><tt class="docutils literal"><span class="pre">mosaik.exceptions</span></tt> &#8212; mosaik specific error types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/mosaik.scenario.html"><tt class="docutils literal"><span class="pre">mosaik.scenario</span></tt> &#8212; Classes related to the scenario creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/mosaik.scheduler.html"><tt class="docutils literal"><span class="pre">mosaik.scheduler</span></tt> &#8212; Coordinate and execute simulators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/mosaik.simmanager.html"><tt class="docutils literal"><span class="pre">mosaik.simmanager</span></tt> &#8212; Management of external processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/mosaik.util.html"><tt class="docutils literal"><span class="pre">mosaik.util</span></tt> &#8212; Utility classes and functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About mosaik</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/history.html">The history of mosaik</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">mosaik</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../index.html">Docs</a> &raquo;</li>
  <li><a href="">The high-level API</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="the-high-level-api">
<span id="high-level-api"></span><h1>The high-level API<a class="headerlink" href="#the-high-level-api" title="Permalink to this headline">¶</a></h1>
<p>Currently, there is only a high-level API for Python. Once there are
implementations for other languages available, this document will be updated.</p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The Python implementation of the mosaik API is available as a separate package
an can easily be installed via <a class="reference external" href="https://pip.pypa.io">pip</a>:</p>
<div class="highlight-bash"><div class="highlight"><pre>pip install mosaik-api
</pre></div>
</div>
<p>It supports Python 2.7, &gt;= 3.3 and PyPy.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>You create a subclass of <a class="reference internal" href="#mosaik_api.Simulator" title="mosaik_api.Simulator"><tt class="xref py py-class docutils literal"><span class="pre">mosaik_api.Simulator</span></tt></a> which implements the
four API calls <a class="reference internal" href="#mosaik_api.Simulator.init" title="mosaik_api.Simulator.init"><tt class="xref py py-meth docutils literal"><span class="pre">init()</span></tt></a>,
<a class="reference internal" href="#mosaik_api.Simulator.create" title="mosaik_api.Simulator.create"><tt class="xref py py-meth docutils literal"><span class="pre">create()</span></tt></a>, <a class="reference internal" href="#mosaik_api.Simulator.step" title="mosaik_api.Simulator.step"><tt class="xref py py-meth docutils literal"><span class="pre">step()</span></tt></a>
and <a class="reference internal" href="#mosaik_api.Simulator.get_data" title="mosaik_api.Simulator.get_data"><tt class="xref py py-meth docutils literal"><span class="pre">get_data()</span></tt></a>. You can optionally override
<a class="reference internal" href="#mosaik_api.Simulator.configure" title="mosaik_api.Simulator.configure"><tt class="xref py py-meth docutils literal"><span class="pre">configure()</span></tt></a> and
<a class="reference internal" href="#mosaik_api.Simulator.finalize" title="mosaik_api.Simulator.finalize"><tt class="xref py py-meth docutils literal"><span class="pre">finalize()</span></tt></a>. The former allows you to handle
additional command line arguments that your simulator may need. The latter is
called just before the simulator terminates and allows you to perform some
clean-up.</p>
<p>You then call <a class="reference internal" href="#mosaik_api.start_simulation" title="mosaik_api.start_simulation"><tt class="xref py py-func docutils literal"><span class="pre">mosaik_api.start_simulation()</span></tt></a> from your <cite>main()</cite> function
to get everything set-up and running. That function handles the networking as
well as serialization and de-serialization of messages. Commands from the
low-level API are translated to simple function calls. The return value of
these functions is used for the reply.</p>
<p>For example, the message</p>
<div class="highlight-json"><div class="highlight"><pre><span class="p">[</span><span class="s2">&quot;create&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="p">{</span><span class="nt">&quot;param1&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="nt">&quot;param2&quot;</span><span class="p">:</span> <span class="s2">&quot;spam&quot;</span><span class="p">}]</span>
</pre></div>
</div>
<p>will result in a call</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;Model&#39;</span><span class="p">,</span> <span class="n">param1</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">param2</span><span class="o">=</span><span class="s">&#39;spam&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="module-mosaik_api">
<span id="api-calls"></span><h3>API calls<a class="headerlink" href="#module-mosaik_api" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="mosaik_api.Simulator">
<em class="property">class </em><tt class="descclassname">mosaik_api.</tt><tt class="descname">Simulator</tt><big>(</big><em>meta</em><big>)</big><a class="headerlink" href="#mosaik_api.Simulator" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class that you need to inherit from and implement the
API calls.</p>
<dl class="attribute">
<dt id="mosaik_api.Simulator.meta">
<tt class="descname">meta</tt><a class="headerlink" href="#mosaik_api.Simulator.meta" title="Permalink to this definition">¶</a></dt>
<dd><p>Meta data describing the simulator (the same that is returned by
<a class="reference internal" href="#mosaik_api.Simulator.init" title="mosaik_api.Simulator.init"><tt class="xref py py-meth docutils literal"><span class="pre">init()</span></tt></a>).</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &quot;api_version&quot;: &quot;x.y.z&quot;,
    &quot;models&quot;: {
        &quot;ModelName&quot;: {
            &quot;public&quot;: true|false,
            &quot;params&quot;: [&quot;param_1&quot;, ...],
            &quot;attrs&quot;: [&quot;attr_1&quot;, ...],
        },
        ...
    },
    &quot;extra_methods&quot;: [
        &quot;do_cool_stuff&quot;,
        &quot;set_static_data&quot;
    ]
}
</pre></div>
</div>
<p>The <em>api_version</em> is a string that defines which version of the mosaik API
the simulator implements. The simulator&#8217;s <a class="reference external" href="http://semver.org/">major versions</a> (&#8220;x&#8221;, in the snippet above) has to be the same as
mosaik&#8217;s. Mosaik will cancel the simulation if a version mismatch occurs.</p>
<p><em>models</em> is a dictionary describing the models provided by this simulator.
The entry <em>public</em> determines whether a model can be instantiated by a user
(<tt class="docutils literal"><span class="pre">True</span></tt>) or if it is a sub-model that cannot be created directly
(<tt class="docutils literal"><span class="pre">False</span></tt>). <em>params</em> is a list of parameter names that can be passed to
the model when creating it. <em>attrs</em> is a list of attribute names that can
be accessed (reading or writing).</p>
<p><em>extra_methods</em> is an optional list of methods that a simulator provides in
addition to the standard API calls (<tt class="docutils literal"><span class="pre">init()</span></tt>, <tt class="docutils literal"><span class="pre">create()</span></tt> and so on).
These methods can be called while the scenario is being created and can be
used for operations that don&#8217;t really belong into <tt class="docutils literal"><span class="pre">init()</span></tt> or
<tt class="docutils literal"><span class="pre">create()</span></tt>.</p>
</dd></dl>

<dl class="attribute">
<dt id="mosaik_api.Simulator.mosaik">
<tt class="descname">mosaik</tt><a class="headerlink" href="#mosaik_api.Simulator.mosaik" title="Permalink to this definition">¶</a></dt>
<dd><p>An RPC proxy to mosaik.</p>
</dd></dl>

<dl class="method">
<dt id="mosaik_api.Simulator.init">
<tt class="descname">init</tt><big>(</big><em>sid</em>, <em>**sim_params</em><big>)</big><a class="headerlink" href="#mosaik_api.Simulator.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the simulator with the ID <em>sid</em> and apply additional
parameters <em>(sim_params)</em> sent by mosaik. Return the meta data
<a class="reference internal" href="#mosaik_api.Simulator.meta" title="mosaik_api.Simulator.meta"><tt class="xref py py-attr docutils literal"><span class="pre">meta</span></tt></a>.</p>
<p>If your simulator has no <em>sim_params</em>, you don&#8217;t need to override this
method.</p>
</dd></dl>

<dl class="method">
<dt id="mosaik_api.Simulator.create">
<tt class="descname">create</tt><big>(</big><em>num</em>, <em>model</em>, <em>**model_params</em><big>)</big><a class="headerlink" href="#mosaik_api.Simulator.create" title="Permalink to this definition">¶</a></dt>
<dd><p>Create <em>num</em> instances of <em>model</em> using the provided <em>model_params</em>.</p>
<p><em>num</em> is an integer for the number of model instances to create.</p>
<p><em>model</em> needs to be a public entry in the simulator&#8217;s
<tt class="docutils literal"><span class="pre">meta['models']</span></tt>.</p>
<p><em>model_params</em> is a dictionary mapping parameters (from
<tt class="docutils literal"><span class="pre">meta['models'][model]['params']</span></tt>) to their values.</p>
<p>Return a (nested) list of dictionaries describing the created model
instances (entities). The root list must contain exactly <em>num</em>
elements. The number of objects in sub-lists is not constrained:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&#39;eid&#39;</span><span class="p">:</span> <span class="s">&#39;eid_1&#39;</span><span class="p">,</span>
        <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;model_name&#39;</span><span class="p">,</span>
        <span class="s">&#39;rel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;eid_2&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="s">&#39;children&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s">&#39;eid&#39;</span><span class="p">:</span> <span class="s">&#39;child_1&#39;</span><span class="p">,</span> <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;child&#39;</span><span class="p">},</span>
            <span class="o">...</span>
        <span class="p">],</span>
    <span class="p">},</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The entity ID (<em>eid</em>) of an object must be unique within a simulator
instance. For entities in the root list, <em>type</em> must be the same as the
<em>model</em> parameter. The type for objects in sub-lists may be anything
that can be found in <tt class="docutils literal"><span class="pre">meta['models']</span></tt>. <em>rel</em> is an optional list of
related entities; &#8220;related&#8221; means that two entities are somehow connect
within the simulator, either logically or via a real data-flow (e.g.,
grid nodes are related to their adjacent branches). The <em>children</em>
entry is optional and may contain a sub-list of entities.</p>
</dd></dl>

<dl class="method">
<dt id="mosaik_api.Simulator.step">
<tt class="descname">step</tt><big>(</big><em>time</em>, <em>inputs</em><big>)</big><a class="headerlink" href="#mosaik_api.Simulator.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform the next simulation step from time <em>time</em> using input values
from <em>inputs</em> and return the new simulation time (the time at which
<tt class="docutils literal"><span class="pre">step()</span></tt> should be called again).</p>
<p><em>time</em> and the time retuned are integers. Their unit is <em>seconds</em> (from
simulation start).</p>
<p><em>inputs</em> is a dict of dicts mapping entity IDs to attributes and
dicts of values (each simulator has do decide on its own how to reduce
the values (e.g., as its sum, average or maximum):</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &#39;dest_eid&#39;: {
        &#39;attr&#39;: {&#39;src_fullid&#39;: val, ...},
        ...
    },
    ...
}
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="mosaik_api.Simulator.get_data">
<tt class="descname">get_data</tt><big>(</big><em>outputs</em><big>)</big><a class="headerlink" href="#mosaik_api.Simulator.get_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the data for the requested attributes in <em>outputs</em></p>
<p><em>outputs</em> is a dict mapping entity IDs to lists of attribute names
whose values are requested:</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &#39;eid_1&#39;: [&#39;attr_1&#39;, &#39;attr_2&#39;, ...],
    ...
}
</pre></div>
</div>
<p>The return value needs to be a dict of dicts mapping entity IDs and
attribute names to their values:</p>
<div class="highlight-python"><div class="highlight"><pre>{
    &#39;eid_1: {
        &#39;attr_1&#39;: &#39;val_1&#39;,
        &#39;attr_2&#39;: &#39;val_2&#39;,
        ...
    },
    ...
}
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="mosaik_api.Simulator.configure">
<tt class="descname">configure</tt><big>(</big><em>args</em>, <em>backend</em>, <em>env</em><big>)</big><a class="headerlink" href="#mosaik_api.Simulator.configure" title="Permalink to this definition">¶</a></dt>
<dd><p>This method can be overridden to configure the simulation with the
command line <em>args</em> as created by <a class="reference external" href="http://docopt.org/">docopt</a>.</p>
<p><em>backend</em> and <em>env</em> are the <em>simpy.io</em> backend and environment used
for networking. You can use them to start extra processes (e.g., a
web server).</p>
<p>The default implementation simply ignores them.</p>
</dd></dl>

<dl class="method">
<dt id="mosaik_api.Simulator.finalize">
<tt class="descname">finalize</tt><big>(</big><big>)</big><a class="headerlink" href="#mosaik_api.Simulator.finalize" title="Permalink to this definition">¶</a></dt>
<dd><p>This method can be overridden to do some clean-up operations after
the simulation finished (e.g., shutting down external processes).</p>
</dd></dl>

</dd></dl>

<p>The <em>mosaik-api</em> package provides an <a class="reference external" href="https://bitbucket.org/mosaik/mosaik-api-python/src/tip/example_sim/mosaik.py">example simulator</a>
that demonstrates how the API can be implemented.</p>
</div>
<div class="section" id="asynchronous-requests">
<h3>Asynchronous requests<a class="headerlink" href="#asynchronous-requests" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="low-level.html#asynchronous-requests"><em>asynchronous requests</em></a> can be called via the
<tt class="docutils literal"><span class="pre">MosaikRemote</span></tt> proxy <tt class="docutils literal"><span class="pre">self.mosaik</span></tt> from within
<a class="reference internal" href="#mosaik_api.Simulator.step" title="mosaik_api.Simulator.step"><tt class="xref py py-meth docutils literal"><span class="pre">step()</span></tt></a>. They don&#8217;t return the actual results but
an <em>event</em> (similar to a <em>future</em> of <em>deferred</em>). The event will eventually
hold the actual result. To wait for that result to arrive, you simply yield
the event, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">progress</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">mosaik</span><span class="o">.</span><span class="n">get_progress</span><span class="p">()</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<dl class="method">
<dt>
<tt class="descclassname">MosaikRemote.</tt><tt class="descname">get_progress</tt><big>(</big><big>)</big></dt>
<dd><p>Return the current simulation progress from
<a class="reference internal" href="../api_reference/mosaik.scenario.html#mosaik.scenario.World.sim_progress" title="mosaik.scenario.World.sim_progress"><tt class="xref py py-attr docutils literal"><span class="pre">sim_progress</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">MosaikRemote.</tt><tt class="descname">get_related_entities</tt><big>(</big><em>entities=None</em><big>)</big></dt>
<dd><p>Return information about the related entities of <em>entities</em>.</p>
<p>If <em>entitites</em> omitted (or <tt class="docutils literal"><span class="pre">None</span></tt>), return the complete entity
graph, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;sid_0.eid_0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">},</span>
        <span class="s">&#39;sid_0.eid_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">},</span>
        <span class="s">&#39;sid_1.eid_0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;C&#39;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;edges&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s">&#39;sid_0.eid_0&#39;</span><span class="p">,</span> <span class="s">&#39;sid_1.eid0&#39;</span><span class="p">,</span> <span class="p">{}],</span>
        <span class="p">[</span><span class="s">&#39;sid_0.eid_1&#39;</span><span class="p">,</span> <span class="s">&#39;sid_1.eid0&#39;</span><span class="p">,</span> <span class="p">{}],</span>
    <span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <em>entities</em> is a single string (e.g., <tt class="docutils literal"><span class="pre">sid_1.eid_0</span></tt>), return a dict
containing all entities related to that entity:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&#39;sid_0.eid_0&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;A&#39;</span><span class="p">},</span>
    <span class="s">&#39;sid_0.eid_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <em>entities</em> is a list of entity IDs (e.g., <tt class="docutils literal"><span class="pre">['sid_0.eid_0',</span>
<span class="pre">'sid_0.eid_1']</span></tt>), return a dict mapping each entity to a dict of
related entities:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s">&#39;sid_0.eid_0&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;sid_0.eid_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;sid_0.eid_1&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;sid_0.eid_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;B&#39;</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">MosaikRemote.</tt><tt class="descname">get_data</tt><big>(</big><em>attrs</em><big>)</big></dt>
<dd><p>Return the data for the requested attributes <em>attrs</em>.</p>
<p><em>attrs</em> is a dict of (fully qualified) entity IDs mapping to lists
of attribute names (<tt class="docutils literal"><span class="pre">{'sid/eid':</span> <span class="pre">['attr1',</span> <span class="pre">'attr2']}</span></tt>).</p>
<p>The return value is a dict mapping the input entity IDs to data
dictionaries mapping attribute names to there respective values
(<tt class="docutils literal"><span class="pre">{'sid/eid':</span> <span class="pre">{'attr1':</span> <span class="pre">val1,</span> <span class="pre">'attr2':</span> <span class="pre">val2}}</span></tt>).</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descclassname">MosaikRemote.</tt><tt class="descname">set_data</tt><big>(</big><em>data</em><big>)</big></dt>
<dd><p>Set <em>data</em> as input data for all affected simulators.</p>
<p><em>data</em> is a dictionary mapping source entity IDs to destination entity
IDs with dictionaries of attributes and values (<tt class="docutils literal"><span class="pre">{'src_full_id':</span>
<span class="pre">{'dest_full_id':</span> <span class="pre">{'attr1':</span> <span class="pre">'val1',</span> <span class="pre">'attr2':</span> <span class="pre">'val2'}}}</span></tt>).</p>
</dd></dl>

<p>The <em>mosaik-api</em> package provides an <a class="reference external" href="https://bitbucket.org/mosaik/mosaik-api-python/src/tip/example_mas/mosaik.py">example “multi-agent system”</a>
that demonstrates how to perform asynchronous requests can be implemented.</p>
</div>
<div class="section" id="starting-the-simulator">
<h3>Starting the simulator<a class="headerlink" href="#starting-the-simulator" title="Permalink to this headline">¶</a></h3>
<p>To start your simulator, you just need to create an instance of your
<a class="reference internal" href="#mosaik_api.Simulator" title="mosaik_api.Simulator"><tt class="xref py py-class docutils literal"><span class="pre">Simulator</span></tt></a> sub-class and pass it to
<a class="reference internal" href="#mosaik_api.start_simulation" title="mosaik_api.start_simulation"><tt class="xref py py-func docutils literal"><span class="pre">start_simulation()</span></tt></a>:</p>
<dl class="function">
<dt id="mosaik_api.start_simulation">
<tt class="descclassname">mosaik_api.</tt><tt class="descname">start_simulation</tt><big>(</big><em>simulator</em>, <em>description=''</em>, <em>extra_options=None</em><big>)</big><a class="headerlink" href="#mosaik_api.start_simulation" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the simulation process for <tt class="docutils literal"><span class="pre">simulation</span></tt>.</p>
<p><em>simulation</em> is the instance of your API implementation (see
<a class="reference internal" href="#mosaik_api.Simulator" title="mosaik_api.Simulator"><tt class="xref py py-class docutils literal"><span class="pre">Simulator</span></tt></a>).</p>
<p><em>description</em> may override the default description printed with the help on
the command line.</p>
<p><em>extra_option</em> may be a list of options for <a class="reference external" href="http://docopt.org/">docopt</a>
(example: <tt class="docutils literal"><span class="pre">['-e,</span> <span class="pre">--example</span>&nbsp;&nbsp;&nbsp;&nbsp; <span class="pre">Enable</span> <span class="pre">example</span> <span class="pre">mode']</span></tt>). Commandline
arguments are passed to <a class="reference internal" href="#mosaik_api.Simulator.configure" title="mosaik_api.Simulator.configure"><tt class="xref py py-meth docutils literal"><span class="pre">Simulator.configure()</span></tt></a> so that your API
implementation can handle them.</p>
</dd></dl>

<p>Here is an example with a bit more context:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">mosaik_api</span>


<span class="n">example_meta</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;models&#39;</span> <span class="p">{</span>
        <span class="s">&#39;A&#39;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s">&#39;public&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
              <span class="s">&#39;params&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;init_val&#39;</span><span class="p">],</span>
              <span class="s">&#39;attrs&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;val_out&#39;</span><span class="p">,</span> <span class="s">&#39;dummy_out&#39;</span><span class="p">],</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">ExampleSim</span><span class="p">(</span><span class="n">mosaik_api</span><span class="o">.</span><span class="n">Simulator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">example_meta</span><span class="p">)</span>

    <span class="n">sim_name</span> <span class="o">=</span> <span class="s">&#39;ExampleSimulation&#39;</span>

    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="c"># Here you could handle additional command line arguments</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sid</span><span class="p">):</span>
        <span class="c"># Initialize the simulator</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>

    <span class="c"># Implement the remaining methods (create, step, get_data, ...)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">sys</span>

    <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;A simple example simulation for mosaik.&#39;</span>
    <span class="n">extra_options</span> <span class="o">=</span> <span class="p">[</span>
       <span class="s">&#39;--foo       Enable foo&#39;</span><span class="p">,</span>
       <span class="s">&#39;--bar BAR   The bar parameter&#39;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">mosaik_api</span><span class="o">.</span><span class="n">start_simulation</span><span class="p">(</span><span class="n">ExampleSim</span><span class="p">(),</span> <span class="n">description</span><span class="p">,</span> <span class="n">extra_options</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="../scenario-definition.html" class="btn btn-neutral float-right" title="Scenario definition"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="low-level.html" class="btn btn-neutral" title="The low-level API"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2013, Stefan Scherfke.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>