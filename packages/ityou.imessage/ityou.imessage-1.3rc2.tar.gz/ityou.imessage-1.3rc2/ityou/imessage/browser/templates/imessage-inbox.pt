<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ityou.imessage">
<body>

    <div metal:fill-slot="main">
    <metal:main-macro define-macro="main"
                      tal:define="templateId template/getId;
                                  is_mobile python:False;
                                  receiver_id request/sid | nothing;
                                  portal_url view/portal_url;
                                  ">
 		<!--<h1 class="documentFirstHeading  breadcrumb" i18n:translate="instant_message_list">Instant Messages</h1>-->

	    <div id="imessage-inbox" class="clearfix">

            <div class="row">
                
                <div id="test-liste"></div>

                    <!-- neue nachricht -->
                    <div class="new-message clearfix">
                        <a tal:attributes="href string:${context/absolute_url}/@@messages" class="btn btn-default pull-right"><i class="fa fa-edit"/> <span i18n:translate="write_new_message">write new message</span></a>
                    </div>
                    <!-- /neue nachricht -->

                    <table class="table table-condensed table-hover" id="imessages-table">

                        <thead class="hidden-xs hidden-sm">
                            <tr>
                                <th class="checkbox-cell"><input type="checkbox" name="selectAll" title="Select all" i18n:attributes="title"></th> 
                                <th data-label="Sender" i18n:translate="inbox_sender">Sender</th>
                                <th data-label="Nachricht" i18n:translate="inbox_title">Title</th>
                                <th data-label="Datum" class="sortable sort-desc" data-sort-by="date" i18n:translate="inbox_date">Date</th>
                                <th></th>
                            </tr>
                            
                            <tr>
                                <td colspan="5" class="text-right">
                                    <div class="pull-left col-xs-6">
                                        <input class="form-control" type="text" id="filter_inbox" placeholder="Filter ..." i18n:attributes="placeholder">
                                        <i class="fa fa-times inbox-clear-filter"></i>
                                    </div>
                                    <div class="col-xs-6">
                                        <select name="doWithSelected" class="form-control">
                                            <option readonly i18n:translate="inbox_marked">marked:</option>
                                            <option disabled></option>
                                            <option value="markAsRead" i18n:translate="inbox_mark_as_read">mark as read</option>
                                            <option value="delete" i18n:translate="inbox_delete">delete</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        </thead>

                        <tbody>
                        
                            <!-- data here -->
                            
                        </tbody>
                        <tfoot>
                            <tr class="active" id="imessage-inbox-spinner">
                                <td colspan="5" class="text-center">
                                    <i class="fa fa-spinner fa-spin"></i> <em i18n:translate="inbox_loading">Loading ...</em>
                                </td>
                            </tr>
                        
                            <tr class="active hidden">
                                <td colspan="5" class="text-center load-more-messages">
                                    <em i18n:translate="inbox_load_more">click to load more</em>
                                </td>
                            </tr>
                        
                            <tr class="hidden-xs hidden-sm">
                                <td colspan="5" class="text-right">
                                    <div class="col-xs-6 pull-right">
                                        <select name="doWithSelected" class="form-control">
                                            <option readonly i18n:translate="inbox_marked">marked:</option>
                                            <option disabled></option>
                                            <option value="markAsRead" i18n:translate="inbox_mark_as_read">mark as read</option>
                                            <option value="delete" i18n:translate="inbox_delete">delete</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        </tfoot>
                    </table>


                    <!-- neue nachricht -->
                    <div class="new-message clearfix">
                        <a tal:attributes="href string:${context/absolute_url}/@@messages" class="btn btn-default pull-right"><i class="fa fa-edit"/> <span i18n:translate="write_new_message">write new message</span></a>
                    </div>
                    <!-- /neue nachricht -->

            </div>

        </div>
        
        <tal:comment condition="nothing">
        # ------------------------------------------------------------------------------
        #
        # Template zum Rendern der Inbox
        #
        # data = {
        #   approved: {Boolaen},
        #   group: {Boolean},
        #   hash: {String},
        #   msg: {String},
        #   ploneTimestamp: {String},
        #   sender_name: {String},
        #   sender_id: {String},
        #   sender_portrait: {String},
        #   siteUrl: {String},
        #   timestr: {String},
        #   timeStamp: {String}
        # }
        #
        # Aufruf in `ityou.esi.theme/src/ityou/esi/theme/esi_theme/jesi-assets/js/ityou/ityou.imessage-inbox.js:403,405`
        #
        # ------------------------------------------------------------------------------
        </tal:comment> 
        <script id="inbox-tmpl" type="text/x-jsrender">
            <tr class="{{if group == true}}group{{else}}user{{/if}} {{if approved == false}}unread{{/if}}" data-hash="{{:hash}}" data-timestamp="{{:ploneTimeStamp}}" data-url="{{:siteUrl}}/@@messages?{{if group == true}}rid{{else}}sid{{/if}}={{:sender_id}}">
                <td class="checkbox-cell hidden-xs hidden-sm"><input type="checkbox" name="selectedMessages[]"></td>
                <td data-label="Sender" data-uid="{{:sender_id}}" class="user-information">
                    {{if group != true}}
                        <a href="{{:site_url}}/author/{{:sender_id}}" class="user-portrait" data-uid="{{:sender_id}}">
                            <img src="{{:sender_portrait}}" class="img-thumbnail sender-portrait" alt="{{:sender_name}}">
                        </a>
                    {{else}}<!-- #LM TODO -- #MR auch in theme.html -->
                        <div class="user-portrait">
                            <img src="/++resource++ityou.esi.theme.img/group_icon.png" class="img-thumbnail sender-portrait" alt="{{:sender_name}}">
                        </div>
                    {{/if}}
                    <span>{{:sender_name}}</span>
                </td>

                <td data-label="Nachricht" class="message-text">
                    <a href="{{:site_url}}/@@messages?{{if group != true}}sid={{else}}rid={{/if}}{{:sender_id}}">
                        {{:msg}}
                    </a>
                </td>

                <td data-label="Datum" data-unix="{{:timeStamp}}" class="message-date">
                    <a href="{{:site_url}}/@@messages?{{if group != true}}sid={{else}}rid={{/if}}{{:sender_id}}">
                        {{:timestr}}
                    </a>
                </td>

                <td class="action-buttons text-right">
                    <div class="btn-group">
                        {{if approved == false}}
                        <button type="button" class="btn btn-default" data-action="markAsRead" title="mark as read" i18n:attributes="title">
                            <i class="fa fa-eye"></i>
                        </button>
                        {{/if}}
                        <button type="button" class="btn btn-default" data-action="delete" title="delete" i18n:attributes="title">
                            <i class="fa fa-trash-o"></i>
                        </button>
                    </div>
                </td>

            </tr>
        </script>

        <tal:comment condition="nothing">
        # ------------------------------------------------------------------------------
        #
        # DOKUMENTATION !
        #
        # ------------------------------------------------------------------------------
        </tal:comment>         
        <script id="inbox-filter-nomatch-tmpl" type="text/x-jsrender">
            <tr>
                <td colspan="5" class="text-center">
                    <i class="fa fa-lightbulb-o"></i> <em i18n:translate="inbox_filter_nomatch">No match found ...</em>
                </td>
            </tr>
        </script>

    </metal:main-macro>
    </div>
</body>
</html>
