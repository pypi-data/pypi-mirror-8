

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Writing your own validators &mdash; pycerberus 0.6 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pycerberus 0.6 documentation" href="index.html" />
    <link rel="next" title="Internationalization" href="i18n.html" />
    <link rel="prev" title="Available validators" href="available_validators.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="i18n.html" title="Internationalization"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="available_validators.html" title="Available validators"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pycerberus 0.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="writing-your-own-validators">
<h1>Writing your own validators<a class="headerlink" href="#writing-your-own-validators" title="Permalink to this headline">¶</a></h1>
<p>After all, using only built-in validators won&#8217;t help you much: You&#8217;ll need
custom validation rules which means that you need to write your own validators.</p>
<p>pycerberus comes with two classes that can serve as a good base when you start
writing a custom validator: The <tt class="docutils literal"><span class="pre">BaseValidator</span></tt> only provides the absolutely
required set of API so you have maximum freedom. The <tt class="docutils literal"><span class="pre">Validator</span></tt> class itself
is inherited from the <tt class="docutils literal"><span class="pre">BaseValidator</span></tt> and defines a more sophisticated API
and i18n support. Usually you should use the <tt class="docutils literal"><span class="pre">Validator</span></tt> class.</p>
<div class="section" id="basevalidator">
<h2>BaseValidator<a class="headerlink" href="#basevalidator" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pycerberus.api.BaseValidator">
<em class="property">class </em><tt class="descclassname">pycerberus.api.</tt><tt class="descname">BaseValidator</tt><big>(</big><em>self</em>, <em>messages=None</em><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator" title="Permalink to this definition">¶</a></dt>
<dd><p>The BaseValidator implements only the minimally required methods. 
Therefore it does not put many constraints on you. Most users probably want 
to use the <tt class="docutils literal"><span class="pre">Validator</span></tt> class which already implements some commonly used 
features.</p>
<p>You can pass <tt class="docutils literal"><span class="pre">messages</span></tt> a dict of messages during instantiation to 
overwrite messages specified in the validator without the need to create 
a subclass.</p>
<dl class="method">
<dt id="pycerberus.api.BaseValidator.copy">
<tt class="descname">copy</tt><big>(</big><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a copy of this instance.</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.BaseValidator.keys">
<tt class="descname">keys</tt><big>(</big><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all keys defined by this specific validator class.</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.BaseValidator.message_for_key">
<tt class="descname">message_for_key</tt><big>(</big><em>key</em>, <em>context</em><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.message_for_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a message for a specific key. Implement this method if you 
want to avoid calls to messages() which might be costly (otherwise 
implementing this method is optional).</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.BaseValidator.messages">
<tt class="descname">messages</tt><big>(</big><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.messages" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all messages which are defined by this validator as a 
key/message dictionary. Alternatively you can create a class-level
dictionary which contains these keys/messages.</p>
<p>You must declare all your messages here so that all keys are known 
after this method was called.</p>
<p>Calling this method might be costly when you have a lot of messages and 
returning them is expensive. You can reduce the overhead in some 
situations by implementing <tt class="docutils literal"><span class="pre">message_for_key()</span></tt></p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.BaseValidator.process">
<tt class="descname">process</tt><big>(</big><em>value</em>, <em>context=None</em><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.process" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the method to validate your input. The validator returns a
(Python) representation of the given input <tt class="docutils literal"><span class="pre">value</span></tt>.</p>
<p>In case of errors a <tt class="docutils literal"><span class="pre">InvalidDataError</span></tt> is thrown.</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.BaseValidator.raise_error">
<tt class="descname">raise_error</tt><big>(</big><em>key</em>, <em>value</em>, <em>context</em>, <em>errorclass=&lt;class 'pycerberus.errors.InvalidDataError'&gt;</em>, <em>**values</em><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.raise_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise an InvalidDataError for the given key.</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.BaseValidator.revert_conversion">
<tt class="descname">revert_conversion</tt><big>(</big><em>value</em>, <em>context=None</em><big>)</big><a class="headerlink" href="#pycerberus.api.BaseValidator.revert_conversion" title="Permalink to this definition">¶</a></dt>
<dd><p>Undo the conversion of <tt class="docutils literal"><span class="pre">process()</span></tt> and return a &#8220;string-like&#8221; 
representation. This method is especially useful for widget libraries
like ToscaWigets so they can render Python data types in a human 
readable way.
The returned value does not have to be an actual Python string as long
as it has a meaningful unicode() result. Generally the validator 
should accept the return value in its &#8216;.process()&#8217; method.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="validator">
<h2>Validator<a class="headerlink" href="#validator" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="pycerberus.api.Validator">
<em class="property">class </em><tt class="descclassname">pycerberus.api.</tt><tt class="descname">Validator</tt><big>(</big><em>self</em>, <em>default=NoValueSet</em>, <em>required=NoValueSet</em>, <em>strip=False</em>, <em>messages=None</em><big>)</big><a class="headerlink" href="#pycerberus.api.Validator" title="Permalink to this definition">¶</a></dt>
<dd><p>The Validator is the base class of most validators and implements 
some commonly used features like required values (raise exception if no
value was provided) or default values in case no value is given.</p>
<p>This validator splits conversion and validation into two separate steps:
When a value is <tt class="docutils literal"><span class="pre">process()``ed,</span> <span class="pre">the</span> <span class="pre">validator</span> <span class="pre">first</span> <span class="pre">calls</span> <span class="pre">``convert()</span></tt> 
which performs some checks on the value and eventually returns the converted
value. Only if the value was converted correctly, the <tt class="docutils literal"><span class="pre">validate()</span></tt> 
function can do additional checks on the converted value and possibly raise 
an Exception in case of errors. If you only want to do additional checks 
(but no conversion) in your validator, you can implement <tt class="docutils literal"><span class="pre">validate()</span></tt> and
simply assume that you get the correct Python type (e.g. int).</p>
<p>Of course if you can also raise a <tt class="docutils literal"><span class="pre">ValidationError</span></tt> inside of <tt class="docutils literal"><span class="pre">convert()</span></tt> -
often errors can only be detected during the conversion process.</p>
<p>By default, a validator will raise an <tt class="docutils literal"><span class="pre">InvalidDataError</span></tt> if no value was
given (unless you set a default value). If <tt class="docutils literal"><span class="pre">required</span></tt> is False, the 
default is None. All exceptions thrown by validators must be derived from 
<tt class="docutils literal"><span class="pre">ValidationError</span></tt>. Exceptions caused by invalid user input should use 
<tt class="docutils literal"><span class="pre">InvalidDataError</span></tt> or one of the subclasses.</p>
<p>If <tt class="docutils literal"><span class="pre">strip</span></tt> is True (default is False) and the input value has a <tt class="docutils literal"><span class="pre">strip()</span></tt>
method, the input will be stripped before it is tested for empty values and
passed to the <tt class="docutils literal"><span class="pre">convert()</span></tt>/<tt class="docutils literal"><span class="pre">validate()</span></tt> methods.</p>
<p>In order to prevent programmer errors, an exception will be raised if 
you set <tt class="docutils literal"><span class="pre">required</span></tt> to True but provide a default value as well.</p>
<dl class="method">
<dt id="pycerberus.api.Validator.convert">
<tt class="descname">convert</tt><big>(</big><em>value</em>, <em>context</em><big>)</big><a class="headerlink" href="#pycerberus.api.Validator.convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the input value to a suitable Python instance which is 
returned. If the input is invalid, raise an <tt class="docutils literal"><span class="pre">InvalidDataError</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.Validator.empty_value">
<tt class="descname">empty_value</tt><big>(</big><em>context</em><big>)</big><a class="headerlink" href="#pycerberus.api.Validator.empty_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the &#8216;empty&#8217; value for this validator (usually None).</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.Validator.is_empty">
<tt class="descname">is_empty</tt><big>(</big><em>value</em>, <em>context</em><big>)</big><a class="headerlink" href="#pycerberus.api.Validator.is_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Decide if the value is considered an empty value.</p>
</dd></dl>

<dl class="method">
<dt id="pycerberus.api.Validator.validate">
<tt class="descname">validate</tt><big>(</big><em>converted_value</em>, <em>context</em><big>)</big><a class="headerlink" href="#pycerberus.api.Validator.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform additional checks on the value which was processed 
successfully before (otherwise this method is not called). Raise an 
InvalidDataError if the input data is invalid.</p>
<p>You can implement only this method in your validator if you just want to
add additional restrictions without touching the actual conversion.</p>
<p>This method must not modify the <tt class="docutils literal"><span class="pre">converted_value</span></tt>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<p>pycerberus uses <a class="reference external" href="http://www.häcker.net/trac/browser/open-source/python-simple-super/trunk/simple_super.py">simple_super</a>
so you can just say &#8216;self.super()&#8217; in your custom validator classes. This will
call the super implementation with just the same parameters as your method was
called.</p>
<p>Validators need to be thread-safe as one instance might be used several times.
Therefore you must not add additional attributes to your validator instance
after you called Validator&#8217;s constructor. To prevent unexperienced programmers
falling in that trap, a &#8216;&#8217;Validator&#8217;&#8217; will raise an exception if you try to set
an attribute. If you don&#8217;t like this behavior and you really know what you are
doing, you can issue <tt class="docutils literal"><span class="pre">validator.set_internal_state_freeze(False)</span></tt> to disable
that protection.</p>
</div>
<div class="section" id="putting-all-together-a-simple-validator">
<h2>Putting all together - A simple validator<a class="headerlink" href="#putting-all-together-a-simple-validator" title="Permalink to this headline">¶</a></h2>
<p>Now it&#8217;s time to put it all together. This validator demonstrates most of the
API as explained so far:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnicodeValidator</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span> <span class="o">=</span> <span class="nb">max</span>
    
    <span class="k">def</span> <span class="nf">messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
                <span class="s">&#39;invalid_type&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Validator got unexpected input (expected string, got </span><span class="si">%(classname)s</span><span class="s">).&#39;</span><span class="p">),</span>
                <span class="s">&#39;too_long&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Please enter at maximum </span><span class="si">%(max_length) c</span><span class="s">haracters.&#39;</span><span class="p">)</span>
               <span class="p">}</span>
    <span class="c"># Alternatively you could also declare a class-level variable:</span>
    <span class="c"># messages = {...}</span>
    
    <span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">classname</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_error</span><span class="p">(</span><span class="s">&#39;invalid_type&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="n">classname</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">converted_value</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">converted_value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raise_error</span><span class="p">(</span><span class="s">&#39;too_long&#39;</span><span class="p">,</span> <span class="n">converted_value</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_length</span><span class="p">)</span>
</pre></div>
</div>
<p>The validator will convert all input to unicode strings (using the UTF-8
encoding). It also checks for a maximum length of the string.</p>
<p>You can see that all the conversion is done in <tt class="docutils literal"><span class="pre">convert()</span></tt> while additional
validation is encapsulated in <tt class="docutils literal"><span class="pre">validate()</span></tt>. This can help you keeping your
methods small.</p>
<p>In case there is an error the <tt class="docutils literal"><span class="pre">error()</span></tt> method will raise an <tt class="docutils literal"><span class="pre">InvalidDataError</span></tt>.
You select the error message to show by passing a string constant <tt class="docutils literal"><span class="pre">key</span></tt> which
identifies the message. The key can be used later to adapt the user interface
without relying the message itself (e.g. show an additional help box in the user
interface if the user typed in the wrong password).</p>
<p>The error messages are declared in the <tt class="docutils literal"><span class="pre">messages()</span></tt>. You&#8217;ll notice that the
message strings can also contain variable parts. You can use these variable
parts to give the user some additional hints about what was wrong with the data.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Writing your own validators</a><ul>
<li><a class="reference internal" href="#basevalidator">BaseValidator</a></li>
<li><a class="reference internal" href="#validator">Validator</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
<li><a class="reference internal" href="#putting-all-together-a-simple-validator">Putting all together - A simple validator</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="available_validators.html"
                        title="previous chapter">Available validators</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="i18n.html"
                        title="next chapter">Internationalization</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/writing_your_own.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="i18n.html" title="Internationalization"
             >next</a> |</li>
        <li class="right" >
          <a href="available_validators.html" title="Available validators"
             >previous</a> |</li>
        <li><a href="index.html">pycerberus 0.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright Felix Schwarz (MIT license).
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>