<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Using the Adapter Registry &mdash; zope.interface 4.0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="zope.interface 4.0.1 documentation" href="index.html" />
    <link rel="next" title="Verifying interface implementations" href="verify.html" />
    <link rel="prev" title="Adapter Registry" href="adapter.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="verify.html" title="Verifying interface implementations"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="adapter.html" title="Adapter Registry"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">zope.interface 4.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="using-the-adapter-registry">
<h1>Using the Adapter Registry<a class="headerlink" href="#using-the-adapter-registry" title="Permalink to this headline">Â¶</a></h1>
<p>This is a small demonstration of the <code class="docutils literal"><span class="pre">zope.interface</span></code> package including its
adapter registry. It is intended to provide a concrete but narrow example on
how to use interfaces and adapters outside of Zope 3.</p>
<p>First we have to import the interface package:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">zope.interface</span>
</pre></div>
</div>
<p>We now develop an interface for our object, which is a simple file in this
case. For now we simply support one attribute, the body, which contains the
actual file contents:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">IFile</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="n">body</span> <span class="o">=</span> <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span><span class="s">&#39;Contents of the file.&#39;</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>For statistical reasons we often want to know the size of a file. However, it
would be clumsy to implement the size directly in the file object, since the
size really represents meta-data. Thus we create another interface that
provides the size of something:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">ISize</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">Interface</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">getSize</span><span class="p">():</span>
<span class="gp">... </span>        <span class="s">&#39;Return the size of an object.&#39;</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Now we need to implement the file. It is essential that the object states
that it implements the <cite>IFile</cite> interface. We also provide a default body
value (just to make things simpler for this example):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>     <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">IFile</span><span class="p">)</span>
<span class="gp">... </span>     <span class="n">body</span> <span class="o">=</span> <span class="s">&#39;foo bar&#39;</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Next we implement an adapter that can provide the <cite>ISize</cite> interface given any
object providing <cite>IFile</cite>. By convention we use <cite>__used_for__</cite> to specify the
interface that we expect the adapted object to provide, in our case
<cite>IFile</cite>. However, this attribute is not used for anything. If you have
multiple interfaces for which an adapter is used, just specify the interfaces
via a tuple.</p>
<p>Again by convention, the constructor of an adapter takes one argument, the
context. The context in this case is an instance of <cite>File</cite> (providing <cite>IFile</cite>)
that is used to extract the size from. Also by convention the context is
stored in an attribute named <cite>context</cite> on the adapter. The twisted community
refers to the context as the <cite>original</cite> object. However, you may feel free to
use a specific argument name, such as <cite>file</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">FileSize</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">...</span>
<span class="gp">... </span>     <span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">implements</span><span class="p">(</span><span class="n">ISize</span><span class="p">)</span>
<span class="gp">... </span>     <span class="n">__used_for__</span> <span class="o">=</span> <span class="n">IFile</span>
<span class="gp">...</span>
<span class="gp">... </span>     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="gp">... </span>         <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
<span class="gp">...</span>
<span class="gp">... </span>     <span class="k">def</span> <span class="nf">getSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>         <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Now that we have written our adapter, we have to register it with an adapter
registry, so that it can be looked up when needed. There is no such thing as a
global registry; thus we have to instantiate one for our example manually:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface.adapter</span> <span class="kn">import</span> <span class="n">AdapterRegistry</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">registry</span> <span class="o">=</span> <span class="n">AdapterRegistry</span><span class="p">()</span>
</pre></div>
</div>
<p>The registry keeps a map of what adapters implement based on another
interface, the object already provides. Therefore, we next have to register an
adapter that adapts from <cite>IFile</cite> to <cite>ISize</cite>. The first argument to
the registry&#8217;s <cite>register()</cite> method is a list of original interfaces.In our
cause we have only one original interface, <cite>IFile</cite>. A list makes sense, since
the interface package has the concept of multi-adapters, which are adapters
that require multiple objects to adapt to a new interface. In these
situations, your adapter constructor will require an argument for each
specified interface.</p>
<p>The second argument is the interface the adapter provides, in our case
<cite>ISize</cite>. The third argument is the name of the adapter. Since we do not care
about names, we simply leave it as an empty string. Names are commonly useful,
if you have adapters for the same set of interfaces, but they are useful in
different situations. The last argument is simply the adapter class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">registry</span><span class="o">.</span><span class="n">register</span><span class="p">([</span><span class="n">IFile</span><span class="p">],</span> <span class="n">ISize</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">FileSize</span><span class="p">)</span>
</pre></div>
</div>
<p>You can now use the the registry to lookup the adapter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">registry</span><span class="o">.</span><span class="n">lookup1</span><span class="p">(</span><span class="n">IFile</span><span class="p">,</span> <span class="n">ISize</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="go">&lt;class &#39;FileSize&#39;&gt;</span>
</pre></div>
</div>
<p>Let&#8217;s get a little bit more practical. Let&#8217;s create a <cite>File</cite> instance and
create the adapter using a registry lookup. Then we see whether the adapter
returns the correct size by calling <cite>getSize()</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">file</span> <span class="o">=</span> <span class="n">File</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">size</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">lookup1</span><span class="p">(</span><span class="n">IFile</span><span class="p">,</span> <span class="n">ISize</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)(</span><span class="nb">file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">size</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="go">7</span>
</pre></div>
</div>
<p>However, this is not very practical, since I have to manually pass in the
arguments to the lookup method. There is some syntactic candy that will allow
us to get an adapter instance by simply calling <cite>ISize(file)</cite>. To make use of
this functionality, we need to add our registry to the adapter_hooks list,
which is a member of the adapters module. This list stores a collection of
callables that are automatically invoked when IFoo(obj) is called; their
purpose is to locate adapters that implement an interface for a certain
context instance.</p>
<p>You are required to implement your own adapter hook; this example covers one
of the simplest hooks that use the registry, but you could implement one that
used an adapter cache or persistent adapters, for instance. The helper hook is
required to expect as first argument the desired output interface (for us
<cite>ISize</cite>) and as the second argument the context of the adapter (here
<cite>file</cite>). The function returns an adapter, i.e. a <cite>FileSize</cite> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">hook</span><span class="p">(</span><span class="n">provided</span><span class="p">,</span> <span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">adapter</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">lookup1</span><span class="p">(</span><span class="n">zope</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">providedBy</span><span class="p">(</span><span class="nb">object</span><span class="p">),</span>
<span class="gp">... </span>                               <span class="n">provided</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">adapter</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
<p>We now just add the hook to an <cite>adapter_hooks</cite> list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">zope.interface.interface</span> <span class="kn">import</span> <span class="n">adapter_hooks</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">adapter_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
</pre></div>
</div>
<p>Once the hook is registered, you can use the desired syntax:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">size</span> <span class="o">=</span> <span class="n">ISize</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">size</span><span class="o">.</span><span class="n">getSize</span><span class="p">()</span>
<span class="go">7</span>
</pre></div>
</div>
<p>Now we have to cleanup after ourselves, so that others after us have a clean
<cite>adapter_hooks</cite> list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">adapter_hooks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
</pre></div>
</div>
<p>That&#8217;s it. I have intentionally left out a discussion of named adapters and
multi-adapters, since this text is intended as a practical and simple
introduction to Zope 3 interfaces and adapters. You might want to read the
<cite>adapter.txt</cite> in the <cite>zope.interface</cite> package for a more formal, referencial
and complete treatment of the package. Warning: People have reported that
<cite>adapter.txt</cite> makes their brain feel soft!</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="adapter.html"
                        title="previous chapter">Adapter Registry</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="verify.html"
                        title="next chapter">Verifying interface implementations</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/human.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="verify.html" title="Verifying interface implementations"
             >next</a> |</li>
        <li class="right" >
          <a href="adapter.html" title="Adapter Registry"
             >previous</a> |</li>
        <li><a href="index.html">zope.interface 4.0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012, Zope Foundation contributors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>