(function(a){String.prototype.startsWith=function(d){var b=this.length;var c=d.length;if(b<c){return false}return(this.substr(0,c)==d)};String.prototype.endsWith=function(d){var b=this.length;var c=d.length;if(b<c){return false}return(this.substr(b-c)==d)};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){var b=this.length;var d=Number(arguments[1])||0;d=(d<0)?Math.ceil(d):Math.floor(d);if(d<0){d+=b}for(;d<b;d++){if(d in this&&this[d]===c){return d}}return -1}}a.expr[":"].econtains=function(e,c,d,b){return(e.textContent||e.innerText||a(e).text()||"").toLowerCase()==d[3].toLowerCase()};a.expr[":"].withtext=function(e,c,d,b){return(e.textContent||e.innerText||a(e).text()||"")==d[3]};if(a.scrollbarWidth===undefined){a.scrollbarWidth=function(){var c,d,b;if(b===undefined){c=a('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");d=c.children();b=d.innerWidth()-d.height(99).innerWidth();c.remove()}return b}}a.UTF8={encode:function(d){d=d.replace(/\r\n/g,"\n");var b="";for(var f=0;f<d.length;f++){var e=d.charCodeAt(f);if(e<128){b+=String.fromCharCode(e)}else{if((e>127)&&(e<2048)){b+=String.fromCharCode((e>>6)|192);b+=String.fromCharCode((e&63)|128)}else{b+=String.fromCharCode((e>>12)|224);b+=String.fromCharCode(((e>>6)&63)|128);b+=String.fromCharCode((e&63)|128)}}}return b},decode:function(b){var d="";var e=0;var f=c1=c2=0;while(e<b.length){f=b.charCodeAt(e);if(f<128){d+=String.fromCharCode(f);e++}else{if((f>191)&&(f<224)){c2=b.charCodeAt(e+1);d+=String.fromCharCode(((f&31)<<6)|(c2&63));e+=2}else{c2=b.charCodeAt(e+1);c3=b.charCodeAt(e+2);d+=String.fromCharCode(((f&15)<<12)|((c2&63)<<6)|(c3&63));e+=3}}}return d}};if(a.ZTFY===undefined){a.ZTFY={}}a.ZTFY.getScript=function(c,e,d){var b={dataType:"script",url:c,success:e,error:a.ZTFY.ajax.error,cache:d===undefined?true:d};return a.ajax(b)};a.ZTFY.getFunctionByName=function(f,c){var e=f.split(".");var d=e.pop();var c=(c===undefined||c===null)?window:c;for(var b=0;b<e.length;b++){c=c[e[b]]}return c[d]};a.ZTFY.executeFunctionByName=function(e,c){var d=a.ZTFY.getFunctionByName(e,c);var b=Array.prototype.slice.call(arguments,2);return d.apply(c,b)};a.ZTFY.getQueryVar=function(d,e){if(d.indexOf("?")<0){return false}if(!d.endsWith("&")){d+="&"}var b=new RegExp(".*?[&\\?]"+e+"=(.*?)&.*");var c=d.replace(b,"$1");return c==d?false:c};a.ZTFY.rgb2hex=function(b){return"#"+a.map(b.match(/\b(\d+)\b/g),function(c){return("0"+parseInt(c).toString(16)).slice(-2)}).join("")};a.ZTFY.skin={stopEvent:function(b){if(!b){var b=window.event}if(b){if(b.stopPropagation){b.stopPropagation();b.preventDefault()}else{b.cancelBubble=true;b.returnValue=false}}},getCSS:function(d,f,e){var c=a("HEAD");var b=a('style[ztfy_id="'+f+'"]',c);if(b.length==0){a.get(d,function(h){var g=a("<style></style>").attr("type","text/css").attr("ztfy_id",f).text(h);c.prepend(g);if(e){e()}})}},switcher:function(b){a(b).toggle()}};a.ZTFY.ajax={check:function(b,c,d){if(typeof(b)=="undefined"){a.ZTFY.getScript(c,d)}else{d()}},getAddr:function(d){var b=d||a("HTML HEAD BASE").attr("href")||window.location.href;var c=b.replace(/\+\+skin\+\+\w+\//,"");return c.substr(0,c.lastIndexOf("/")+1)},post:function(e,g,c,b,f){if(e.startsWith("http://")){var h=e}else{var h=a.ZTFY.ajax.getAddr()+e}var d={url:h,type:"post",cache:false,data:a.param(g,true),dataType:f||"json",success:c,error:b||a.ZTFY.ajax.error};a.ajax(d)},submit:function(f,d,g,c,b,e){a.ZTFY.ajax.check(a.progressBar,"/--static--/ztfy.jqueryui/js/jquery-progressbar.min.js",function(){var i=a.progressBar.submit(f);if(d.startsWith(window.location.protocol)){var j=d}else{var j=a.ZTFY.ajax.getAddr()+d}if(i&&(j.indexOf("X-Progress-ID")<0)){j+="?X-Progress-ID="+i}var h={url:j,type:"post",iframe:true,data:g,dataType:e||"json",success:c,error:b||a.ZTFY.ajax.error};a(f).ajaxSubmit(h)})},error:function(d,b,c){if(!c){return}a.ZTFY.ajax.check(jAlert,"/--static--/ztfy.jqueryui/js/jquery-alerts.min.js",function(){jAlert(b+":\n\n"+c,a.ZTFY.I18n.ERROR_OCCURED,null)})}};a.ZTFY.json={getAddr:function(b){return a.ZTFY.ajax.getAddr(b)},getQuery:function(e,h,g,f){var b;if((g===null)||(g==="")||(g==="null")){g=undefined}else{if(typeof(g)=="string"){g=a.ZTFY.getFunctionByName(g)}}var d=a.isFunction(g);var c={url:a.ZTFY.json.getAddr(),type:"POST",method:h,async:d,params:{query:e},complete:g,success:function(j,i){b=j.result},error:function(k,i,j){jAlert(k.responseText,"Error !",window.location.reload)}};c.params=a.extend(c.params,f||{});a.jsonRpc(c);return b},post:function(h,f,c,b,e){var g=a.ZTFY.json.getAddr();if(e){g+="/"+e}var d={url:g,type:"post",cache:false,method:h,params:f,success:c,error:b};a.jsonRpc(d)}};a.ZTFY.loader={div:null,start:function(d){d.empty();var b=a('<div class="loader"></div>').appendTo(d);var c=a('<img class="loading" src="/--static--/ztfy.skin/img/loading.gif" />').appendTo(b);a.ZTFY.loader.div=b},stop:function(){if(a.ZTFY.loader.div!=null){a.ZTFY.loader.div.replaceWith("");a.ZTFY.loader.div=null}}};a.ZTFY.plugins={_registry:null,register:function(d,c,b){if(this._registry==null){this._registry=new Array()}this._registry.push([d,c,b])},callAndRegister:function(e,c,d,b){e.call(c,d,b);if(this._registry==null){this._registry=new Array()}this._registry.push([e,c,b])},call:function(f){var b=this._registry;if(b==null){return}for(var d in b){if(!a.isNumeric(d)){continue}var g=b[d][0];var e=b[d][1];var c=b[d][2];g.call(e,f,c)}},callCustomPlugins:function(b){a("[data-ztfy-plugin]",b).each(function(){var d=this;var c=a(this).data("ztfy-plugin").split(/\s+/);a(c).each(function(){var e=a.ZTFY.getFunctionByName(this);e.call(window,d)})})}};a.ZTFY.widgets={initTabs:function(b){if(typeof(a.fn.tabs)=="undefined"){return}a("DIV.form #tabforms UL.tabs",b).tabs("DIV.panes > DIV")},initDatatables:function(b){if(typeof(a.fn.dataTable)=="undefined"){return}a('[data-ztfy-widget="datatable"]',b).each(function(){var e=a(this);var d=e.data();var c={bJQueryUI:true,iDisplayLength:25,sPaginationType:"full_numbers",sDom:'fl<t<"F"p>',oLanguage:{sProcessing:a.ZTFY.I18n.DATATABLE_sProcessing,sSearch:a.ZTFY.I18n.DATATABLE_sSearch,sLengthMenu:a.ZTFY.I18n.DATATABLE_sLengthMenu,sInfo:a.ZTFY.I18n.DATATABLE_sInfo,sInfoEmpty:a.ZTFY.I18n.DATATABLE_sInfoEmpty,sInfoFiltered:a.ZTFY.I18n.DATATABLE_sInfoFiltered,sInfoPostFix:a.ZTFY.I18n.DATATABLE_sInfoPostFix,sLoadingRecords:a.ZTFY.I18n.DATATABLE_sLoadingRecords,sZeroRecords:a.ZTFY.I18n.DATATABLE_sZeroRecords,sEmptyTable:a.ZTFY.I18n.DATATABLE_sEmptyTable,oPaginate:{sFirst:a.ZTFY.I18n.DATATABLE_oPaginate_sFirst,sPrevious:a.ZTFY.I18n.DATATABLE_oPaginate_sPrevious,sNext:a.ZTFY.I18n.DATATABLE_oPaginate_sNext,sLast:a.ZTFY.I18n.DATATABLE_oPaginate_sLast},oAria:{sSortAscending:a.ZTFY.I18n.DATATABLE_oAria_sSortAscending,sSortDescending:a.ZTFY.I18n.DATATABLE_oAria_sSortDescending}}};a.extend(c,d.ztfyDatatableOptions||{});e.dataTable(c)})},initDates:function(b){if(typeof(a.fn.dynDateTime)=="undefined"){return}if(a.i18n_calendar===undefined){var c=a("html").attr("lang")||a("html").attr("xml:lang");a.i18n_calendar=c;if(c){if(c=="en"){a.ZTFY.getScript("/--static--/ztfy.jqueryui/js/lang/calendar-"+c+".min.js")}else{a.ZTFY.getScript("/--static--/ztfy.jqueryui/js/lang/calendar-"+c+"-utf8.js")}}}a('[data-ztfy-widget="datetime"]',b).each(function(){var d=a(this);d.dynDateTime({showsTime:d.data("datetime-showtime"),ifFormat:d.data("datetime-format"),button:d.data("datetime-button")})})},initMultiselect:function(b){if(typeof(a.fn.multiselect)=="undefined"){return}a('[data-ztfy-widget="multiselect"]',b).each(function(){var e=a(this);var d=e.data();var c=d.multiselectReferences||"{}";if(typeof(c)=="string"){c=a.parseJSON(c.replace(/'/g,'"'))}e.multiselect({readonly:d.multiselectReadonly,input_class:d.multiselectClass,separator:d.multiselectSeparator||",",min_query_length:d.multiselectMinLength||3,input_references:c,on_search:function(i){if(d.multiselectSearchCallback){var j=a.ZTFY.getFunctionByName(d.multiselectSearchCallback);var g=(d.multiselectSearchArgs||"").split(";");if(g.length>2){var f=g.length-1;var h=g[f];if(h){g[f]=a.parseJSON(h.replace(/'/g,'"'))}}g.splice(0,0,i);return j.apply(window,g)}else{return""}},on_search_timeout:d.multiselectSearchTimeout||300,max_complete_results:d.multiselectMaxResults||20,enable_new_options:d.multiselectEnableNew,complex_search:d.multiselectComplexSearch,max_selection_length:d.multiselectMaxSelectionLength,backspace_removes_last:d.multiselectBackspaceRemovesLast==false?false:true})})},initColors:function(b){if(typeof(a.fn.ColorPicker)=="undefined"){return}a('[data-ztfy-widget="color-selector"]',b).each(function(){var c=a(this);var d=a("INPUT",c);a("DIV",c).css("background-color","#"+d.val());if(c.data("readonly")===undefined){c.ColorPicker({color:"#"+d.val(),onShow:function(e){a(e).fadeIn(500);return false},onHide:function(e){a(e).fadeOut(500);return false},onChange:function(e,h,f){var g=a(this).data().colorpicker.el;a("INPUT",g).val(h);a("DIV",g).css("background-color","#"+h)},onSubmit:function(){a(this).ColorPickerHide()}})}})},initHints:function(b){a.ZTFY.ajax.check(a.fn.tipsy,"/--static--/ztfy.jqueryui/js/jquery-tipsy.min.js",function(){var c=a("DIV.form",a(b));if(c.data("ztfy-inputs-hints")==true){a('INPUT[type!="hidden"]:not(.nohint), SELECT, TEXTAREA',c).each(function(d,e){a(e).tipsy({html:true,fallback:a("A.hint",a(e).closest("DIV.row")).attr("title"),gravity:"nw"});a("A.hint:not(.nohide)",a(e).closest("DIV.row")).hide()})}a(".hint",c).tipsy({gravity:function(d){return a(this).data("ztfy-hint-gravity")||"sw"},offset:function(d){return a(this).data("ztfy-hint-offset")||0}})})},initTinyMCE:function(b){if(typeof(tinyMCE)=="undefined"){return}a('[data-ztfy-widget="TinyMCE"]',b).each(function(){var f=a(this).data();var d={script_url:"/--static--/ztfy.jqueryui/js/tiny_mce/tiny_mce.js"};var e=f.tinymceOptions.split(";");for(var c in e){if(!a.isNumeric(c)){continue}var g=e[c].split("=");switch(g[1]){case"true":d[g[0]]=true;break;case"false":d[g[0]]=false;break;default:d[g[0]]=g[1]}}if(!tinyMCE.settings){tinyMCE.init(d)}});a('[data-ztfy-widget="TinyMCE"]',b).click(function(c){if(c instanceof a.Event){c=c.srcElement||c.target}if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}tinyMCE.execCommand("mceAddControl",false,a(c).attr("id"))})},initFancybox:function(b){if(typeof(a.fn.fancybox)=="undefined"){return}a('[data-ztfy-widget="fancybox"]',b).each(function(){var e=a(this).data();var d=a(e.fancyboxSelector||"IMG",this);if(e.fancyboxParent!==undefined){d=d.parents(e.fancyboxParent)}var c={type:e.fancyboxType||"image",titleShow:e.fancyboxShowTitle,titlePosition:e.fancyboxTitlePosition||"outside",hideOnContentClick:e.fancyboxClickHide===undefined?true:e.fancyboxClickHide,overlayOpacity:e.fancyboxOverlayOpacity||0.5,padding:e.fancyboxPadding||10,margin:e.fancyboxMargin||20,transitionIn:e.fancyboxTransitionIn||"elastic",transitionOut:e.fancyboxTransitionOut||"elastic"};if(e.fancyboxTitleFormat){c.titleFormat=a.ZTFY.getFunctionByName(e.fancyboxTitleFormat)}else{c.titleFormat=function(j,k,g,i){if(j&&j.length){var f='<span id="fancybox-title-over"><strong>'+j+"</strong>";var h=a(k[g]).data("fancybox-description");if(h){f+="<br />"+h}f+="</span>";return f}else{return null}}}if(e.fancyboxComplete){c.onComplete=a.ZTFY.getFunctionByName(e.fancyboxComplete)}else{c.onComplete=function(){a("#fancybox-wrap").hover(function(){a("#fancybox-title").slideDown("slow")},function(){a("#fancybox-title").slideUp("slow")})}}d.fancybox(c)})}};a.ZTFY.dialog={switchGroup:function(b,c){var b=a(b);var c=a('DIV[id="group_'+c+'"]');if(b.attr("type")=="checkbox"){if(b.is(":checked")){c.show()}else{c.hide()}}else{if(b.attr("src").endsWith("pl.png")){c.show();b.attr("src","/--static--/ztfy.skin/img/mi.png")}else{c.hide();b.attr("src","/--static--/ztfy.skin/img/pl.png")}}b.parents("FIELDSET:first").toggleClass("switched")},options:{expose:{maskId:"mask",color:"#444",opacity:0.6,zIndex:1000},top:"5%",api:true,oneInstance:false,closeOnClick:false,onBeforeLoad:function(){var c=this.getOverlay();a.ZTFY.loader.start(c);var b=a.ZTFY.dialog.dialogs[a.ZTFY.dialog.getCount()-1];c.load(b.src,b.callback);if(a.browser.msie&&(a.browser.version<"7")){a("select").css("visibility","hidden")}},onClose:function(){a.ZTFY.dialog.onClose();if(a.browser.msie&&(a.browser.version<"7")){a("select").css("visibility","hidden")}}},dialogs:[],getCount:function(){return a.ZTFY.dialog.dialogs.length},getCurrent:function(){var b=a.ZTFY.dialog.getCount();return a("#dialog_"+b)},open:function(g,e,i){if(typeof(a.fn.overlay)=="undefined"){jAlert(a.ZTFY.I18n.MISSING_OVERLAY,a.ZTFY.I18n.ERROR_OCCURED);return}var g=g.replace(/ /g,"%20");if(a.isFunction(e)){i=e;e=null}var e=typeof(window.event)!="undefined"?window.event:e;a.ZTFY.skin.stopEvent(e);if(!a.ZTFY.dialog.dialogs){a.ZTFY.dialog.dialogs=new Array()}var c=a.ZTFY.dialog.getCount()+1;var h="dialog_"+c;var b={};var f={maskId:"mask_"+h,color:"#444",opacity:0.6,zIndex:a.ZTFY.dialog.options.expose.zIndex+c};a.extend(b,a.ZTFY.dialog.options,{expose:f});a.ZTFY.dialog.dialogs.push({src:g,callback:i||a.ZTFY.dialog.openCallback,body:a('<div class="overlay"></div>').attr("id",h).css("z-index",f.zIndex+1).appendTo(a("body"))});var d=a("#"+h);d.empty().overlay(b).load();if(a.fn.draggable){d.draggable({handle:'DIV[id="osx-container"], H1',containment:"window"})}},openCallback:function(b,e,m){if(e=="error"){a(this).html(b)}else{var h=a.ZTFY.dialog.getCurrent();a.ZTFY.plugins.call(h);a.ZTFY.plugins.callCustomPlugins(h);var g=a("DIV.viewspace",h);var i=a("H1",h);var j=a("DIV.legend",h);var d=a("DIV.form > FIELDSET > DIV.help",h);var c=a("DIV.actions",h);if(g.length>0){var k=a(window).height()-i.height()-j.height()-d.height()-c.height()-180;var f=g.position();var l=a.scrollbarWidth();g.css("max-height",k);if(g.get(0).scrollHeight>k){a("<div></div>").addClass("scrollmarker").addClass("top").css("width",g.width()-l/2).css("top",f.top).hide().appendTo(g);a("<div></div>").addClass("scrollmarker").addClass("bottom").css("width",g.width()-l/2).css("top",f.top+k-10).appendTo(g);g.scroll(function(q){var r=q.srcElement||q.target;var p=a(r);var n=a("DIV.scrollmarker.top",p);var t=p.scrollTop();if(t>0){n.show()}else{n.hide()}var o=a("DIV.scrollmarker.bottom",p);var u=parseInt(p.css("max-height"));var s=u+t-10;if(s>=r.scrollHeight-20){o.hide()}else{o.show()}})}g.scroll(function(n){a("DIV.jquery-multiselect-autocomplete",g).each(function(q,r){var p=a("BODY").scrollTop();var s=a(r).closest(".widget");var t=s.offset();var o=s.height();a(r).css("top",t.top+o-p)})});a(g).on("keydown","INPUT",function(n){if(n.which==13){n.preventDefault();if(a(n.target).data("ztfy-widget")!="multiselect"){a("INPUT[type=button]:first",c).click()}}});a("A.close",h).tipsy({gravity:"e"})}}},close:function(){a("#dialog_"+a.ZTFY.dialog.getCount()).overlay().close()},onClose:function(){if(typeof(tinyMCE)!="undefined"){if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}}var b=a.ZTFY.dialog.getCount();var c="dialog_"+b;a("DIV.tipsy").remove();a("#"+c).remove();a("#mask_"+c).remove();a.ZTFY.dialog.dialogs.pop()}};a.ZTFY.form={check:function(b){a.ZTFY.ajax.check(a.fn.ajaxSubmit,"/--static--/ztfy.jqueryui/js/jquery-form.min.js",b)},hideStatus:function(){a("DIV.form DIV.status").animate({opacity:0,height:0,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0},2000,function(){a(this).remove()})},getSubmitCallbacks:function(e){var c=a(e);var d=new Array();var b=c.data("ztfy-submit-callback");if(b){d.push([c,b])}a("[data-ztfy-submit-callback]",a(e)).each(function(){var f=a(this);d.push([f,f.data("ztfy-submit-callback")])});return d},checkSubmitCallbacks:function(c){var g=a.ZTFY.form.getSubmitCallbacks(c);if(!g.length){return true}var d=new Array();var e=true;for(var f in g){if(!a.isNumeric(f)){continue}var i=g[f];var h=i[0];var b=i[1];var j=a.ZTFY.executeFunctionByName(b,undefined,c,h);if((j!==undefined)&&(j!==true)){if(j===false){e=false}else{if(typeof(j)=="string"){d.push(j)}else{if(j.length&&(j.length>0)){d=d.concat(j)}}}}}if(d.length>1){jAlert(a.ZTFY.I18n.ERRORS_OCCURED+"\n"+d.join("\n"),a.ZTFY.I18n.WARNING);return false}else{if(d.length==1){jAlert(a.ZTFY.I18n.ERROR_OCCURED+"\n"+d.join("\n"),a.ZTFY.I18n.WARNING);return false}else{return e}}},submit:function(c){var b=a(this);if(b.data("submitted")||!a.ZTFY.form.checkSubmitCallbacks(this)){a.ZTFY.skin.stopEvent(c);return false}if(!b.data("ztfy-disable-submit-flag")){b.data("submitted",true)}if(a("IFRAME.progress",b).length>0){a.ZTFY.ajax.check(a.progressBar,"/--static--/ztfy.jqueryui/js/jquery-progressbar.min.js",function(){if(a.progressBar){a.progressBar.submit(b)}})}},reset:function(b){b.reset();a("input:first",b).focus()},showErrors:function(o){var k=a.ZTFY.dialog.getCurrent();var h=a("DIV.status",k).outerHeight(true);a("DIV.status",k).remove();a("DIV.error",k).each(function(i,p){a("DIV.widget",a(p)).detach().insertAfter(a(p));a(p).remove()});var d=a("<div></div>").addClass("status error");a("<div></div>").addClass("summary").text(o.errors.status).appendTo(d);var m=a("<ul></ul>").appendTo(d);if(o.errors.errors){for(var f in o.errors.errors){if(!a.isNumeric(f)){continue}var l=o.errors.errors[f];if(l.widget){a("<li></li>").text(l.widget+" : "+l.message).appendTo(m);var g=a('[id="'+l.id+'"]',k).parents("DIV.widget");var n=a(g).parents("DIV.row");var c=a("<div></div>").addClass("error").append(a("<div></div>").addClass("error").text(l.message)).insertBefore(g);g.detach().appendTo(c)}else{a("<li></li>").text(l.message).appendTo(m)}}}var j=a("DIV.viewspace",k);d.insertBefore(j);var b=d.outerHeight(true);if(b!=h){j.css("max-height",parseInt(j.css("max-height"))-b+h);var e=a("DIV.scrollmarker.top",k);e.css("top",parseInt(e.css("top"))-h+b)}a("FORM",k).data("submitted",false)},add:function(e,d,g,f,c){var b=a(e);if(b.data("submitted")||!a.ZTFY.form.checkSubmitCallbacks(e)){return false}var f=f||{};b.data("submitted",true);a.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}if(d){f.parent=d}var i=b.attr("action").replace(/\?X-Progress-ID=.*/,"");var h="/@@ajax/"+(c||"ajaxCreate");a(a.ZTFY.form).data("add_action",i);a.ZTFY.ajax.submit(e,i+h,f,g||a.ZTFY.form._addCallback,null,"json")});return false},_addCallback:function(b,c){if(c=="success"){if(typeof(b)=="string"){b=a.parseJSON(b)}var d=b.output;switch(d){case"ERRORS":a.ZTFY.form.showErrors(b);break;case"OK":a.ZTFY.dialog.close();a("DIV.status").remove();var g=b.message||a.ZTFY.I18n.DATA_UPDATED;a("DIV.required-info").after('<div class="status success"><div class="summary">'+g+"</div></div>");break;case"NONE":a.ZTFY.dialog.close();a("DIV.status").remove();var g=b.message||a.ZTFY.I18n.NO_UPDATE;a("DIV.required-info").after('<div class="status warning"><div class="summary">'+g+"</div></div>");break;case"MESSAGE":jAlert(b.message,b.title||a.ZTFY.I18n.INFO);var e=a.ZTFY.dialog.getCurrent();a("FORM",e).data("submitted",false);break;case"PASS":a.ZTFY.dialog.close();a("DIV.status").remove();break;case"RELOAD":window.location.reload();break;case"REDIRECT":window.location.href=b.target;break;case"CALLBACK":if(b.close_dialog){a.ZTFY.dialog.close()}a.ZTFY.executeFunctionByName(b.callback,undefined,b.options);break;default:if(d&&d.startsWith("<!-- OK -->")){a.ZTFY.dialog.close();a("DIV.form").replaceWith(d)}else{var e=a.ZTFY.dialog.getCurrent();a("DIV.dialog",e).replaceWith(d);var f=a("FORM",e);f.attr("action",a(a.ZTFY.form).data("add_action"));a('INPUT[id="'+f.attr("id")+'-buttons-add"]',e).bind("click",function(h){a.ZTFY.form.add(this.form,b.parent)});a('INPUT[id="'+f.attr("id")+'-buttons-cancel"]',e).bind("click",function(h){a.ZTFY.dialog.close()});a("#tabforms UL.tabs",e).tabs(a(e).selector+" DIV.panes > DIV")}}if(d!="ERRORS"){setTimeout("$.ZTFY.form.hideStatus();",2000)}}},edit:function(d,f,g,e,c){var b=a(d);if(b.data("submitted")||!a.ZTFY.form.checkSubmitCallbacks(d)){return false}b.data("submitted",true);a.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var i=b.attr("action").replace(/\?X-Progress-ID=.*/,"");var h="/@@ajax/"+(c||"ajaxEdit");a(a.ZTFY.form).data("edit_action",i);a.ZTFY.ajax.submit(d,i+h,e||{},g||a.ZTFY.form._editCallback,null,"json")});return false},_editCallback:function(b,c,e){if(c=="success"){if(typeof(b)=="string"){b=a.parseJSON(b)}var d=b.output;switch(d){case"ERRORS":a.ZTFY.form.showErrors(b);break;case"OK":a.ZTFY.dialog.close();a("DIV.status").remove();var h=b.message||a.ZTFY.I18n.DATA_UPDATED;a("DIV.required-info").after('<div class="status success"><div class="summary">'+h+"</div></div>");break;case"NONE":a.ZTFY.dialog.close();a("DIV.status").remove();var h=b.message||a.ZTFY.I18n.NO_UPDATE;a("DIV.required-info").after('<div class="status warning"><div class="summary">'+h+"</div></div>");break;case"MESSAGE":jAlert(b.message,b.title||a.ZTFY.I18n.INFO);var f=a.ZTFY.dialog.getCurrent();a("FORM",f).data("submitted",false);break;case"PASS":a.ZTFY.dialog.close();a("DIV.status").remove();break;case"RELOAD":window.location.reload();break;case"REDIRECT":window.location.href=b.target;break;case"CALLBACK":if(b.close_dialog){a.ZTFY.dialog.close()}a.ZTFY.executeFunctionByName(b.callback,undefined,b.options);break;default:if(d&&d.startsWith("<!-- OK -->")){a.ZTFY.dialog.close();a("DIV.form").replaceWith(d)}else{var f=a.ZTFY.dialog.getCurrent();a("DIV.dialog",f).replaceWith(d);var g=a("FORM",f);g.attr("action",a(a.ZTFY.form).data("edit_action"));a('INPUT[id="'+g.attr("id")+'-buttons-dialog_submit"]',f).bind("click",function(i){a.ZTFY.form.edit(this.form)});a('INPUT[id="'+g.attr("id")+'-buttons-dialog_cancel"]',f).bind("click",function(i){a.ZTFY.dialog.close()});a("#tabforms UL.tabs",f).tabs(a(f).selector+" DIV.panes > DIV")}}if(d!="ERRORS"){setTimeout("$.ZTFY.form.hideStatus();",2000)}}},remove:function(c,d,e,b){jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(j){if(j){var h={id:c};var g=a(d).closest("DIV.dialog").data("ztfy-url");var i=g||window.location.href;a.ZTFY.form.ajax_source=d;var f="/@@ajax/"+(b||"ajaxRemove");a.ZTFY.ajax.post(i+f,h,e||a.ZTFY.form._removeCallback,null,"text")}})},_removeCallback:function(b,c){if((c=="success")&&(b=="OK")){a(a.ZTFY.form.ajax_source).parents("TR").remove()}},update:function(c,d,b){a.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var f=a(c).formToArray(true);var e="/@@ajax/"+(b||"ajaxUpdate");a.ZTFY.ajax.post(a(c).attr("action")+e,f,d||a.ZTFY.form._updateCallback,null,"text")});return false},_updateCallback:function(b,c){if((c=="success")&&(b=="OK")){a("DIV.status").remove();a("LEGEND").after('<div class="status success"><div class="summary">'+a.ZTFY.I18n.DATA_UPDATED+"</div></div>")}}};a.ZTFY.container={remove:function(c,d,e){var b={_source:d,url:a.ZTFY.json.getAddr(e),type:"POST",method:"remove",params:{id:c},success:function(g,f){a(this._source).parents("BODY").css("cursor","default");a(this._source).parents("TR").remove()},error:function(h,f,g){jAlert(h.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)}};jConfirm(a.ZTFY.I18n.CONFIRM_REMOVE,a.ZTFY.I18n.CONFIRM,function(f){if(f){a(d).parents("BODY").css("cursor","wait");a.jsonRpc(b)}})}};a.ZTFY.sortable={options:{handle:"IMG.handler",axis:"y",containment:"parent",placeholder:"sorting-holder",stop:function(c,e){var b=new Array();a("TD.id",this).each(function(f){b[b.length]=a(this).text()});var d={ids:b};if(b.length>1){a.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxUpdateOrder",d,null,function(h,f,g){jAlert(h.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)})}}},init:function(b){if(typeof(a.fn.sortable)=="undefined"){return}a("TABLE.orderable TBODY",b).sortable(a.ZTFY.sortable.options)}};a.ZTFY.treeview={init:function(b){if(typeof(a.fn.treeTable)=="undefined"){return}a("TABLE.treeview",b).each(function(){var d=a(this);var c=d.data();d.treeTable({treeColumn:c.treeColumn===undefined?1:c.treeColumn,initialState:c.initialState===undefined?"expanded":c.initialState})})},changeParent:function(c,e){var g=a(e.draggable.parents("TR"));if(g.appendBranchTo(this)){var d=g.attr("id").substr("node-".length);var f=a(this).attr("id").substr("node-".length);var b={url:a.ZTFY.json.getAddr(),type:"POST",method:"changeParent",params:{source:parseInt(d),target:parseInt(f)},error:function(j,h,i){jAlert(j.responseText,a.ZTFY.I18n.ERROR_OCCURED,window.location.reload)}};a.jsonRpc(b)}}};a.ZTFY.reference={activate:function(b){a("INPUT[name="+b+"]").attr("readonly","").val("").focus();a("INPUT[name="+b+"]").prev().val("")},keyPressed:function(b){if(b.which==13){a.ZTFY.reference.search(this);return false}},search:function(d){var b;var c={url:a.ZTFY.ajax.getAddr(),type:"POST",method:"searchByTitle",async:false,params:{query:d},success:function(f,e){b=f.result},error:function(g,e,f){jAlert(g.responseText,"Error !",window.location.reload)}};a.jsonRpc(c);return b},select:function(b,d){var c=a.ZTFY.reference.source;a(c).prev().val(b);a(c).val(d+" (OID: "+b+")").attr("readonly","readonly");a("#selector").overlay().close();a("#selector").remove();return false}};a.ZTFY.extras={initDownloader:function(c,f,e){var d=a(c).attr("action");var f=d+f;var b=a('IFRAME[name="downloadFrame"]');if(b.length==0){b=a("<iframe></iframe>").hide().attr("name","downloadFrame").appendTo(a("BODY"))}a(c).attr("action",f).attr("target","downloadFrame").ajaxSubmit({data:e,iframe:true,iframeTarget:b});a(c).attr("action",d).attr("target",null);a.ZTFY.dialog.close();a("BODY").css("cursor","auto")},initContainerSize:function(b){a(b).css("min-height",a(a(b).data("container-sizer")).height())},initCaptcha:function(c){if(c instanceof a.Event){c=c.srcElement||c.target}var d=a(c).data();var b=new Date();var e="@@captcha.jpeg?id="+d.captchaId+unescape("%26")+b.getTime();a(c).attr("src",e).off("click").on("click",a.ZTFY.extras.initCaptcha)}};a.ZTFY.I18n={INFO:"Information",WARNING:"!! WARNING !!",ERROR_OCCURED:"An error occured!",ERRORS_OCCURED:"Some errors occured!",BAD_LOGIN_TITLE:"Bad login!",BAD_LOGIN_MESSAGE:"Your anthentication credentials didn't allow you to open a session; please check your credentials or contact administrator.",CONFIRM:"Confirm",CONFIRM_REMOVE:"Removing this content can't be undone. Do you confirm?",NO_UPDATE:"No changes were applied.",DATA_UPDATED:"Data successfully updated.",MISSING_OVERLAY:"JQuery « overlay » plug-in is required; please include JQuery-tools resources in your page!",DATATABLE_sProcessing:"Processing...",DATATABLE_sSearch:"Search:",DATATABLE_sLengthMenu:"Show _MENU_ entries",DATATABLE_sInfo:"Showing _START_ to _END_ of _TOTAL_ entrie",DATATABLE_sInfoEmpty:"Showing 0 to 0 of 0 entries",DATATABLE_sInfoFiltered:"(filtered from _MAX_ total entries))",DATATABLE_sInfoPostFix:"",DATATABLE_sLoadingRecords:"Loading...",DATATABLE_sZeroRecords:"No matching records found",DATATABLE_sEmptyTable:"No data available in table",DATATABLE_oPaginate_sFirst:"First",DATATABLE_oPaginate_sPrevious:"Previous",DATATABLE_oPaginate_sNext:"Next",DATATABLE_oPaginate_sLast:"Last",DATATABLE_oAria_sSortAscending:": sort ascending",DATATABLE_oAria_sSortDescending:": sort descending"};a.ZTFY.initPage=function(b){a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initTabs,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initDatatables,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initDates,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initMultiselect,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initHints,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initColors,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initTinyMCE,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.widgets.initFancybox,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.sortable.init,window,b);a.ZTFY.plugins.callAndRegister(a.ZTFY.treeview.init,window,b);a.ZTFY.plugins.callCustomPlugins(b);a('A[rel="external"]').attr("target","_blank");a(b).on("submit","FORM",a.ZTFY.form.submit)};a(document).ready(function(){a(document).ajaxStart(function(){a("BODY").css("cursor","wait")});a(document).ajaxStop(function(){a("BODY").css("cursor","auto")});var b=a("BODY").hasClass("layout");if(b){a.ZTFY.initPage(document)}var c=a("HTML").attr("lang")||a("HTML").attr("xml:lang");if(c&&(c!="en")){a.ZTFY.getScript("/--static--/ztfy.skin/js/i18n/"+c+".js",function(){if(!b){a.ZTFY.initPage(document)}})}else{if(!b){a.ZTFY.initPage(document)}}})})(jQuery);