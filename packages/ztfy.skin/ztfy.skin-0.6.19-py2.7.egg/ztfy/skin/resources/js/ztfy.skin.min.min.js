(function(b){String.prototype.startsWith=function(e){var a=this.length;var f=e.length;if(a<f){return false}return(this.substr(0,f)==e)};String.prototype.endsWith=function(e){var a=this.length;var f=e.length;if(a<f){return false}return(this.substr(a-f)==e)};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(f){var a=this.length;var e=Number(arguments[1])||0;e=(e<0)?Math.ceil(e):Math.floor(e);if(e<0){e+=a}for(;e<a;e++){if(e in this&&this[e]===f){return e}}return -1}}b.expr[":"].econtains=function(f,h,g,a){return(f.textContent||f.innerText||b(f).text()||"").toLowerCase()==g[3].toLowerCase()};b.expr[":"].withtext=function(f,h,g,a){return(f.textContent||f.innerText||b(f).text()||"")==g[3]};if(b.scrollbarWidth===undefined){b.scrollbarWidth=function(){var f,e,a;if(a===undefined){f=b('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");e=f.children();a=e.innerWidth()-e.height(99).innerWidth();f.remove()}return a}}b.UTF8={encode:function(h){h=h.replace(/\r\n/g,"\n");var a="";for(var c=0;c<h.length;c++){var g=h.charCodeAt(c);if(g<128){a+=String.fromCharCode(g)}else{if((g>127)&&(g<2048)){a+=String.fromCharCode((g>>6)|192);a+=String.fromCharCode((g&63)|128)}else{a+=String.fromCharCode((g>>12)|224);a+=String.fromCharCode(((g>>6)&63)|128);a+=String.fromCharCode((g&63)|128)}}}return a},decode:function(a){var h="";var g=0;var c=c1=c2=0;while(g<a.length){c=a.charCodeAt(g);if(c<128){h+=String.fromCharCode(c);g++}else{if((c>191)&&(c<224)){c2=a.charCodeAt(g+1);h+=String.fromCharCode(((c&31)<<6)|(c2&63));g+=2}else{c2=a.charCodeAt(g+1);c3=a.charCodeAt(g+2);h+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));g+=3}}}return h}};if(b.ZTFY===undefined){b.ZTFY={}}b.ZTFY.getScript=function(h,f,g){var a={dataType:"script",url:h,success:f,error:b.ZTFY.ajax.error,cache:g===undefined?true:g};return b.ajax(a)};b.ZTFY.getFunctionByName=function(g,j){var h=g.split(".");var i=h.pop();var j=(j===undefined||j===null)?window:j;for(var a=0;a<h.length;a++){j=j[h[a]]}return j[i]};b.ZTFY.executeFunctionByName=function(f,h){var g=b.ZTFY.getFunctionByName(f,h);var a=Array.prototype.slice.call(arguments,2);return g.apply(h,a)};b.ZTFY.getQueryVar=function(g,f){if(g.indexOf("?")<0){return false}if(!g.endsWith("&")){g+="&"}var a=new RegExp(".*?[&\\?]"+f+"=(.*?)&.*");var h=g.replace(a,"$1");return h==g?false:h};b.ZTFY.rgb2hex=function(a){return"#"+b.map(a.match(/\b(\d+)\b/g),function(d){return("0"+parseInt(d).toString(16)).slice(-2)}).join("")};b.ZTFY.skin={stopEvent:function(a){if(!a){var a=window.event}if(a){if(a.stopPropagation){a.stopPropagation();a.preventDefault()}else{a.cancelBubble=true;a.returnValue=false}}},getCSS:function(i,g,h){var j=b("HEAD");var a=b('style[ztfy_id="'+g+'"]',j);if(a.length==0){b.get(i,function(c){var d=b("<style></style>").attr("type","text/css").attr("ztfy_id",g).text(c);j.prepend(d);if(h){h()}})}},switcher:function(a){b(a).toggle()}};b.ZTFY.ajax={check:function(a,f,e){if(typeof(a)=="undefined"){b.ZTFY.getScript(f,e)}else{e()}},getAddr:function(e){var a=e||b("HTML HEAD BASE").attr("href")||window.location.href;var f=a.replace(/\+\+skin\+\+\w+\//,"");return f.substr(0,f.lastIndexOf("/")+1)},post:function(l,j,n,a,k){if(l.startsWith("http://")){var i=l}else{var i=b.ZTFY.ajax.getAddr()+l}var m={url:i,type:"post",cache:false,data:b.param(j,true),dataType:k||"json",success:n,error:a||b.ZTFY.ajax.error};b.ajax(m)},submit:function(i,k,h,l,a,j){b.ZTFY.ajax.check(b.progressBar,"/--static--/ztfy.jqueryui/js/jquery-progressbar.min.js",function(){var d=b.progressBar.submit(i);if(k.startsWith(window.location.protocol)){var c=k}else{var c=b.ZTFY.ajax.getAddr()+k}if(d&&(c.indexOf("X-Progress-ID")<0)){c+="?X-Progress-ID="+d}var e={url:c,type:"post",iframe:true,data:h,dataType:j||"json",success:l,error:a||b.ZTFY.ajax.error};b(i).ajaxSubmit(e)})},error:function(e,a,f){if(!f){return}b.ZTFY.ajax.check(jAlert,"/--static--/ztfy.jqueryui/js/jquery-alerts.min.js",function(){jAlert(a+":\n\n"+f,b.ZTFY.I18n.ERROR_OCCURED,null)})}};b.ZTFY.json={getAddr:function(a){return b.ZTFY.ajax.getAddr(a)},getQuery:function(l,i,j,k){var a;if((j===null)||(j==="")||(j==="null")){j=undefined}else{if(typeof(j)=="string"){j=b.ZTFY.getFunctionByName(j)}}var m=b.isFunction(j);var n={url:b.ZTFY.json.getAddr(),type:"POST",method:i,async:m,params:{query:l},complete:j,success:function(c,d){a=c.result},error:function(c,e,d){jAlert(c.responseText,"Error !",window.location.reload)}};n.params=b.extend(n.params,k||{});b.jsonRpc(n);return a},post:function(i,k,n,a,l){var j=b.ZTFY.json.getAddr();if(l){j+="/"+l}var m={url:j,type:"post",cache:false,method:i,params:k,success:n,error:a};b.jsonRpc(m)}};b.ZTFY.loader={div:null,start:function(e){e.empty();var a=b('<div class="loader"></div>').appendTo(e);var f=b('<img class="loading" src="/--static--/ztfy.skin/img/loading.gif" />').appendTo(a);b.ZTFY.loader.div=a},stop:function(){if(b.ZTFY.loader.div!=null){b.ZTFY.loader.div.replaceWith("");b.ZTFY.loader.div=null}}};b.ZTFY.plugins={_registry:null,register:function(e,f,a){if(this._registry==null){this._registry=new Array()}this._registry.push([e,f,a])},callAndRegister:function(f,h,g,a){f.call(h,g,a);if(this._registry==null){this._registry=new Array()}this._registry.push([f,h,a])},call:function(i){var a=this._registry;if(a==null){return}for(var k in a){if(!b.isNumeric(k)){continue}var h=a[k][0];var j=a[k][1];var l=a[k][2];h.call(j,i,l)}},callCustomPlugins:function(a){b("[data-ztfy-plugin]",a).each(function(){var e=this;var f=b(this).data("ztfy-plugin").split(/\s+/);b(f).each(function(){var c=b.ZTFY.getFunctionByName(this);c.call(window,e)})})}};b.ZTFY.widgets={initTabs:function(a){if(typeof(b.fn.tabs)=="undefined"){return}b("DIV.form #tabforms UL.tabs",a).tabs("DIV.panes > DIV")},initDatatables:function(a){if(typeof(b.fn.dataTable)=="undefined"){return}b('[data-ztfy-widget="datatable"]',a).each(function(){var f=b(this);var g=f.data();var h={bJQueryUI:true,iDisplayLength:25,sPaginationType:"full_numbers",sDom:'fl<t<"F"p>',oLanguage:{sProcessing:b.ZTFY.I18n.DATATABLE_sProcessing,sSearch:b.ZTFY.I18n.DATATABLE_sSearch,sLengthMenu:b.ZTFY.I18n.DATATABLE_sLengthMenu,sInfo:b.ZTFY.I18n.DATATABLE_sInfo,sInfoEmpty:b.ZTFY.I18n.DATATABLE_sInfoEmpty,sInfoFiltered:b.ZTFY.I18n.DATATABLE_sInfoFiltered,sInfoPostFix:b.ZTFY.I18n.DATATABLE_sInfoPostFix,sLoadingRecords:b.ZTFY.I18n.DATATABLE_sLoadingRecords,sZeroRecords:b.ZTFY.I18n.DATATABLE_sZeroRecords,sEmptyTable:b.ZTFY.I18n.DATATABLE_sEmptyTable,oPaginate:{sFirst:b.ZTFY.I18n.DATATABLE_oPaginate_sFirst,sPrevious:b.ZTFY.I18n.DATATABLE_oPaginate_sPrevious,sNext:b.ZTFY.I18n.DATATABLE_oPaginate_sNext,sLast:b.ZTFY.I18n.DATATABLE_oPaginate_sLast},oAria:{sSortAscending:b.ZTFY.I18n.DATATABLE_oAria_sSortAscending,sSortDescending:b.ZTFY.I18n.DATATABLE_oAria_sSortDescending}}};b.extend(h,g.ztfyDatatableOptions||{});f.dataTable(h)})},initDates:function(a){if(typeof(b.fn.dynDateTime)=="undefined"){return}if(b.i18n_calendar===undefined){var d=b("html").attr("lang")||b("html").attr("xml:lang");b.i18n_calendar=d;if(d){if(d=="en"){b.ZTFY.getScript("/--static--/ztfy.jqueryui/js/lang/calendar-"+d+".min.js")}else{b.ZTFY.getScript("/--static--/ztfy.jqueryui/js/lang/calendar-"+d+"-utf8.js")}}}b('[data-ztfy-widget="datetime"]',a).each(function(){var c=b(this);c.dynDateTime({showsTime:c.data("datetime-showtime"),ifFormat:c.data("datetime-format"),button:c.data("datetime-button")})})},initMultiselect:function(a){if(typeof(b.fn.multiselect)=="undefined"){return}b('[data-ztfy-widget="multiselect"]',a).each(function(){var f=b(this);var g=f.data();var h=g.multiselectReferences||"{}";if(typeof(h)=="string"){h=b.parseJSON(h.replace(/'/g,'"'))}f.multiselect({readonly:g.multiselectReadonly,input_class:g.multiselectClass,separator:g.multiselectSeparator||",",min_query_length:g.multiselectMinLength||3,input_references:h,on_search:function(d){if(g.multiselectSearchCallback){var c=b.ZTFY.getFunctionByName(g.multiselectSearchCallback);var k=(g.multiselectSearchArgs||"").split(";");if(k.length>2){var l=k.length-1;var e=k[l];if(e){k[l]=b.parseJSON(e.replace(/'/g,'"'))}}k.splice(0,0,d);return c.apply(window,k)}else{return""}},on_search_timeout:g.multiselectSearchTimeout||300,max_complete_results:g.multiselectMaxResults||20,enable_new_options:g.multiselectEnableNew,complex_search:g.multiselectComplexSearch,max_selection_length:g.multiselectMaxSelectionLength,backspace_removes_last:g.multiselectBackspaceRemovesLast==false?false:true})})},initColors:function(a){if(typeof(b.fn.ColorPicker)=="undefined"){return}b('[data-ztfy-widget="color-selector"]',a).each(function(){var f=b(this);var e=b("INPUT",f);b("DIV",f).css("background-color","#"+e.val());if(f.data("readonly")===undefined){f.ColorPicker({color:"#"+e.val(),onShow:function(c){b(c).fadeIn(500);return false},onHide:function(c){b(c).fadeOut(500);return false},onChange:function(j,c,i){var d=b(this).data().colorpicker.el;b("INPUT",d).val(c);b("DIV",d).css("background-color","#"+c)},onSubmit:function(){b(this).ColorPickerHide()}})}})},initHints:function(a){b.ZTFY.ajax.check(b.fn.tipsy,"/--static--/ztfy.jqueryui/js/jquery-tipsy.min.js",function(){var d=b("DIV.form",b(a));if(d.data("ztfy-inputs-hints")==true){b('INPUT[type!="hidden"]:not(.nohint), SELECT, TEXTAREA',d).each(function(f,c){b(c).tipsy({html:true,fallback:b("A.hint",b(c).closest("DIV.row")).attr("title"),gravity:"nw"});b("A.hint:not(.nohide)",b(c).closest("DIV.row")).hide()})}b("A.hint",d).tipsy({gravity:function(c){return b(this).data("ztfy-hint-gravity")||"sw"},offset:function(c){return b(this).data("ztfy-hint-offset")||0}})})},initTinyMCE:function(a){if(typeof(tinyMCE)=="undefined"){return}b('[data-ztfy-widget="TinyMCE"]',a).each(function(){var i=b(this).data();var k={script_url:"/--static--/ztfy.jqueryui/js/tiny_mce/tiny_mce.js"};var j=i.tinymceOptions.split(";");for(var l in j){if(!b.isNumeric(l)){continue}var h=j[l].split("=");switch(h[1]){case"true":k[h[0]]=true;break;case"false":k[h[0]]=false;break;default:k[h[0]]=h[1]}}if(!tinyMCE.settings){tinyMCE.init(k)}});b('[data-ztfy-widget="TinyMCE"]',a).click(function(d){if(d instanceof b.Event){d=d.srcElement||d.target}if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}tinyMCE.execCommand("mceAddControl",false,b(d).attr("id"))})},initFancybox:function(a){if(typeof(b.fn.fancybox)=="undefined"){return}b('[data-ztfy-widget="fancybox"]',a).each(function(){var f=b(this).data();var g=b(f.fancyboxSelector||"IMG",this);if(f.fancyboxParent!==undefined){g=g.parents(f.fancyboxParent)}var h={type:f.fancyboxType||"image",titleShow:f.fancyboxShowTitle,titlePosition:f.fancyboxTitlePosition||"outside",hideOnContentClick:f.fancyboxClickHide===undefined?true:f.fancyboxClickHide,overlayOpacity:f.fancyboxOverlayOpacity||0.5,padding:f.fancyboxPadding||10,margin:f.fancyboxMargin||20,transitionIn:f.fancyboxTransitionIn||"elastic",transitionOut:f.fancyboxTransitionOut||"elastic"};if(f.fancyboxTitleFormat){h.titleFormat=b.ZTFY.getFunctionByName(f.fancyboxTitleFormat)}else{h.titleFormat=function(d,c,m,e){if(d&&d.length){var n='<span id="fancybox-title-over"><strong>'+d+"</strong>";var l=b(c[m]).data("fancybox-description");if(l){n+="<br />"+l}n+="</span>";return n}else{return null}}}if(f.fancyboxComplete){h.onComplete=b.ZTFY.getFunctionByName(f.fancyboxComplete)}else{h.onComplete=function(){b("#fancybox-wrap").hover(function(){b("#fancybox-title").slideDown("slow")},function(){b("#fancybox-title").slideUp("slow")})}}g.fancybox(h)})}};b.ZTFY.dialog={switchGroup:function(a,d){var a=b(a);var d=b('DIV[id="group_'+d+'"]');if(a.attr("type")=="checkbox"){if(a.is(":checked")){d.show()}else{d.hide()}}else{if(a.attr("src").endsWith("pl.png")){d.show();a.attr("src","/--static--/ztfy.skin/img/mi.png")}else{d.hide();a.attr("src","/--static--/ztfy.skin/img/pl.png")}}a.parents("FIELDSET:first").toggleClass("switched")},options:{expose:{maskId:"mask",color:"#444",opacity:0.6,zIndex:1000},top:"5%",api:true,oneInstance:false,closeOnClick:false,onBeforeLoad:function(){var d=this.getOverlay();b.ZTFY.loader.start(d);var a=b.ZTFY.dialog.dialogs[b.ZTFY.dialog.getCount()-1];d.load(a.src,a.callback);if(b.browser.msie&&(b.browser.version<"7")){b("select").css("visibility","hidden")}},onClose:function(){b.ZTFY.dialog.onClose();if(b.browser.msie&&(b.browser.version<"7")){b("select").css("visibility","hidden")}}},dialogs:[],getCount:function(){return b.ZTFY.dialog.dialogs.length},getCurrent:function(){var a=b.ZTFY.dialog.getCount();return b("#dialog_"+a)},open:function(l,n,j){if(typeof(b.fn.overlay)=="undefined"){jAlert(b.ZTFY.I18n.MISSING_OVERLAY,b.ZTFY.I18n.ERROR_OCCURED);return}var l=l.replace(/ /g,"%20");if(b.isFunction(n)){j=n;n=null}var n=typeof(window.event)!="undefined"?window.event:n;b.ZTFY.skin.stopEvent(n);if(!b.ZTFY.dialog.dialogs){b.ZTFY.dialog.dialogs=new Array()}var p=b.ZTFY.dialog.getCount()+1;var k="dialog_"+p;var a={};var m={maskId:"mask_"+k,color:"#444",opacity:0.6,zIndex:b.ZTFY.dialog.options.expose.zIndex+p};b.extend(a,b.ZTFY.dialog.options,{expose:m});b.ZTFY.dialog.dialogs.push({src:l,callback:j||b.ZTFY.dialog.openCallback,body:b('<div class="overlay"></div>').attr("id",k).css("z-index",m.zIndex+1).appendTo(b("body"))});var o=b("#"+k);o.empty().overlay(a).load();if(b.fn.draggable){o.draggable({handle:'DIV[id="osx-container"], H1',containment:"window"})}},openCallback:function(x,u,a){if(u=="error"){b(this).html(x)}else{var r=b.ZTFY.dialog.getCurrent();b.ZTFY.plugins.call(r);b.ZTFY.plugins.callCustomPlugins(r);var s=b("DIV.viewspace",r);var q=b("H1",r);var p=b("DIV.legend",r);var v=b("DIV.form > FIELDSET > DIV.help",r);var w=b("DIV.actions",r);if(s.length>0){var o=b(window).height()-q.height()-p.height()-v.height()-w.height()-180;var t=s.position();var n=b.scrollbarWidth();s.css("max-height",o);if(s.get(0).scrollHeight>o){b("<div></div>").addClass("scrollmarker").addClass("top").css("width",s.width()-n/2).css("top",t.top).hide().appendTo(s);b("<div></div>").addClass("scrollmarker").addClass("bottom").css("width",s.width()-n/2).css("top",t.top+o-10).appendTo(s);s.scroll(function(g){var f=g.srcElement||g.target;var h=b(f);var j=b("DIV.scrollmarker.top",h);var d=h.scrollTop();if(d>0){j.show()}else{j.hide()}var i=b("DIV.scrollmarker.bottom",h);var c=parseInt(h.css("max-height"));var e=c+d-10;if(e>=f.scrollHeight-20){i.hide()}else{i.show()}})}s.scroll(function(c){b("DIV.jquery-multiselect-autocomplete",s).each(function(g,f){var h=b("BODY").scrollTop();var e=b(f).closest(".widget");var d=e.offset();var i=e.height();b(f).css("top",d.top+i-h)})});b(s).on("keydown","INPUT",function(c){if(c.which==13){c.preventDefault();if(b(c.target).data("ztfy-widget")!="multiselect"){b("INPUT[type=button]:first",w).click()}}});b("A.close",r).tipsy({gravity:"e"})}}},close:function(){b("#dialog_"+b.ZTFY.dialog.getCount()).overlay().close()},onClose:function(){if(typeof(tinyMCE)!="undefined"){if(tinyMCE.activeEditor){tinyMCE.execCommand("mceRemoveControl",false,tinyMCE.activeEditor.id)}}var a=b.ZTFY.dialog.getCount();var d="dialog_"+a;b("DIV.tipsy").remove();b("#"+d).remove();b("#mask_"+d).remove();b.ZTFY.dialog.dialogs.pop()}};b.ZTFY.form={check:function(a){b.ZTFY.ajax.check(b.fn.ajaxSubmit,"/--static--/ztfy.jqueryui/js/jquery-form.min.js",a)},hideStatus:function(){b("DIV.form DIV.status").animate({opacity:0,height:0,"margin-top":0,"margin-bottom":0,"padding-top":0,"padding-bottom":0},2000,function(){b(this).remove()})},getSubmitCallbacks:function(f){var h=b(f);var g=new Array();var a=h.data("ztfy-submit-callback");if(a){g.push([h,a])}b("[data-ztfy-submit-callback]",b(f)).each(function(){var c=b(this);g.push([c,c.data("ztfy-submit-callback")])});return g},checkSubmitCallbacks:function(q){var m=b.ZTFY.form.getSubmitCallbacks(q);if(!m.length){return true}var p=new Array();var o=true;for(var n in m){if(!b.isNumeric(n)){continue}var k=m[n];var l=k[0];var r=k[1];var a=b.ZTFY.executeFunctionByName(r,undefined,q,l);if((a!==undefined)&&(a!==true)){if(a===false){o=false}else{if(typeof(a)=="string"){p.push(a)}else{if(a.length&&(a.length>0)){p=p.concat(a)}}}}}if(p.length>1){jAlert(b.ZTFY.I18n.ERRORS_OCCURED+"\n"+p.join("\n"),b.ZTFY.I18n.WARNING);return false}else{if(p.length==1){jAlert(b.ZTFY.I18n.ERROR_OCCURED+"\n"+p.join("\n"),b.ZTFY.I18n.WARNING);return false}else{return o}}},submit:function(d){var a=b(this);if(a.data("submitted")||!b.ZTFY.form.checkSubmitCallbacks(this)){b.ZTFY.skin.stopEvent(d);return false}if(!a.data("ztfy-disable-submit-flag")){a.data("submitted",true)}if(b("IFRAME.progress",a).length>0){b.ZTFY.ajax.check(b.progressBar,"/--static--/ztfy.jqueryui/js/jquery-progressbar.min.js",function(){if(b.progressBar){b.progressBar.submit(a)}})}},reset:function(a){a.reset();b("input:first",a).focus()},showErrors:function(a){var r=b.ZTFY.dialog.getCurrent();var t=b("DIV.status",r).outerHeight(true);b("DIV.status",r).remove();b("DIV.error",r).each(function(c,d){b("DIV.widget",b(d)).detach().insertAfter(b(d));b(d).remove()});var x=b("<div></div>").addClass("status error");b("<div></div>").addClass("summary").text(a.errors.status).appendTo(x);var p=b("<ul></ul>").appendTo(x);if(a.errors.errors){for(var v in a.errors.errors){if(!b.isNumeric(v)){continue}var q=a.errors.errors[v];if(q.widget){b("<li></li>").text(q.widget+" : "+q.message).appendTo(p);var u=b('[id="'+q.id+'"]',r).parents("DIV.widget");var i=b(u).parents("DIV.row");var y=b("<div></div>").addClass("error").append(b("<div></div>").addClass("error").text(q.message)).insertBefore(u);u.detach().appendTo(y)}else{b("<li></li>").text(q.message).appendTo(p)}}}var s=b("DIV.viewspace",r);x.insertBefore(s);var z=x.outerHeight(true);if(z!=t){s.css("max-height",parseInt(s.css("max-height"))-z+t);var w=b("DIV.scrollmarker.top",r);w.css("top",parseInt(w.css("top"))-t+z)}b("FORM",r).data("submitted",false)},add:function(j,k,h,i,l){var a=b(j);if(a.data("submitted")||!b.ZTFY.form.checkSubmitCallbacks(j)){return false}var i=i||{};a.data("submitted",true);b.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}if(k){i.parent=k}var c=a.attr("action").replace(/\?X-Progress-ID=.*/,"");var d="/@@ajax/"+(l||"ajaxCreate");b(b.ZTFY.form).data("add_action",c);b.ZTFY.ajax.submit(j,c+d,i,h||b.ZTFY.form._addCallback,null,"json")});return false},_addCallback:function(a,l){if(l=="success"){if(typeof(a)=="string"){a=b.parseJSON(a)}var k=a.output;switch(k){case"ERRORS":b.ZTFY.form.showErrors(a);break;case"OK":b.ZTFY.dialog.close();b("DIV.status").remove();var h=a.message||b.ZTFY.I18n.DATA_UPDATED;b("DIV.required-info").after('<div class="status success"><div class="summary">'+h+"</div></div>");break;case"NONE":b.ZTFY.dialog.close();b("DIV.status").remove();var h=a.message||b.ZTFY.I18n.NO_UPDATE;b("DIV.required-info").after('<div class="status warning"><div class="summary">'+h+"</div></div>");break;case"MESSAGE":jAlert(a.message,a.title||b.ZTFY.I18n.INFO);var j=b.ZTFY.dialog.getCurrent();b("FORM",j).data("submitted",false);break;case"PASS":b.ZTFY.dialog.close();b("DIV.status").remove();break;case"RELOAD":window.location.href=window.location.href;break;case"REDIRECT":window.location.href=a.target;break;case"CALLBACK":if(a.close_dialog){b.ZTFY.dialog.close()}b.ZTFY.executeFunctionByName(a.callback,undefined,a.options);break;default:if(k&&k.startsWith("<!-- OK -->")){b.ZTFY.dialog.close();b("DIV.form").replaceWith(k)}else{var j=b.ZTFY.dialog.getCurrent();b("DIV.dialog",j).replaceWith(k);var i=b("FORM",j);i.attr("action",b(b.ZTFY.form).data("add_action"));b('INPUT[id="'+i.attr("id")+'-buttons-add"]',j).bind("click",function(c){b.ZTFY.form.add(this.form,a.parent)});b('INPUT[id="'+i.attr("id")+'-buttons-cancel"]',j).bind("click",function(c){b.ZTFY.dialog.close()});b("#tabforms UL.tabs",j).tabs(b(j).selector+" DIV.panes > DIV")}}if(k!="ERRORS"){setTimeout("$.ZTFY.form.hideStatus();",2000)}}},edit:function(k,i,h,j,l){var a=b(k);if(a.data("submitted")||!b.ZTFY.form.checkSubmitCallbacks(k)){return false}a.data("submitted",true);b.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var c=a.attr("action").replace(/\?X-Progress-ID=.*/,"");var d="/@@ajax/"+(l||"ajaxEdit");b(b.ZTFY.form).data("edit_action",c);b.ZTFY.ajax.submit(k,c+d,j||{},h||b.ZTFY.form._editCallback,null,"json")});return false},_editCallback:function(a,n,l){if(n=="success"){if(typeof(a)=="string"){a=b.parseJSON(a)}var m=a.output;switch(m){case"ERRORS":b.ZTFY.form.showErrors(a);break;case"OK":b.ZTFY.dialog.close();b("DIV.status").remove();var i=a.message||b.ZTFY.I18n.DATA_UPDATED;b("DIV.required-info").after('<div class="status success"><div class="summary">'+i+"</div></div>");break;case"NONE":b.ZTFY.dialog.close();b("DIV.status").remove();var i=a.message||b.ZTFY.I18n.NO_UPDATE;b("DIV.required-info").after('<div class="status warning"><div class="summary">'+i+"</div></div>");break;case"MESSAGE":jAlert(a.message,a.title||b.ZTFY.I18n.INFO);var k=b.ZTFY.dialog.getCurrent();b("FORM",k).data("submitted",false);break;case"PASS":b.ZTFY.dialog.close();b("DIV.status").remove();break;case"RELOAD":window.location.href=window.location.href;break;case"REDIRECT":window.location.href=a.target;break;case"CALLBACK":if(a.close_dialog){b.ZTFY.dialog.close()}b.ZTFY.executeFunctionByName(a.callback,undefined,a.options);break;default:if(m&&m.startsWith("<!-- OK -->")){b.ZTFY.dialog.close();b("DIV.form").replaceWith(m)}else{var k=b.ZTFY.dialog.getCurrent();b("DIV.dialog",k).replaceWith(m);var j=b("FORM",k);j.attr("action",b(b.ZTFY.form).data("edit_action"));b('INPUT[id="'+j.attr("id")+'-buttons-dialog_submit"]',k).bind("click",function(c){b.ZTFY.form.edit(this.form)});b('INPUT[id="'+j.attr("id")+'-buttons-dialog_cancel"]',k).bind("click",function(c){b.ZTFY.dialog.close()});b("#tabforms UL.tabs",k).tabs(b(k).selector+" DIV.panes > DIV")}}if(m!="ERRORS"){setTimeout("$.ZTFY.form.hideStatus();",2000)}}},remove:function(h,g,f,a){jConfirm(b.ZTFY.I18n.CONFIRM_REMOVE,b.ZTFY.I18n.CONFIRM,function(c){if(c){var e={id:h};var k=b(g).closest("DIV.dialog").data("ztfy-url");var d=k||window.location.href;b.ZTFY.form.ajax_source=g;var l="/@@ajax/"+(a||"ajaxRemove");b.ZTFY.ajax.post(d+l,e,f||b.ZTFY.form._removeCallback,null,"text")}})},_removeCallback:function(a,d){if((d=="success")&&(a=="OK")){b(b.ZTFY.form.ajax_source).parents("TR").remove()}},update:function(f,e,a){b.ZTFY.form.check(function(){if(typeof(tinyMCE)!="undefined"){tinyMCE.triggerSave()}var c=b(f).formToArray(true);var d="/@@ajax/"+(a||"ajaxUpdate");b.ZTFY.ajax.post(b(f).attr("action")+d,c,e||b.ZTFY.form._updateCallback,null,"text")});return false},_updateCallback:function(a,d){if((d=="success")&&(a=="OK")){b("DIV.status").remove();b("LEGEND").after('<div class="status success"><div class="summary">'+b.ZTFY.I18n.DATA_UPDATED+"</div></div>")}}};b.ZTFY.container={remove:function(h,g,f){var a={_source:g,url:b.ZTFY.json.getAddr(f),type:"POST",method:"remove",params:{id:h},success:function(c,d){b(this._source).parents("BODY").css("cursor","default");b(this._source).parents("TR").remove()},error:function(c,e,d){jAlert(c.responseText,b.ZTFY.I18n.ERROR_OCCURED,window.location.reload)}};jConfirm(b.ZTFY.I18n.CONFIRM_REMOVE,b.ZTFY.I18n.CONFIRM,function(c){if(c){b(g).parents("BODY").css("cursor","wait");b.jsonRpc(a)}})}};b.ZTFY.sortable={options:{handle:"IMG.handler",axis:"y",containment:"parent",placeholder:"sorting-holder",stop:function(h,f){var a=new Array();b("TD.id",this).each(function(c){a[a.length]=b(this).text()});var g={ids:a};if(a.length>1){b.ZTFY.ajax.post(window.location.href+"/@@ajax/ajaxUpdateOrder",g,null,function(c,e,d){jAlert(c.responseText,b.ZTFY.I18n.ERROR_OCCURED,window.location.reload)})}}},init:function(a){if(typeof(b.fn.sortable)=="undefined"){return}b("TABLE.orderable TBODY",a).sortable(b.ZTFY.sortable.options)}};b.ZTFY.treeview={init:function(a){if(typeof(b.fn.treeTable)=="undefined"){return}b("TABLE.treeview",a).each(function(){var e=b(this);var f=e.data();e.treeTable({treeColumn:f.treeColumn===undefined?1:f.treeColumn,initialState:f.initialState===undefined?"expanded":f.initialState})})},changeParent:function(l,j){var h=b(j.draggable.parents("TR"));if(h.appendBranchTo(this)){var k=h.attr("id").substr("node-".length);var i=b(this).attr("id").substr("node-".length);var a={url:b.ZTFY.json.getAddr(),type:"POST",method:"changeParent",params:{source:parseInt(k),target:parseInt(i)},error:function(c,e,d){jAlert(c.responseText,b.ZTFY.I18n.ERROR_OCCURED,window.location.reload)}};b.jsonRpc(a)}}};b.ZTFY.reference={activate:function(a){b("INPUT[name="+a+"]").attr("readonly","").val("").focus();b("INPUT[name="+a+"]").prev().val("")},keyPressed:function(a){if(a.which==13){b.ZTFY.reference.search(this);return false}},search:function(e){var a;var f={url:b.ZTFY.ajax.getAddr(),type:"POST",method:"searchByTitle",async:false,params:{query:e},success:function(c,d){a=c.result},error:function(c,h,d){jAlert(c.responseText,"Error !",window.location.reload)}};b.jsonRpc(f);return a},select:function(a,e){var f=b.ZTFY.reference.source;b(f).prev().val(a);b(f).val(e+" (OID: "+a+")").attr("readonly","readonly");b("#selector").overlay().close();b("#selector").remove();return false}};b.ZTFY.extras={initDownloader:function(j,g,h){var i=b(j).attr("action");var g=i+g;var a=b('IFRAME[name="downloadFrame"]');if(a.length==0){a=b("<iframe></iframe>").hide().attr("name","downloadFrame").appendTo(b("BODY"))}b(j).attr("action",g).attr("target","downloadFrame").ajaxSubmit({data:h,iframe:true,iframeTarget:a});b(j).attr("action",i).attr("target",null);b.ZTFY.dialog.close();b("BODY").css("cursor","auto")},initContainerSize:function(a){b(a).css("min-height",b(b(a).data("container-sizer")).height())},initCaptcha:function(h){if(h instanceof b.Event){h=h.srcElement||h.target}var g=b(h).data();var a=new Date();var f="@@captcha.jpeg?id="+g.captchaId+unescape("%26")+a.getTime();b(h).attr("src",f).off("click").on("click",b.ZTFY.extras.initCaptcha)}};b.ZTFY.I18n={INFO:"Information",WARNING:"!! WARNING !!",ERROR_OCCURED:"An error occured!",ERRORS_OCCURED:"Some errors occured!",BAD_LOGIN_TITLE:"Bad login!",BAD_LOGIN_MESSAGE:"Your anthentication credentials didn't allow you to open a session; please check your credentials or contact administrator.",CONFIRM:"Confirm",CONFIRM_REMOVE:"Removing this content can't be undone. Do you confirm?",NO_UPDATE:"No changes were applied.",DATA_UPDATED:"Data successfully updated.",MISSING_OVERLAY:"JQuery « overlay » plug-in is required; please include JQuery-tools resources in your page!",DATATABLE_sProcessing:"Processing...",DATATABLE_sSearch:"Search:",DATATABLE_sLengthMenu:"Show _MENU_ entries",DATATABLE_sInfo:"Showing _START_ to _END_ of _TOTAL_ entrie",DATATABLE_sInfoEmpty:"Showing 0 to 0 of 0 entries",DATATABLE_sInfoFiltered:"(filtered from _MAX_ total entries))",DATATABLE_sInfoPostFix:"",DATATABLE_sLoadingRecords:"Loading...",DATATABLE_sZeroRecords:"No matching records found",DATATABLE_sEmptyTable:"No data available in table",DATATABLE_oPaginate_sFirst:"First",DATATABLE_oPaginate_sPrevious:"Previous",DATATABLE_oPaginate_sNext:"Next",DATATABLE_oPaginate_sLast:"Last",DATATABLE_oAria_sSortAscending:": sort ascending",DATATABLE_oAria_sSortDescending:": sort descending"};b.ZTFY.initPage=function(a){b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initTabs,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initDatatables,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initDates,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initMultiselect,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initHints,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initColors,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initTinyMCE,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.widgets.initFancybox,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.sortable.init,window,a);b.ZTFY.plugins.callAndRegister(b.ZTFY.treeview.init,window,a);b.ZTFY.plugins.callCustomPlugins(a);b('A[rel="external"]').attr("target","_blank");b(a).on("submit","FORM",b.ZTFY.form.submit)};b(document).ready(function(){b(document).ajaxStart(function(){b("BODY").css("cursor","wait")});b(document).ajaxStop(function(){b("BODY").css("cursor","auto")});var a=b("BODY").hasClass("layout");if(a){b.ZTFY.initPage(document)}var d=b("HTML").attr("lang")||b("HTML").attr("xml:lang");if(d&&(d!="en")){b.ZTFY.getScript("/--static--/ztfy.skin/js/i18n/"+d+".js",function(){if(!a){b.ZTFY.initPage(document)}})}else{if(!a){b.ZTFY.initPage(document)}}})})(jQuery);