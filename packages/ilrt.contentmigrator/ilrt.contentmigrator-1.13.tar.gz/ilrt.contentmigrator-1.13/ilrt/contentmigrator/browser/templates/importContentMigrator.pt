<tal:block define="context_id request/context_id | context/context_id | nothing;
                   contexts context/portal_setup/listContextInfos;
                   context_title python:[c['title'] for c in contexts if c['id']==context_id];
                   context_title python:context_title and context_title[0] or 'UNKNOWN';
                   extension_contexts python:[c for c in contexts if c['type'] in ['extension','snapshot'] and not c['id'].startswith('profile-Products.CMFPlone')];
                   ">
<tal:header tal:replace="structure context/manage_page_header">PAGE HEADER</tal:header>
<tal:tabs tal:define="manage_tabs_message options/manage_tabs_message | nothing"
    tal:replace="structure context/manage_tabs">TABS</tal:tabs>

<h3>Run the content import</h3>

<p>This runs a content import just as can 
 be done with <a href="../portal_setup/manage_importSteps">generic setup Import tab</a>.
 But it adds an option to specify a new target path for the root of the import.<br />
 More importantly ilrt.contentmigrator adapts the CMFPlone content import so that it deals with binary files and archetypes.</p>
<p> If you have run the export from another site then you can put the resulting structure folder into 
 ilrt.contentmigrator/ilrt/contentmigrator/profiles/import for it to be available for import.</p>

<ul tal:condition="options/out | request/out | nothing"> 
   <li tal:repeat="log options/out | request/out"
       tal:content="python:log" >
       Migration action log line
   </li>
</ul>

<form id="importform" method="post" action="manage_runImport">
<fieldset>
<legend>Import Content</legend>
<label>Import content to:</label> 
<input type="text" name="root" value="/">
<br /><br />
<label>Import content from content structure folder in:</label><br /> 

<p>Select the profile for the package that contains the structure directory to be imported</p>

<select name="context_id">
 <option value="context_id" tal:content="context_title" />
 <option value="context-CONTEXT_ID"
    tal:repeat="context extension_contexts"
    tal:attributes="value context/id; selected python:context_id==context['id']"
    tal:content="context/title">CONTEXT_TITLE</option>
</select>

<input type="hidden" name="ids:list" value="content" />

<br /><br />
<label>Re-index content</label><br />
<input type="radio" name="reindex" value="item" checked="checked" />1. Each item as its created<br />
<input type="radio" name="reindex" value="all" />2. All items at the end<br />
<input type="radio" name="reindex" value="" />3. Don't reindex now<br />
<p>Indexing content takes much longer than importing it, but it is must be done at some point.<br />
Choose 1. if you are not importing much content, 
2. if you are importing the whole site or 3. if you want to <a href="../portal_catalog/manage_catalogAdvanced">reindex manually</a></p> 
<input name="submit" type="submit" value="Import content" />
</form>

<tal:getout tal:define="out here/getImportLog | nothing">
<ol tal:condition="out | nothing">
 <li tal:repeat="item out"><span tal:replace="item" /></li>
</ol>
</tal:getout>

<tal:footer tal:replace="structure context/manage_page_footer">PAGE FOOTER</tal:footer>
</tal:block>

