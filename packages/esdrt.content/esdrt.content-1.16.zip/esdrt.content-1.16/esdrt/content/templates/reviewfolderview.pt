<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="esdrt.content">
  <tal:block metal:fill-slot="javascript_head_slot">
    <script type="text/javascript">
      $(document).ready(function(){
        $("#btnFilter").click(function(){
          var filter = "";
            if ($('#countryFilter').val() != ""){
              if (filter == ""){
                filter += "?";
              }else{
                filter += "&";
              }
              filter += "country=" + $('#countryFilter').val();
            }
            if ($('#statusFilter').val() != ""){
              if (filter == ""){
                filter += "?";
              }else{
                filter += "&";
              }            
              filter += "status=" + $('#statusFilter').val();
            }
            if ($('#yearFilter').val() != ""){
              if (filter == ""){
                filter += "?";
              }else{
                filter += "&";
              }            
              filter += "year=" + $('#yearFilter').val();
            }            
            if ($('#sectorFilter').val() != ""){
              if (filter == ""){
                filter += "?";
              }else{
                filter += "&";
              }            
              filter += "sector=" + $('#sectorFilter').val();
            }            
            window.location.href = window.location.pathname + filter;

        })
      })
    </script>
  </tal:block>
<body>
  <metal:main fill-slot="content-core">
    <metal:content-core define-macro="content-core">

      <div class="actions" tal:condition="view/can_add_observation">
        <a href="./++add++Observation"
          tal:attributes="href string:${here/absolute_url}/++add++Observation"
          class="standardButton">
            New observation
        </a>
      </div>
      <div id="tabs">
        <div class="tabs">
          <div class="active">
            <a class="eea-icon overview" tal:attributes="href string:${here/absolute_url}/view">Overview list</a>
          </div>
          <div>
            <a class="eea-icon inbox" tal:attributes="href string:${here/absolute_url}/inboxview">Inbox</a>
          </div>
        </div>
      </div>
      <div id="filters">
        <div class="row">
          <div class="cell position-0 width-3 esdLabel">Country</div>
          <div class="cell position-3 width-3 esdLabel">Status</div>
          <div class="cell position-6 width-3 esdLabel">Inventory year</div>
          <div class="cell position-9 width-4 esdLabel">Sector</div>
        </div>
        <div class="row">
          <div class="cell position-0 width-3 esdLabel">
            <select id="countryFilter">
              <option></option>
              <tal:block tal:repeat="item view/get_countries">
                <option
                  tal:define="country python:'';
                              country request/country | country"
                  tal:attributes="value python:item[0];
                                  selected python:item[0]==country"
                  tal:content="python:item[1]"></option>
              </tal:block>
            </select>
          </div>
          <div class="cell position-3 width-3 esdLabel">
            <select id="statusFilter"
                tal:define="status python:'';
                            status request/status | status">
              <option></option>
              <option tal:attributes="selected python:'draft'==status" 
                value="draft">Draft</option>
             <option tal:attributes="selected python:'open'==status" 
                value="open">Open</option>
              <option tal:attributes="selected python:'conclusion'==status" 
                value="conclusion">Conclusion</option>
              <option tal:attributes="selected python:'finished'==status" 
                value="finished">Finished</option>
            </select>
          </div>
          <div class="cell position-6 width-3 esdLabel">
            <input type="text" id="yearFilter" 
                tal:define="year python:'';
                            year request/year | year"              
              tal:attributes="value year"/>
          </div>
          <div class="cell position-9 width-4 esdLabel">
            <select id="sectorFilter">
              <option></option>
              <tal:block tal:repeat="item view/get_sectors">
                <option
                  tal:define="sector python:'';
                              sector request/sector | sector"
                  tal:attributes="value python:item[0];
                                  selected python:item[0]==sector"
                  tal:content="python:item[1]"></option>
              </tal:block>
            </select>
          </div>
          <div class="cell position-14 width-1 esdLabel">
            <a class="standardButton" id="btnFilter">Search</a>
          </div>          
        </div>        
      </div>
      <div id="no-content" tal:condition="not: view/get_questions">

        <p>
          There are no observations or questions to review.
        </p>

      </div>



      <div id="observations">
        <table class="observationList listing" tal:condition="view/get_questions">
          <thead>
            <tr>
              <th>
                Observation
              </th>
              <th>
                Status
              </th>
              <th style="width:65px">
                Country
              </th>
              <th style="width:100px">
                Sector
              </th>
              <th style="width:40px">
                Gas
              </th>
              <th style="width:20px">
                Inventory year
              </th>
              <th style="width:80px">
                Modification date
              </th>
              <th style="width:130px">
                Progress
              </th>
              <th tal:condition="view/is_secretariat">
                Author
              </th>
            </tr>
          </thead>

          <tbody>
            <tal:block tal:repeat="item view/get_questions">

              <tal:item condition="python:item.portal_type == 'Observation'">
                <tal:item define="observation nocall:item;
                                  toLocalizedTime nocall:here/@@plone/toLocalizedTime;">
                  <tr tal:attributes="data-href observation/absolute_url"
                      class="clickableRow">
                    <td class="observationRefCell">
                        <span class="ref-num"
                          tal:content="observation/getId">
                          UK-WAS-13-001
                        </span>
                        /
                        <span class="obs-title"
                          tal:content="observation/Title">
                          Observation title
                        </span>
                    </td>
                    <td class="statusCell">
                      <span tal:content="observation/observation_status|nothing"
                            tal:attributes="class observation/observation_status|nothing">
                        Pending
                      </span>
                    </td>
                    <td tal:content="observation/country_value" class="countryCell">
                      Austria
                    </td>
                    <td tal:content="observation/ghg_source_sectors_value" class="sectorCell">
                      Waste
                    </td>
                    <td tal:content="observation/gas_value" class="gasCell">
                      CO2
                    </td>
                    <td tal:content="observation/year" class="yearCell">
                      2014
                    </td>
                    <td tal:content="python:toLocalizedTime(observation.modified(), True)"
                        tal:attributes="data-sorter python:observation.modified()">
                      20 Jun 2014, 11:35 AM
                    </td>
                    <td>
                      <span class="eea-icon eea-icon-lg wfRole"><!-- --></span>
                      <span tal:content="observation/wf_location">Review Expert</span><br/>
                      <span class="eea-icon eea-icon-lg"
                        tal:attributes="class python: ' '.join(['eea-icon eea-icon-lg', observation.wf_status()[1]])"></span>
                      <span tal:content="python: observation.wf_status()[0]">Draft observation</span>
                    </td>
                    <td tal:condition="view/is_secretariat">
                      <span tal:replace="python:view.get_author_name(observation.Creator())" />
                    </td>
                </tr>
                </tal:item>
              </tal:item>

              <tal:item condition="python:item.portal_type == 'Question'" tal:replace="nothing">
                <tal:item define="question nocall:item;
                                  observation question/get_observation;
                                  toLocalizedTime nocall:here/@@plone/toLocalizedTime;">
                  <td>
                    <a href=""
                      tal:attributes="href observation/absolute_url"
                      tal:content="observation/getId">
                      UK-WAS-13-001
                    </a><br />
                    <a href=""
                      tal:attributes="href observation/absolute_url"
                      tal:content="observation/Title">
                      Observation title
                    </a>
                  </td>
                  <td tal:content="question/get_status|nothing">
                    Observation title
                  </td>
                  <td tal:content="observation/country_value">
                    Observation title
                  </td>
                  <td tal:content="observation/ghg_source_sectors_value">
                    Observation title
                  </td>
                  <td tal:content="observation/crf_code_value">
                    Observation title
                  </td>
                  <td tal:content="python:toLocalizedTime(question.modified(), True)">
                    Observation title
                  </td>

                </tal:item>
              </tal:item>
            </tal:block>
          </tbody>

        </table>
      </div>
      <div class="actions" tal:condition="python:view.can_add_observation() and view.get_questions()">
        <a href="./++add++Observation"
          tal:attributes="href string:${here/absolute_url}/++add++Observation"
          class="standardButton">
            New observation
        </a>
      </div>

    </metal:content-core>
  </metal:main>

</body>
</html>

