define(["jquery","underscore","marionette"],function(e,t,n){var r=n.ItemView.extend({tagName:"thead",template:"varify/tables/header",events:{"click th":"onClick"},initialize:function(){this.data={};if(!(this.data.view=this.options.view))throw new Error("view model required")},_getConcept:function(e){var t=parseInt(e.getAttribute("data-concept-id"),10);return t!==null&&!isNaN(t)?t:parseInt(e.parentElement.getAttribute("data-concept-id"),10)},onClick:function(e){var n,r;n=this._getConcept(e.target);if(n===null||isNaN(n))throw new Error("Unrecognized concept ID on column");r=t.find(this.data.view.facets.models,function(e){return e.get("concept")===n}),r||this.data.view.facets.add({concept:n}),t.each(this.data.view.facets.models,function(e){var t;e.get("concept")===n?(t=e.get("sort"),t?t.toLowerCase()==="asc"?(e.set("sort","desc"),e.set("sort_index",0)):(e.unset("sort"),e.unset("sort_index")):(e.set("sort","asc"),e.set("sort_index",0))):(e.unset("sort"),e.unset("sort_index"))}),this.data.view.save()},onRender:function(){t.each(this.data.view.facets.models,function(t){var n,r,i;n=e("th[data-concept-id="+t.get("concept")+"] i");if(n!==null){n.removeClass("icon-sort icon-sort-up icon-sort-down"),r=(t.get("sort")||"").toLowerCase();switch(r){case"asc":i="icon-sort-up";break;case"desc":i="icon-sort-down";break;default:i="icon-sort"}n.addClass(i)}})}});return{Header:r}})