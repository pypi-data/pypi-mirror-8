define(["underscore","marionette","cilantro","../models","../utils"],function(e,t,n,r,i){var s=t.ItemView.extend({serializeData:function(){if(!this.model)return;var e=this.model.toJSON();return e.loaded=(new Date(e.created)).toLocaleDateString(),e}}),o=s.extend({template:"varify/sample/detail"}),u=t.ItemView.extend({template:"varify/sample/variant-set",serializeData:function(){var e=this.model.toJSON();return e.modified=(new Date(e.modified)).toLocaleString(),e.created=(new Date(e.created)).toLocaleString(),e.url=this.model.url(),e.workflowUrl=i.toAbsolutePath("variant-sets/"+this.model.id),e}}),a=n.ui.EmptyView.extend({align:"left",icon:"",message:"No variant sets have been created for this sample."}),f=t.CollectionView.extend({itemView:u,emptyView:a}),l=t.ItemView.extend({className:"sample-loader",template:"varify/sample/loader",ui:{loadingMessage:".loading-message",errorMessage:".error-message"},initialize:function(){e.bindAll(this,"onSampleFetchError","onSampleFetchSuccess"),this.data={};if(!(this.data.context=this.options.context))throw new Error("context model required");this.on("router:load",this.onRouterLoad)},onRouterLoad:function(e,t,n){var i=parseInt(n)||null;i?(this.sample=new r.Sample({id:i}),this.sample.fetch({success:this.onSampleFetchSuccess,error:this.onSampleFetchError})):this.showError("There was an issue parsing the sample ID. Please make sure it is valid and try again")},showError:function(e){this.ui.loadingMessage.hide(),this.ui.errorMessage.text(e).show()},onSampleFetchError:function(){this.showError("There was an error retrieving the sample details in order to update your filters. Please make sure that the sample ID is valid and then try reloading this page.")},onSampleFetchSuccess:function(){var t=e.clone(this.data.context.get("json")),r=!1;if(t&&t.children&&t.children.length)for(var i=0;i<t.children.length;i++)if(t.children[i].concept===2){t.children[i].value[0].label=this.sample.get("label"),t.children[i].value[0].value=this.sample.id,r=!0;break}r?(this.data.context.save("json",t,{reset:!0}),n.router.navigate("results",{trigger:!0})):this.showError("Could not find sample filter. Make sure that you currently have a filter selected in the Proband control on the Query and that the filter is applied then try again.")}});return{SampleView:s,SampleDetail:o,SampleVariantSet:u,SampleVariantSets:f,SampleLoader:l}})