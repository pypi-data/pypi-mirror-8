<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>ucam_webauth &mdash; python-raven 0.5.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within python-raven 0.5.1 documentation"
          href="_static/opensearch.xml"/>
    <link rel="top" title="python-raven 0.5.1 documentation" href="index.html" />
    <link rel="up" title="python module documentation" href="modules.html" />
    <link rel="next" title="raven" href="raven.html" />
    <link rel="prev" title="python module documentation" href="modules.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="raven.html" title="raven"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="modules.html" title="python module documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">python-raven 0.5.1 documentation</a> &raquo;</li>
          <li><a href="modules.html" accesskey="U">python module documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-ucam_webauth">
<span id="ucam-webauth"></span><h1>ucam_webauth<a class="headerlink" href="#module-ucam_webauth" title="Permalink to this headline">¶</a></h1>
<p>The ucam_webauth module implements version 3 of the WAA to WLS protocol.</p>
<p>It is not set up to talk to a specific WAA (i.e., Raven), and subclassing
this modules&#8217; classes is required to make it functional (see <a class="reference internal" href="raven.html#module-raven" title="raven"><tt class="xref py py-mod docutils literal"><span class="pre">raven</span></tt></a>).</p>
<p>The protocol is implemented as defined at
<a class="reference external" href="https://raven.cam.ac.uk/project/waa2wls-protocol.txt">https://raven.cam.ac.uk/project/waa2wls-protocol.txt</a>
at the time of writing (though that URL may have since been replaced with a
newer version). A copy of wawa2wls-protocol.txt is included with python-raven,
and more information can be found at <a class="reference external" href="https://raven.cam.ac.uk/project/">https://raven.cam.ac.uk/project/</a>.</p>
<dl class="glossary docutils">
<dt id="term-waa">WAA</dt>
<dd>A WAA is a &#8220;Web Application Agent&#8221;
(i.e., an application using this module)</dd>
<dt id="term-wls">WLS</dt>
<dd>The &#8220;Web Login Service&#8221; (i.e., Raven)</dd>
</dl>
<dl class="data">
<dt id="ucam_webauth.ATYPE_PWD">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">ATYPE_PWD</tt><a class="headerlink" href="#ucam_webauth.ATYPE_PWD" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_SUCCESS">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_SUCCESS</tt><a class="headerlink" href="#ucam_webauth.STATUS_SUCCESS" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_CANCELLED">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_CANCELLED</tt><a class="headerlink" href="#ucam_webauth.STATUS_CANCELLED" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_NOATYPES">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_NOATYPES</tt><a class="headerlink" href="#ucam_webauth.STATUS_NOATYPES" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_UNSUPPORTED_VERSION">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_UNSUPPORTED_VERSION</tt><a class="headerlink" href="#ucam_webauth.STATUS_UNSUPPORTED_VERSION" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_BAD_REQUEST">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_BAD_REQUEST</tt><a class="headerlink" href="#ucam_webauth.STATUS_BAD_REQUEST" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_INTERACTION_REQUIRED">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_INTERACTION_REQUIRED</tt><a class="headerlink" href="#ucam_webauth.STATUS_INTERACTION_REQUIRED" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_WAA_NOT_AUTHORISED">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_WAA_NOT_AUTHORISED</tt><a class="headerlink" href="#ucam_webauth.STATUS_WAA_NOT_AUTHORISED" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.STATUS_AUTHENTICATION_DECLINED">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_AUTHENTICATION_DECLINED</tt><a class="headerlink" href="#ucam_webauth.STATUS_AUTHENTICATION_DECLINED" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference internal" href="#ucam_webauth.AuthenticationType" title="ucam_webauth.AuthenticationType"><tt class="xref py py-class docutils literal"><span class="pre">AuthenticationType</span></tt></a> and <a class="reference internal" href="#ucam_webauth.Status" title="ucam_webauth.Status"><tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt></a> instances used as constants
in requests and responses</p>
<p>They compare equal with their corresponding integers (for status codes)
and strings (for atypes).</p>
</dd></dl>

<dl class="data">
<dt id="ucam_webauth.STATUS_CODES">
<tt class="descclassname">ucam_webauth.</tt><tt class="descname">STATUS_CODES</tt><a class="headerlink" href="#ucam_webauth.STATUS_CODES" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict mapping status.code (i.e., the integer status code) to the relevant
status object</p>
</dd></dl>

<dl class="class">
<dt id="ucam_webauth.AuthenticationType">
<em class="property">class </em><tt class="descclassname">ucam_webauth.</tt><tt class="descname">AuthenticationType</tt><big>(</big><em>name</em>, <em>description</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth.html#AuthenticationType"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.AuthenticationType" title="Permalink to this definition">¶</a></dt>
<dd><p>An Authentication Type</p>
<p>This class exists to create the <tt class="xref py py-const docutils literal"><span class="pre">ucam_webauth.AUTH_PWD</span></tt> constant.</p>
<dl class="attribute">
<dt id="ucam_webauth.AuthenticationType.name">
<tt class="descname">name</tt><a class="headerlink" href="#ucam_webauth.AuthenticationType.name" title="Permalink to this definition">¶</a></dt>
<dd><p>the name by which Ucam-webauth knows it</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.AuthenticationType.description">
<tt class="descname">description</tt><a class="headerlink" href="#ucam_webauth.AuthenticationType.description" title="Permalink to this definition">¶</a></dt>
<dd><p>a sentence describing it</p>
</dd></dl>

<p>Note that comparing an <a class="reference internal" href="#ucam_webauth.AuthenticationType" title="ucam_webauth.AuthenticationType"><tt class="xref py py-class docutils literal"><span class="pre">AuthenticationType</span></tt></a> object with a
<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt> (or another <a class="reference internal" href="#ucam_webauth.AuthenticationType" title="ucam_webauth.AuthenticationType"><tt class="xref py py-class docutils literal"><span class="pre">AuthenticationType</span></tt></a> object) will compare
the <a class="reference internal" href="#ucam_webauth.AuthenticationType.name" title="ucam_webauth.AuthenticationType.name"><tt class="xref py py-attr docutils literal"><span class="pre">name</span></tt></a> attribute only. Further, <tt class="docutils literal"><span class="pre">str(atype)</span> <span class="pre">==</span> <span class="pre">atype.name</span></tt>.</p>
</dd></dl>

<dl class="class">
<dt id="ucam_webauth.Status">
<em class="property">class </em><tt class="descclassname">ucam_webauth.</tt><tt class="descname">Status</tt><big>(</big><em>code</em>, <em>name</em>, <em>description</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth.html#Status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.Status" title="Permalink to this definition">¶</a></dt>
<dd><p>A WLS response Status</p>
<dl class="attribute">
<dt id="ucam_webauth.Status.code">
<tt class="descname">code</tt><a class="headerlink" href="#ucam_webauth.Status.code" title="Permalink to this definition">¶</a></dt>
<dd><p>a (three digit) integer</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Status.name">
<tt class="descname">name</tt><a class="headerlink" href="#ucam_webauth.Status.name" title="Permalink to this definition">¶</a></dt>
<dd><p>short name for the status</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Status.description">
<tt class="descname">description</tt><a class="headerlink" href="#ucam_webauth.Status.description" title="Permalink to this definition">¶</a></dt>
<dd><p>description: a sentence describing the status</p>
</dd></dl>

<p>Note that comparing a <a class="reference internal" href="#ucam_webauth.Status" title="ucam_webauth.Status"><tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt></a> object with an integer
(or another <a class="reference internal" href="#ucam_webauth.Status" title="ucam_webauth.Status"><tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt></a> object) will compare the <a class="reference internal" href="#ucam_webauth.Status.code" title="ucam_webauth.Status.code"><tt class="xref py py-attr docutils literal"><span class="pre">code</span></tt></a>
attribute only. Further, <cite>int(status_object) == status_object.code</cite></p>
</dd></dl>

<dl class="class">
<dt id="ucam_webauth.Request">
<em class="property">class </em><tt class="descclassname">ucam_webauth.</tt><tt class="descname">Request</tt><big>(</big><em>url</em>, <em>desc=None</em>, <em>aauth=None</em>, <em>iact=None</em>, <em>msg=None</em>, <em>params=None</em>, <em>fail=None</em>, <em>encode_strings=True</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth.html#Request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.Request" title="Permalink to this definition">¶</a></dt>
<dd><p>A Request to the WLS</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>url</strong> (<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>) &#8211; a fully qualified URL; the user will be returned here
(along with the Response as a query parameter) afterwards</li>
<li><strong>desc</strong> (<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>) &#8211; optional description of the resource/website
(encoding - see below)</li>
<li><strong>aauth</strong> (<tt class="xref py py-class docutils literal"><span class="pre">set</span></tt> of <a class="reference internal" href="#ucam_webauth.AuthenticationType" title="ucam_webauth.AuthenticationType"><tt class="xref py py-class docutils literal"><span class="pre">AuthenticationType</span></tt></a> objects) &#8211; optional set of permissible authentication types;
we require the user to use one of them
(if empty, the WLS uses its default set)</li>
<li><strong>iact</strong> (<tt class="docutils literal"><span class="pre">True</span></tt>, <tt class="docutils literal"><span class="pre">False</span></tt> or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; interaction required, forbidden or don&#8217;t care (respectively)</li>
<li><strong>msg</strong> (<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>) &#8211; optional message explaining why authentication is required
(encoding - see below)</li>
<li><strong>params</strong> (<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>) &#8211; data, which is returned unaltered in the <a class="reference internal" href="#ucam_webauth.Response" title="ucam_webauth.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a></li>
<li><strong>fail</strong> (<tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt>) &#8211; if True, and authentication fails, the WLS must show an error
message and not redirect back to the WAA</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>All parameters are available as attributes as of Request object,
once created.</p>
<dl class="attribute">
<dt id="ucam_webauth.Request.iact">
<tt class="descname">iact</tt><a class="headerlink" href="#ucam_webauth.Request.iact" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<ul class="simple">
<li><tt class="xref py py-const docutils literal"><span class="pre">True</span></tt>: the user must re-authenticate</li>
<li><tt class="xref py py-const docutils literal"><span class="pre">False</span></tt>: no interaction with the user is permitted
(the request will only succeed if the user&#8217;s identity can be
returned without interacting at all)</li>
<li><tt class="xref py py-const docutils literal"><span class="pre">None</span></tt> (default): interacts if required</li>
</ul>
<dl class="attribute">
<dt id="ucam_webauth.Request.msg">
<tt class="descname">msg</tt><a class="headerlink" href="#ucam_webauth.Request.msg" title="Permalink to this definition">¶</a></dt>
<dt id="ucam_webauth.Request.desc">
<tt class="descname">desc</tt><a class="headerlink" href="#ucam_webauth.Request.desc" title="Permalink to this definition">¶</a></dt>
<dd><p>The &#8216;msg&#8217; and &#8216;desc&#8217; parameters are restricted to printable ASCII
characters (0x20 - 0x7e). The WLS will convert &#8216;&lt;&#8217; and &#8216;&gt;&#8217; to &#8216;&amp;lt;&#8217;
and &#8216;&amp;gt;&#8217; before using either string in HTML, preventing the
inclusion of markup. However, it does not touch &#8216;&amp;&#8217;, so HTML character
and numeric entities may be used to represent other characters.</p>
<p>If <cite>encode_strings</cite> is <tt class="docutils literal"><span class="pre">True</span></tt>, <tt class="docutils literal"><span class="pre">&amp;</span></tt> will be escaped to <tt class="docutils literal"><span class="pre">&amp;amp;</span></tt>,
and non-ascii characters in <cite>msg</cite> and <cite>desc</cite> will be converted to
their numeric entities.</p>
<p>Otherwise, it is up to you to encode your strings. An error will be
raised if <cite>msg</cite> or <cite>desc</cite> contain non-printable-ASCII characters.</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Request.params">
<tt class="descname">params</tt><a class="headerlink" href="#ucam_webauth.Request.params" title="Permalink to this definition">¶</a></dt>
<dd><p>The ucam-webauth protocol does not specify any restrictions on the
content of params. However, awful things may happen if you put
arbitrary binary data in here. The Raven server appears to interpret
non-ascii contents as latin-1, turn them into html entities in order
to put them in a hidden HTML input element, then turn them back into
(hopefully) the same binary data to be returned in the Response. As a
result it outright rejects &#8216;params&#8217; containing bytes below 0x20, and
has the potential to go horribly wrong and land you in encoding hell.</p>
<p>Basically, you probably want to base64 params before giving it to a
Request object.</p>
</dd></dl>

<dl class="method">
<dt id="ucam_webauth.Request.__str__">
<tt class="descname">__str__</tt><big>(</big><em>self</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth.html#Request.__str__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.Request.__str__" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluating <tt class="docutils literal"><span class="pre">str(request_object)</span></tt> gives a query string, excluding
the <tt class="docutils literal"><span class="pre">?</span></tt></p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ucam_webauth.Response">
<em class="property">class </em><tt class="descclassname">ucam_webauth.</tt><tt class="descname">Response</tt><big>(</big><em>string</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth.html#Response"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.Response" title="Permalink to this definition">¶</a></dt>
<dd><p>A Response from the WLS</p>
<p>Constructed by parsing <cite>string</cite>, the &#8216;encoded response string&#8217; from the
WLS.</p>
<p>The Response class has the following attributes, which must be set by
subclassing it (see <a class="reference internal" href="raven.html#raven.Response" title="raven.Response"><tt class="xref py py-class docutils literal"><span class="pre">raven.Response</span></tt></a>):</p>
<dl class="attribute">
<dt id="ucam_webauth.Response.old_version_ptags">
<tt class="descname">old_version_ptags</tt><a class="headerlink" href="#ucam_webauth.Response.old_version_ptags" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="xref py py-class docutils literal"><span class="pre">set</span></tt> of <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt> objects</p>
<p>The ptags attribute is set to this value if the version of the
response is less than 3</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.keys">
<tt class="descname">keys</tt><a class="headerlink" href="#ucam_webauth.Response.keys" title="Permalink to this definition">¶</a></dt>
<dd><p>A dict mapping key identifiers (<cite>kid</cite>) to a RSA public key
(which must be an object with a <tt class="docutils literal"><span class="pre">verify(digest,</span> <span class="pre">signature)</span></tt>
method that returns a <tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt>)</p>
</dd></dl>

<p>A Response object has the following attributes:</p>
<p><strong>Always present</strong></p>
<dl class="attribute">
<dt id="ucam_webauth.Response.ver">
<tt class="descname">ver</tt><a class="headerlink" href="#ucam_webauth.Response.ver" title="Permalink to this definition">¶</a></dt>
<dd><p>response protocol version
(<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.status">
<tt class="descname">status</tt><a class="headerlink" href="#ucam_webauth.Response.status" title="Permalink to this definition">¶</a></dt>
<dd><p>response status
(<a class="reference internal" href="#ucam_webauth.Status" title="ucam_webauth.Status"><tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt></a> constant)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.msg">
<tt class="descname">msg</tt><a class="headerlink" href="#ucam_webauth.Response.msg" title="Permalink to this definition">¶</a></dt>
<dd><p>a text message describing the status of the authentication
request, suitable for display to the end-user
(<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.issue">
<tt class="descname">issue</tt><a class="headerlink" href="#ucam_webauth.Response.issue" title="Permalink to this definition">¶</a></dt>
<dd><p>response creation time
(<tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt>, timezone naive - the values are UTC)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.id">
<tt class="descname">id</tt><a class="headerlink" href="#ucam_webauth.Response.id" title="Permalink to this definition">¶</a></dt>
<dd><p>an &#8220;identifier&#8221; for the response.
(<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>)</p>
<p>The tuple (issue, id) is guaranteed to be unique</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.url">
<tt class="descname">url</tt><a class="headerlink" href="#ucam_webauth.Response.url" title="Permalink to this definition">¶</a></dt>
<dd><p>the value of <cite>url</cite> supplied in the request, or equivalently,
the URL to which this response was delivered
(<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.success">
<tt class="descname">success</tt><a class="headerlink" href="#ucam_webauth.Response.success" title="Permalink to this definition">¶</a></dt>
<dd><p>shorthand for <tt class="docutils literal"><span class="pre">status</span> <span class="pre">==</span> <span class="pre">STATUS_SUCCESS</span></tt>
(<tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt>)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.params">
<tt class="descname">params</tt><a class="headerlink" href="#ucam_webauth.Response.params" title="Permalink to this definition">¶</a></dt>
<dd><p>a copy of <cite>params</cite> from the request
(<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.signed">
<tt class="descname">signed</tt><a class="headerlink" href="#ucam_webauth.Response.signed" title="Permalink to this definition">¶</a></dt>
<dd><p>whether the signature was present and has been verified
(<tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt>)</p>
<p>Note that a present but invalid signature will produce an exception
when parsed.</p>
</dd></dl>

<p><strong>Present if authentication was successful, otherwise ``None``:</strong></p>
<dl class="attribute">
<dt>
<tt class="descname">principal:</tt></dt>
<dd><p>the authenticated identity of the user
(<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.ptags">
<tt class="descname">ptags</tt><a class="headerlink" href="#ucam_webauth.Response.ptags" title="Permalink to this definition">¶</a></dt>
<dd><p>attributes or properties of the principal
(<tt class="xref py py-class docutils literal"><span class="pre">frozenset</span></tt> of <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt> objects)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.auth">
<tt class="descname">auth</tt><a class="headerlink" href="#ucam_webauth.Response.auth" title="Permalink to this definition">¶</a></dt>
<dd><p>method of authentication used
(<a class="reference internal" href="#ucam_webauth.AuthenticationType" title="ucam_webauth.AuthenticationType"><tt class="xref py py-class docutils literal"><span class="pre">AuthenticationType</span></tt></a> constant, or <tt class="docutils literal"><span class="pre">None</span></tt>)</p>
<p>If authentication was not established by interaction (i.e., the
client was already authenticated) then <cite>auth</cite> is <tt class="docutils literal"><span class="pre">None</span></tt></p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.Response.sso">
<tt class="descname">sso</tt><a class="headerlink" href="#ucam_webauth.Response.sso" title="Permalink to this definition">¶</a></dt>
<dd><p>previous successful authentication types used
(<tt class="xref py py-class docutils literal"><span class="pre">frozenset</span></tt> of <a class="reference internal" href="#ucam_webauth.AuthenticationType" title="ucam_webauth.AuthenticationType"><tt class="xref py py-class docutils literal"><span class="pre">AuthenticationType</span></tt></a> constants)</p>
<p><cite>sso</cite> will not be the empty set if auth is <tt class="docutils literal"><span class="pre">None</span></tt></p>
</dd></dl>

<p><strong>Optional if authentication was successful, otherwise ``None``:</strong></p>
<dl class="attribute">
<dt id="ucam_webauth.Response.life">
<tt class="descname">life</tt><a class="headerlink" href="#ucam_webauth.Response.life" title="Permalink to this definition">¶</a></dt>
<dd><p>remaining life of the user&#8217;s WLS session
(<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>, in seconds)</p>
</dd></dl>

<p><strong>Required if signed is True:</strong></p>
<dl class="attribute">
<dt id="ucam_webauth.Response.kid">
<tt class="descname">kid</tt><a class="headerlink" href="#ucam_webauth.Response.kid" title="Permalink to this definition">¶</a></dt>
<dd><p>identifies the RSA key used to sign the request
(<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>)</p>
</dd></dl>

<dl class="method">
<dt id="ucam_webauth.Response.check_iact_aauth">
<tt class="descname">check_iact_aauth</tt><big>(</big><em>iact</em>, <em>aauth</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth.html#Response.check_iact_aauth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.Response.check_iact_aauth" title="Permalink to this definition">¶</a></dt>
<dd><p>Check that the WLS honoured <cite>iact</cite>, <cite>aauth</cite></p>
<p>This method checks that <cite>self.auth</cite>, <cite>self.sso</cite> are consistent with
the <cite>iact</cite> and <cite>aauth</cite>, which should be the same as the values used
to construct the <a class="reference internal" href="#ucam_webauth.Request" title="ucam_webauth.Request"><tt class="xref py py-class docutils literal"><span class="pre">Request</span></tt></a>.</p>
</dd></dl>

</dd></dl>

<div class="section" id="module-ucam_webauth.flask_glue">
<span id="flask-glue"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">flask_glue</span></tt><a class="headerlink" href="#module-ucam_webauth.flask_glue" title="Permalink to this headline">¶</a></h2>
<p>This module provides glue to make using python-raven with Flask easy</p>
<dl class="class">
<dt id="ucam_webauth.flask_glue.AuthDecorator">
<em class="property">class </em><tt class="descclassname">ucam_webauth.flask_glue.</tt><tt class="descname">AuthDecorator</tt><big>(</big><em>desc=None</em>, <em>aauth=None</em>, <em>iact=None</em>, <em>msg=None</em>, <em>max_life=7200</em>, <em>use_wls_life=False</em>, <em>inactive_timeout=None</em>, <em>issue_bounds=(15</em>, <em>5)</em>, <em>require_principal=None</em>, <em>require_ptags=frozenset({'current'})</em>, <em>can_trust_request_host=False</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of this class decorates views to add authentication.</p>
<p>To use it, you&#8217;ll need to subclass it and set response_class,
request_class and logout_url (see <a class="reference internal" href="raven.html#raven.flask_glue.AuthDecorator" title="raven.flask_glue.AuthDecorator"><tt class="xref py py-class docutils literal"><span class="pre">raven.flask_glue.AuthDecorator</span></tt></a>).
Then:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">auth_decorator</span> <span class="o">=</span> <span class="n">AuthDecorator</span><span class="p">()</span> <span class="c"># settings, e.g., desc=&quot;...&quot; go here</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&quot;/some_url&quot;</span><span class="p">)</span>
<span class="nd">@auth_decorator</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;You are &quot;</span> <span class="o">+</span> <span class="n">auth_decorator</span><span class="o">.</span><span class="n">principal</span>
</pre></div>
</div>
<p>Or to require users be authenticated for all views:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">app</span><span class="o">.</span><span class="n">before_request</span><span class="p">(</span><span class="n">auth_decorator</span><span class="o">.</span><span class="n">before_request</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that since it uses flask.session, you&#8217;ll need to set
<tt class="xref py py-attr docutils literal"><span class="pre">app.secret_key</span></tt>.</p>
<p>We need to be able to reliably determine the hostname of the current
website. This is retrieved from <tt class="xref py py-attr docutils literal"><span class="pre">flask.Request.url</span></tt>.
By default, Werkzeug will respect the value of a <tt class="docutils literal"><span class="pre">X-Forwarded-Host</span></tt>
header, which means that a man-in-the-middle can have someone authenticate
to <em>their</em> website, and forward the response from the WLS on to you.
You must either set <tt class="xref py py-attr docutils literal"><span class="pre">flask.Request.trusted_hosts</span></tt>, for example
like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">R</span><span class="p">(</span><span class="n">flask</span><span class="o">.</span><span class="n">Request</span><span class="p">):</span>
    <span class="n">trusted_hosts</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;www.danielrichman.co.uk&#39;</span><span class="p">}</span>
<span class="n">app</span><span class="o">.</span><span class="n">request_class</span> <span class="o">=</span> <span class="n">R</span>
</pre></div>
</div>
<p>... or sanitise both the <cite>Host</cite> header <em>and</em> the <cite>X-Forwarded-Host</cite>
header in your web-server. If you choose the second option, set
<cite>can_trust_request_host</cite>.</p>
<p>This tries to emulate the feel of applying mod_ucam_webauth to a file.</p>
<p>The decorator wraps the view in a function that calls
<a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.before_request" title="ucam_webauth.flask_glue.AuthDecorator.before_request"><tt class="xref py py-meth docutils literal"><span class="pre">before_request()</span></tt></a> first, calling the original view function if it
does not return a redirect or abort.</p>
<p>You may wish to catch the 401 and 403 aborts with <tt class="xref py py-attr docutils literal"><span class="pre">app.errorhandler</span></tt>.</p>
<p>The <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.principal" title="ucam_webauth.flask_glue.AuthDecorator.principal"><tt class="xref py py-attr docutils literal"><span class="pre">principal</span></tt></a>, their <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.ptags" title="ucam_webauth.flask_glue.AuthDecorator.ptags"><tt class="xref py py-attr docutils literal"><span class="pre">ptags</span></tt></a>, the <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.issue" title="ucam_webauth.flask_glue.AuthDecorator.issue"><tt class="xref py py-attr docutils literal"><span class="pre">issue</span></tt></a> and
<a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.life" title="ucam_webauth.flask_glue.AuthDecorator.life"><tt class="xref py py-attr docutils literal"><span class="pre">life</span></tt></a> from the WLS are available as attributes of the
<a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator" title="ucam_webauth.flask_glue.AuthDecorator"><tt class="xref py py-class docutils literal"><span class="pre">AuthDecorator</span></tt></a> object
(magic properties that retrieve the current values from <tt class="docutils literal"><span class="pre">flask.session</span></tt>).
Further, the attributes <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.expires" title="ucam_webauth.flask_glue.AuthDecorator.expires"><tt class="xref py py-attr docutils literal"><span class="pre">expires</span></tt></a> and <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.expires_all" title="ucam_webauth.flask_glue.AuthDecorator.expires_all"><tt class="xref py py-attr docutils literal"><span class="pre">expires_all</span></tt></a> give
information on when the ucam_webauth session will expire.</p>
<p>For the <cite>desc</cite>, <cite>aauth</cite>, <cite>iact</cite>, <cite>msg</cite> parameters, see
<a class="reference internal" href="#ucam_webauth.Request" title="ucam_webauth.Request"><tt class="xref py py-class docutils literal"><span class="pre">ucam_webauth.Request</span></tt></a>.</p>
<p>Note that the <cite>max_life</cite>, <cite>use_wls_life</cite> and <cite>inactive_timeout</cite> parameters
deal with the ucam_webauth session <cite>only</cite>; they only affect
<tt class="docutils literal"><span class="pre">flask.session[&quot;_ucam_webauth&quot;]</span></tt>. Flask&#8217;s session expiry, cookie
lifetimes, etc. are independent.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>max_life</strong> (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> (seconds) or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; upper bound on how long a successful authentication can
last before it expires and the user must reauthenticate</li>
<li><strong>use_wls_life</strong> (<tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt>) &#8211; should we lower the life of the session to the life
reported by the WLS, if it is less than <cite>max_life</cite>?</li>
<li><strong>inactive_timeout</strong> (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> (seconds) or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; expire the session if no request is processed
via this decorator in <cite>inactive_timeout</cite> seconds</li>
<li><strong>issue_bounds</strong> (<tt class="xref py py-class docutils literal"><span class="pre">tuple</span></tt>: (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>) (seconds)) &#8211; a tuple, (lower, upper) - how close the <cite>issue</cite>
(datetime that the WLS says the authentication
happened at) must be to <cite>now</cite>
(i.e., require <tt class="docutils literal"><span class="pre">now</span> <span class="pre">-</span> <span class="pre">lower</span> <span class="pre">&lt;</span> <span class="pre">issue</span> <span class="pre">&lt;</span> <span class="pre">now</span> <span class="pre">+</span> <span class="pre">upper</span></tt>;
this is a combination of two settings found in
mod_ucam_webauth: <cite>clock skew</cite> and <cite>response timeout</cite>,
<tt class="docutils literal"><span class="pre">issue_bounds=(clock_skew</span> <span class="pre">+</span> <span class="pre">response_timeout,</span>
<span class="pre">clock_skew)</span></tt> is equivalent)</li>
<li><strong>require_principal</strong> (<tt class="xref py py-class docutils literal"><span class="pre">set</span></tt> of <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>, or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; require the principal to be in the set</li>
<li><strong>require_ptags</strong> (<tt class="xref py py-class docutils literal"><span class="pre">set</span></tt> of <tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>, or <tt class="docutils literal"><span class="pre">None</span></tt>) &#8211; require the ptags to contain <cite>any</cite> string in
<cite>require_ptags</cite> (i.e., non empty intersection)</li>
<li><strong>can_trust_request_host</strong> (<tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt>) &#8211; Can we trust the hostname in
<tt class="docutils literal"><span class="pre">request.url</span></tt>?
(see <a class="reference internal" href="security.html#checking-response-values"><em>Checking response values</em></a>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>More complex customisation is possible:</p>
<ul>
<li><p class="first">override <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.check_authorised" title="ucam_webauth.flask_glue.AuthDecorator.check_authorised"><tt class="xref py py-meth docutils literal"><span class="pre">check_authorised()</span></tt></a> to do more complex
checking than <cite>require_principal</cite>, <cite>require_ptags</cite>
(note that this replaces checking <cite>require_principal</cite>, <cite>require_ptags</cite>)</p>
</li>
<li><p class="first">override <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.session_new" title="ucam_webauth.flask_glue.AuthDecorator.session_new"><tt class="xref py py-meth docutils literal"><span class="pre">session_new()</span></tt></a></p>
<p>The <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator" title="ucam_webauth.flask_glue.AuthDecorator"><tt class="xref py py-class docutils literal"><span class="pre">AuthDecorator</span></tt></a> only touches
<tt class="docutils literal"><span class="pre">flask.session[&quot;_ucam_webauth&quot;]</span></tt>.
If you&#8217;ve saved other (important) things to the session object, you
may want to clear them out when the state changes.</p>
<p>You can do this by subclassing and overriding session_new. It is called
whenever a response is received from the WLS, except if the response
is a successful re-authentication after session expiry, with the same
<cite>principal</cite> and <cite>ptags</cite> as before.</p>
</li>
</ul>
<p>To log the user out, call <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.logout" title="ucam_webauth.flask_glue.AuthDecorator.logout"><tt class="xref py py-meth docutils literal"><span class="pre">logout()</span></tt></a>, which will clear the session
state. Further, <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.logout" title="ucam_webauth.flask_glue.AuthDecorator.logout"><tt class="xref py py-meth docutils literal"><span class="pre">logout()</span></tt></a> returns a <tt class="xref py py-meth docutils literal"><span class="pre">flask.redirect()</span></tt> to the
Raven logout page. Be aware that the default flask session handlers are
susceptible to replay attacks.</p>
<p>POST requests:
Since it will redirect to the WLS and back, the auth decorator will
discard any POST data in the process. You may wish to either work
around this (by subclassing and saving it somewhere before redirecting)
or ensure that when it returns (with a GET request) to the URL, a
sensible page is displayed (the form, or an error message).</p>
<dl class="method">
<dt id="ucam_webauth.flask_glue.AuthDecorator.__call__">
<tt class="descname">__call__</tt><big>(</big><em>view_function</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.__call__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps <cite>view_function</cite> with the auth decorator</p>
<p>(<a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator" title="ucam_webauth.flask_glue.AuthDecorator"><tt class="xref py py-class docutils literal"><span class="pre">AuthDecorator</span></tt></a> objects are callable so that they can be used
as function decorators.)</p>
<p>Calling it returns a &#8216;wrapper&#8217; view function that calls
<tt class="xref py py-meth docutils literal"><span class="pre">request()</span></tt> first.</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.principal">
<tt class="descname">principal</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.principal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.principal" title="Permalink to this definition">¶</a></dt>
<dd><p>The current principal, or <tt class="docutils literal"><span class="pre">None</span></tt></p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.ptags">
<tt class="descname">ptags</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.ptags"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.ptags" title="Permalink to this definition">¶</a></dt>
<dd><p>The current ptags, or <tt class="docutils literal"><span class="pre">None</span></tt></p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.issue">
<tt class="descname">issue</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.issue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.issue" title="Permalink to this definition">¶</a></dt>
<dd><p>When the last WLS response was issued</p>
<p><cite>issue</cite> is converted to a unix timestamp (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt>), rather than
the <tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt> object used by <a class="reference internal" href="#ucam_webauth.Response" title="ucam_webauth.Response"><tt class="xref py py-class docutils literal"><span class="pre">ucam_webauth.Response</span></tt></a>.
(<cite>issue</cite> is <tt class="docutils literal"><span class="pre">None</span></tt> if there is no current session.)</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.life">
<tt class="descname">life</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.life"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.life" title="Permalink to this definition">¶</a></dt>
<dd><p>life of the last WLS response (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> seconds), or <tt class="docutils literal"><span class="pre">None</span></tt></p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.last">
<tt class="descname">last</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.last"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.last" title="Permalink to this definition">¶</a></dt>
<dd><p>Time (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> unix timestamp) of the last decorated request</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.expires">
<tt class="descname">expires</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.expires"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.expires" title="Permalink to this definition">¶</a></dt>
<dd><p>When (<tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> unix timestamp) the current auth. will expire</p>
</dd></dl>

<dl class="attribute">
<dt id="ucam_webauth.flask_glue.AuthDecorator.expires_all">
<tt class="descname">expires_all</tt><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.expires_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.expires_all" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of all things that could cause the current auth. to expire</p>
<p>A list of (<tt class="xref py py-class docutils literal"><span class="pre">str</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> unix timestamp) tuples;
(<cite>reason</cite>, <cite>when</cite>).</p>
<p><cite>reason</cite> will be one of &#8220;config max life&#8221;, &#8220;wls life&#8221; or &#8220;inactive&#8221;.</p>
</dd></dl>

<dl class="method">
<dt id="ucam_webauth.flask_glue.AuthDecorator.logout">
<tt class="descname">logout</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.logout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.logout" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the auth., and return a redirect to the WLS&#8217; logout page</p>
</dd></dl>

<dl class="method">
<dt id="ucam_webauth.flask_glue.AuthDecorator.before_request">
<tt class="descname">before_request</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.before_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.before_request" title="Permalink to this definition">¶</a></dt>
<dd><p>The &#8220;main&#8221; method</p>
<ul class="simple">
<li>checks if there is a response from the WLS<ul>
<li>checks if the current URL matches that which the WLS said it
redirected to (avoid an evil admin of another site replaying
successful authentications)</li>
<li>checks if <tt class="docutils literal"><span class="pre">flask.session</span></tt> is empty - if so, then we deduce that
the user has cookies disabled, and must abort immediately with
403 Forbidden, or we will start a redirect loop</li>
<li>checks if <cite>params</cite> matches the token we set (and saved in
<tt class="docutils literal"><span class="pre">flask.session</span></tt>) when redirecting to Raven</li>
<li>checks if the authentication method used is permitted by <cite>aauth</cite>
and user-interaction respected <cite>iact</cite> - if not, abort with
400 Bad Request</li>
<li>updates the state with the response: updating the <cite>principal</cite>,
<cite>ptags</cite> and <cite>issue</cite> information if it was a success, or
clearing them (but setting a flag - see below: 401 Authentication
Required will be thrown after redirect) if it was a failure</li>
<li>returns a redirect that removes <tt class="docutils literal"><span class="pre">WLS-Response</span></tt> from
<tt class="docutils literal"><span class="pre">request.args</span></tt></li>
</ul>
</li>
<li>checks if the &#8220;response was an authentication failure&#8221; flag is set
in <tt class="docutils literal"><span class="pre">flask.session</span></tt> - if so, clears the flag and aborts with
401 Authentication Required</li>
<li>checks to see if we are authenticated (and the session hasn&#8217;t
expired)<ul>
<li>if not, returns a redirect that will sends the user to the
WLS to authenticate</li>
</ul>
</li>
<li>checks to see if the <cite>principal</cite> / <cite>ptags</cite> are permitted<ul>
<li>if not, aborts with a 403 Forbidden</li>
</ul>
</li>
<li>updates the &#8216;last used&#8217; time in the state (to implement
<cite>inactive_timeout</cite>)</li>
</ul>
<p>Returns <tt class="docutils literal"><span class="pre">None</span></tt>, if the request should proceed to the actual
view function.</p>
</dd></dl>

<dl class="method">
<dt id="ucam_webauth.flask_glue.AuthDecorator.check_authorised">
<tt class="descname">check_authorised</tt><big>(</big><em>principal</em>, <em>ptags</em><big>)</big><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.check_authorised"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.check_authorised" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if an authenticated user is authorised.</p>
<p>The default implementation requires the principal to be in
the whitelist <tt class="xref py py-attr docutils literal"><span class="pre">require_principal</span></tt> (if it is not <tt class="docutils literal"><span class="pre">None</span></tt>, in
which case any principal is allowed) and the intersection of
<tt class="xref py py-attr docutils literal"><span class="pre">require_ptags</span></tt> and <cite>ptags</cite> to be non-empty (unless
<tt class="xref py py-attr docutils literal"><span class="pre">require_ptags</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>, in which case any ptags
(or no <cite>ptags</cite> at all) is permitted).</p>
<p>Note that the default value of <tt class="xref py py-attr docutils literal"><span class="pre">require_ptags</span></tt> in
<a class="reference internal" href="raven.html#raven.flask_glue.AuthDecorator" title="raven.flask_glue.AuthDecorator"><tt class="xref py py-class docutils literal"><span class="pre">raven.flask_glue.AuthDecorator</span></tt></a> is <tt class="docutils literal"><span class="pre">{&quot;current&quot;}</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="ucam_webauth.flask_glue.AuthDecorator.session_new">
<tt class="descname">session_new</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/ucam_webauth/flask_glue.html#AuthDecorator.session_new"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ucam_webauth.flask_glue.AuthDecorator.session_new" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when a new user authenticates</p>
<p>More specifically, when <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.principal" title="ucam_webauth.flask_glue.AuthDecorator.principal"><tt class="xref py py-attr docutils literal"><span class="pre">principal</span></tt></a> or <a class="reference internal" href="#ucam_webauth.flask_glue.AuthDecorator.ptags" title="ucam_webauth.flask_glue.AuthDecorator.ptags"><tt class="xref py py-attr docutils literal"><span class="pre">ptags</span></tt></a> changes.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">ucam_webauth</a><ul>
<li><a class="reference internal" href="#module-ucam_webauth.flask_glue"><tt class="docutils literal"><span class="pre">flask_glue</span></tt></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="modules.html"
                        title="previous chapter">python module documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="raven.html"
                        title="next chapter">raven</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/ucam_webauth.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="raven.html" title="raven"
             >next</a> |</li>
        <li class="right" >
          <a href="modules.html" title="python module documentation"
             >previous</a> |</li>
        <li><a href="index.html">python-raven 0.5.1 documentation</a> &raquo;</li>
          <li><a href="modules.html" >python module documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Daniel Richman.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>