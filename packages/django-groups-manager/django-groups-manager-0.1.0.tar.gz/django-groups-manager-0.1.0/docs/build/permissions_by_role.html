

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Resource assignment via role permissions &mdash; Django Groups Manager 0.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Django Groups Manager 0.1.0 documentation" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Django Groups Manager</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html#basic-usage">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth_integration.html">Django auth models integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings.html">Settings</a><ul>
<li class="toctree-l2"><a class="reference internal" href="settings.html#auth-model-synchronization">Auth model synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html#permissions">Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="settings.html#defaults">Defaults</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="use_cases.html">Use cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="use_cases.html#projects-management-with-proxy-models">Projects management with Proxy Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_cases.html#resource-assignment-via-role-permissions">Resource assignment via role permissions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="perms.html">Perms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO</a></li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Django Groups Manager</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Resource assignment via role permissions</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/permissions_by_role.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="resource-assignment-via-role-permissions">
<h1>Resource assignment via role permissions<a class="headerlink" href="#resource-assignment-via-role-permissions" title="Permalink to this headline">Â¶</a></h1>
<p>John Money is the commercial referent of the company; Patrick Html is the web
developer. The company has only one group, but different roles.
John can view and sell the site, and Patrick can view, change and delete the site.</p>
<p><strong>1) Define models in models.py</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Site</span><span class="p">(</span><span class="n">Group</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">((</span><span class="s">&#39;view_site&#39;</span><span class="p">,</span> <span class="s">&#39;View site&#39;</span><span class="p">),</span>
                       <span class="p">(</span><span class="s">&#39;sell_site&#39;</span><span class="p">,</span> <span class="s">&#39;Sell site&#39;</span><span class="p">),</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>2) Create models and relations</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>from groups_manager.models import Group, GroupMemberRole, Member
    from models import Site
    # Group
company = Group.objects.create(name=&#39;Company&#39;)
    # Group Member roles
commercial_referent = GroupMemberRole.objects.create(label=&#39;Commercial referent&#39;)
web_developer = GroupMemberRole.objects.create(label=&#39;Web developer&#39;)
    # Members
john = Member.objects.create(first_name=&#39;John&#39;, last_name=&#39;Money&#39;)
patrick = Member.objects.create(first_name=&#39;Patrick&#39;, last_name=&#39;Html&#39;)
    # Add to company
company.add_member(john, [commercial_referent])
company.add_member(patrick, [web_developer])
    # Create the site
site = Site.objects.create(name=&#39;Django groups manager website&#39;)
</pre></div>
</div>
<p><strong>3) Define custom permissions and assign the site object</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">custom_permissions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;owner&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;commercial-referent&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;sell&#39;</span><span class="p">],</span>
              <span class="s">&#39;web-developer&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">],</span>
              <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;view&#39;</span><span class="p">]},</span>
    <span class="s">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;view&#39;</span><span class="p">],</span>
    <span class="s">&#39;groups_upstream&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;view&#39;</span><span class="p">,</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="s">&#39;delete&#39;</span><span class="p">],</span>
    <span class="s">&#39;groups_downstream&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;view&#39;</span><span class="p">],</span>
    <span class="s">&#39;groups_siblings&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;view&#39;</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">john</span><span class="o">.</span><span class="n">assign_object</span><span class="p">(</span><span class="n">company</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">custom_permissions</span><span class="o">=</span><span class="n">custom_permissions</span><span class="p">)</span>
<span class="n">patrick</span><span class="o">.</span><span class="n">assign_object</span><span class="p">(</span><span class="n">company</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">custom_permissions</span><span class="o">=</span><span class="n">custom_permissions</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>4) Check permissions</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">john</span><span class="o">.</span><span class="n">has_perms</span><span class="p">([</span><span class="s">&#39;view_site&#39;</span><span class="p">,</span> <span class="s">&#39;sell_site&#39;</span><span class="p">],</span> <span class="n">site</span><span class="p">)</span>  <span class="c"># True</span>
<span class="n">john</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">&#39;change_site&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>  <span class="c"># False</span>
<span class="n">patrick</span><span class="o">.</span><span class="n">has_perms</span><span class="p">([</span><span class="s">&#39;view_site&#39;</span><span class="p">,</span> <span class="s">&#39;change_site&#39;</span><span class="p">,</span> <span class="s">&#39;delete_site&#39;</span><span class="p">],</span> <span class="n">site</span><span class="p">)</span>  <span class="c"># True</span>
<span class="n">patrick</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s">&#39;sell_site&#39;</span><span class="p">,</span> <span class="n">site</span><span class="p">)</span>  <span class="c"># False</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The full tested example is available in repository source code, <tt class="docutils literal"><span class="pre">testproject</span></tt>&#8216;s <tt class="docutils literal"><span class="pre">tests.py</span></tt> under <tt class="docutils literal"><span class="pre">test_roles</span></tt> method.</p>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Vittorio Zamboni.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>