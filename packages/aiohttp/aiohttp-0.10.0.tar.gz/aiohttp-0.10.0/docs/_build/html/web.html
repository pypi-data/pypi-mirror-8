<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>High-level HTTP Server &mdash; aiohttp 0.10.0-a documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.10.0-a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/aiohttp-icon.ico"/>
    <link rel="top" title="aiohttp 0.10.0-a documentation" href="index.html" />
    <link rel="next" title="Low-level HTTP Server" href="server.html" />
    <link rel="prev" title="HTTP Client" href="client.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="server.html" title="Low-level HTTP Server"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="client.html" title="HTTP Client"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">aiohttp 0.10.0-a documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-aiohttp.web">
<span id="high-level-http-server"></span><h1>High-level HTTP Server<a class="headerlink" href="#module-aiohttp.web" title="Permalink to this headline">¶</a></h1>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.10.</span></p>
</div>
<div class="section" id="run-a-simple-web-server">
<h2>Run a simple web server<a class="headerlink" href="#run-a-simple-web-server" title="Permalink to this headline">¶</a></h2>
<p>For implementing web server at first create <a class="reference internal" href="#aiohttp-web-handler"><em>request
handler</em></a>.</p>
<p>Handler is a <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a> or regular function that
accepts only <em>request</em> parameter of type <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><tt class="xref py py-class docutils literal"><span class="pre">Request</span></tt></a>
and returns <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">aiohttp</span> <span class="kn">import</span> <span class="n">web</span>

<span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;Hello, world&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next you have to create <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><tt class="xref py py-class docutils literal"><span class="pre">Application</span></tt></a> instance and register
<a class="reference internal" href="#aiohttp-web-handler"><em>handler</em></a> in application&#8217;s router pointing <em>HTTP
method</em>, <em>path</em> and <em>handler</em>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">app</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
<p>After that create server and run <em>asyncio loop</em> as usual:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">make_handler</span><span class="p">,</span> <span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
<span class="n">srv</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;serving on&#39;</span><span class="p">,</span> <span class="n">srv</span><span class="o">.</span><span class="n">sockets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getsockname</span><span class="p">())</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">run_forever</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>That&#8217;s it.</p>
</div>
<div class="section" id="handler">
<span id="aiohttp-web-handler"></span><h2>Handler<a class="headerlink" href="#handler" title="Permalink to this headline">¶</a></h2>
<p>Handler is an any <em>callable</em> that accepts single <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><tt class="xref py py-class docutils literal"><span class="pre">Request</span></tt></a>
argument and returns <a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><tt class="xref py py-class docutils literal"><span class="pre">StreamResponse</span></tt></a> derived
(e.g. <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a>) instance.</p>
<p>Handler <strong>can</strong> be a <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a>, <a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> will
<strong>unyield</strong> returned result by applying <tt class="docutils literal"><span class="pre">yield</span> <span class="pre">from</span></tt> to handler.</p>
<p>Handlers connected to <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><tt class="xref py py-class docutils literal"><span class="pre">Application</span></tt></a> via routes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">handler</span> <span class="o">=</span> <span class="n">Handler</span><span class="p">()</span>
<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p id="aiohttp-web-variable-handler">You can also use <em>variable routes</em>. If route contains string like
<tt class="docutils literal"><span class="pre">'/a/{name}/c'</span></tt> that means the route matches to path like
<tt class="docutils literal"><span class="pre">'/a/b/c'</span></tt> or <tt class="docutils literal"><span class="pre">'/a/1/c'</span></tt>.</p>
<p>Parsed <em>path part</em> will be available in <em>request handler</em> as
<tt class="docutils literal"><span class="pre">request.match_info['name']</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">variable_handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span>
        <span class="s">&quot;Hello, {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">match_info</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">))</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;/{name}&#39;</span><span class="p">,</span> <span class="n">variable_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>Handlers can be first-class functions like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">web</span><span class="o">.</span><span class="n">Response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">b</span><span class="s">&quot;Hello, world&quot;</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">router</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
</pre></div>
</div>
<p>Sometimes you would like to group logically coupled handlers into python class.</p>
<p><a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> doesn&#8217;t dictate any implementation details,
application developer can use classes if he want:</p>
<div class="highlight-python"><div class="highlight"><pre>class Handler:

    def __init__(self):
        pass

    def handle_intro(self, request):
        return web.Response(request, b&quot;Hello, world&quot;)

    @asyncio.coroutine
    def handle_greeting(self, request):
        name = request.match_info.get(&#39;name&#39;)
        txt = &quot;Hello, {}&quot;.format(name)
        return web.Response(request, txt.encode(&#39;utf-8&#39;)

handler = Handler()
app.router.add_route(&#39;GET&#39;, &#39;/intro&#39;, handler.handle_intro)
app.router.add_route(&#39;GET&#39;, &#39;/greet/{name}&#39;, handler.handle_greeting)
</pre></div>
</div>
</div>
<div class="section" id="file-uploads">
<span id="aiohttp-web-file-upload"></span><h2>File Uploads<a class="headerlink" href="#file-uploads" title="Permalink to this headline">¶</a></h2>
<p>There are two parts necessary for handling file uploads. The first is
to make sure you have a form that’s been setup correctly to accept
files. This means adding enctype attribute to your form element with
the value of <em>multipart/form-data</em>. A very simple example would be a
form that accepts an mp3 file. Notice we’ve setup the form as
previously explained and also added an <em>input</em> element of the <em>file</em>
type:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;form action=&quot;/store_mp3&quot; method=&quot;post&quot; accept-charset=&quot;utf-8&quot;
      enctype=&quot;multipart/form-data&quot;&gt;

    &lt;label for=&quot;mp3&quot;&gt;Mp3&lt;/label&gt;
    &lt;input id=&quot;mp3&quot; name=&quot;mp3&quot; type=&quot;file&quot; value=&quot;&quot; /&gt;

    &lt;input type=&quot;submit&quot; value=&quot;submit&quot; /&gt;
&lt;/form&gt;
</pre></div>
</div>
<p>The second part is handling the file upload in your <a class="reference internal" href="#aiohttp-web-handler"><em>request
handler</em></a> (above, assumed to answer on
<em>/store_mp3</em>). The uploaded file is added to the request object as
a <a class="reference internal" href="#aiohttp.web.FileField" title="aiohttp.web.FileField"><tt class="xref py py-class docutils literal"><span class="pre">FileField</span></tt></a> object accessible through the <a class="reference internal" href="#aiohttp.web.Request.POST" title="aiohttp.web.Request.POST"><tt class="xref py py-meth docutils literal"><span class="pre">Request.POST()</span></tt></a>
coroutine. The two properties we’re interested in are the <em>file</em> and
<em>filename</em> and we’ll use those to read file name and content:</p>
<div class="highlight-python"><div class="highlight"><pre>import os
import uuid
from pyramid.response import Response

def store_mp3_view(request):

    data = yield from request.POST()

    # ``filename`` contains the name of the file in string format.
    filename = data[&#39;mp3&#39;].filename

    # ``input_file`` contains the actual file data which needs to be
    # stored somewhere.

    input_file = data[&#39;mp3&#39;].file

    content = input_file.read()

    return aiohttp.web.Response(request, content,
        headers=MultiDict([(&#39;CONTENT-DISPOSITION&#39;, input-file)])
</pre></div>
</div>
</div>
<div class="section" id="request">
<span id="aiohttp-web-request"></span><h2>Request<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h2>
<p>Request object contains all information about incoming HTTP request.</p>
<p>Every <a class="reference internal" href="#aiohttp-web-handler"><em>handler</em></a> accepts request instance as first
positional parameter.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should never create <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><tt class="xref py py-class docutils literal"><span class="pre">Request</span></tt></a> instance by hands &#8211;
<a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> does it for you.</p>
</div>
<dl class="class">
<dt id="aiohttp.web.Request">
<em class="property">class </em><tt class="descclassname">aiohttp.web.</tt><tt class="descname">Request</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="aiohttp.web.Request.method">
<tt class="descname">method</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.method"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.method" title="Permalink to this definition">¶</a></dt>
<dd><p><em>HTTP method</em>, read only property.</p>
<p>The value is upper-cased <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> like <tt class="docutils literal"><span class="pre">&quot;GET&quot;</span></tt>,
<tt class="docutils literal"><span class="pre">&quot;POST&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;PUT&quot;</span></tt> etc.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.version">
<tt class="descname">version</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.version"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.version" title="Permalink to this definition">¶</a></dt>
<dd><p><em>HTTP version</em> of request, read only property.</p>
<p>Returns <a class="reference internal" href="api.html#aiohttp.protocol.HttpVersion" title="aiohttp.protocol.HttpVersion"><tt class="xref py py-class docutils literal"><span class="pre">aiohttp.protocol.HttpVersion</span></tt></a> instance.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.host">
<tt class="descname">host</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.host"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.host" title="Permalink to this definition">¶</a></dt>
<dd><p><em>HOST</em> header of request, read only property.</p>
<p>Returns <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> or <tt class="docutils literal"><span class="pre">None</span></tt> if HTTP request has no <em>HOST</em> header.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.path_qs">
<tt class="descname">path_qs</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.path_qs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.path_qs" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL including PATH_INFO and the query string. e.g, <tt class="docutils literal"><span class="pre">/app/blog?id=10</span></tt></p>
<p>Read only <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.path">
<tt class="descname">path</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.path"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.path" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL including <em>PATH INFO</em> without the host or scheme. e.g.,
<tt class="docutils literal"><span class="pre">/app/blog</span></tt></p>
<p>Read only <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.query_string">
<tt class="descname">query_string</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.query_string"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.query_string" title="Permalink to this definition">¶</a></dt>
<dd><p>The query string in the URL, e.g., <tt class="docutils literal"><span class="pre">id=10</span></tt></p>
<p>Read only <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.GET">
<tt class="descname">GET</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.GET"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.GET" title="Permalink to this definition">¶</a></dt>
<dd><p>A multidict with all the variables in the query string.</p>
<p>Read only <tt class="xref py py-class docutils literal"><span class="pre">MultiDict</span></tt> lazy property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.headers">
<tt class="descname">headers</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.headers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>A case-insensitive multidict with all headers.</p>
<p>Read only <tt class="xref py py-class docutils literal"><span class="pre">CaseInsensitiveMultiDict</span></tt>
lazy property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.keep_alive">
<tt class="descname">keep_alive</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.keep_alive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.keep_alive" title="Permalink to this definition">¶</a></dt>
<dd><p><tt class="docutils literal"><span class="pre">True</span></tt> if keep-alive connection enabled by HTTP client and
protocol version supports it, otherwise <tt class="docutils literal"><span class="pre">False</span></tt>.</p>
<p>Read only <a class="reference external" href="http://docs.python.org/3/library/functions.html#bool" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">bool</span></tt></a> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.match_info">
<tt class="descname">match_info</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.match_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.match_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only property with <tt class="xref py py-class docutils literal"><span class="pre">AbstractMatchInfo</span></tt>
instance for result of route resolving.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Exact type of property depends on used router.  If
<tt class="docutils literal"><span class="pre">app.router</span></tt> is <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><tt class="xref py py-class docutils literal"><span class="pre">UrlDispatcher</span></tt></a> the property contains
<tt class="xref py py-class docutils literal"><span class="pre">UrlMappingMatchInfo</span></tt> instance.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.app">
<tt class="descname">app</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.app"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.app" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><tt class="xref py py-class docutils literal"><span class="pre">Application</span></tt></a> instance used to call <a class="reference internal" href="#aiohttp-web-handler"><em>request handler</em></a>, read only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.transport">
<tt class="descname">transport</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.transport"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.transport" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="http://docs.python.org/3/library/asyncio-protocol.html#asyncio-transport" title="(in Python v3.4)"><em class="xref std std-ref">transport</em></a> used to process request,
read only property.</p>
<p>The property can be used, for example, for getting IP address of
client peer:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">peername</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_extra</span><span class="p">(</span><span class="s">&#39;peername&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">peername</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="n">peername</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.cookies">
<tt class="descname">cookies</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.cookies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>A multidict of all request&#8217;s cookies.</p>
<p>Read only <tt class="xref py py-class docutils literal"><span class="pre">MultiDict</span></tt> lazy property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.payload">
<tt class="descname">payload</tt><a class="reference internal" href="_modules/aiohttp/web.html#Request.payload"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.payload" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="api.html#aiohttp.streams.FlowControlStreamReader" title="aiohttp.streams.FlowControlStreamReader"><tt class="xref py py-class docutils literal"><span class="pre">FlowControlStreamReader</span></tt></a> instance,
input stream for reading request&#8217;s <em>BODY</em>.</p>
<p>Read only property.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.content_type">
<tt class="descname">content_type</tt><a class="headerlink" href="#aiohttp.web.Request.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only property with <em>content</em> part of <em>Content-Type</em> header.</p>
<p>Returns <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> like <tt class="docutils literal"><span class="pre">'text/html'</span></tt></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Returns value is <tt class="docutils literal"><span class="pre">'application/octet-stream'</span></tt> if no
Content-Type header present in HTTP headers according to
<span class="target" id="index-0"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2616.html"><strong>RFC 2616</strong></a></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.charset">
<tt class="descname">charset</tt><a class="headerlink" href="#aiohttp.web.Request.charset" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only property that specifies <em>encoding</em> for request BODY.</p>
<p>The value is parsed from <em>Content-Type</em> HTTP header.</p>
<p>Returns <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> like <tt class="docutils literal"><span class="pre">'utf-8'</span></tt> or <tt class="docutils literal"><span class="pre">None</span></tt> if
<em>Content-Type</em> has no charset information.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Request.content_length">
<tt class="descname">content_length</tt><a class="headerlink" href="#aiohttp.web.Request.content_length" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only property that returns length of request BODY.</p>
<p>The value is parsed from <em>Content-Length</em> HTTP header.</p>
<p>Returns <a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">int</span></tt></a> or <tt class="docutils literal"><span class="pre">None</span></tt> if <em>Content-Length</em> is absent.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Request.read">
<tt class="descname">read</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Request.read"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read request body, returns <a class="reference external" href="http://docs.python.org/3/library/functions.html#bytes" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">bytes</span></tt></a> object with body content.</p>
<p>The method is a <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The method doesn&#8217;t store read data internally, subsequent
<a class="reference internal" href="#aiohttp.web.Request.read" title="aiohttp.web.Request.read"><tt class="xref py py-meth docutils literal"><span class="pre">read()</span></tt></a> call will return empty bytes <tt class="docutils literal"><span class="pre">b''</span></tt>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Request.text">
<tt class="descname">text</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Request.text"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.text" title="Permalink to this definition">¶</a></dt>
<dd><p>Read request body, decode it using <a class="reference internal" href="#aiohttp.web.Request.charset" title="aiohttp.web.Request.charset"><tt class="xref py py-attr docutils literal"><span class="pre">charset</span></tt></a> encoding or
<tt class="docutils literal"><span class="pre">UTF-8</span></tt> if no encoding was specified in <em>MIME-type</em>.</p>
<p>Returns <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> with body content.</p>
<p>The method is a <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The method doesn&#8217;t store read data internally, subsequent
<a class="reference internal" href="#aiohttp.web.Request.text" title="aiohttp.web.Request.text"><tt class="xref py py-meth docutils literal"><span class="pre">text()</span></tt></a> call will return empty string <tt class="docutils literal"><span class="pre">''</span></tt>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Request.json">
<tt class="descname">json</tt><big>(</big><em>*</em>, <em>loader=json.loads</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Request.json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.json" title="Permalink to this definition">¶</a></dt>
<dd><p>Read request body decoded as <em>json</em>.</p>
<p>The method is just a boilerplate <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a>
implemented as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">loader</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">):</span>
    <span class="n">body</span> <span class="o">=</span> <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">loader</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>loader</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#callable" title="(in Python v3.4)"><em>callable</em></a>) &#8211; any callable that accepts <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a>
and returns <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> with parsed
JSON (<a class="reference external" href="http://docs.python.org/3/library/json.html#json.loads" title="(in Python v3.4)"><tt class="xref py py-func docutils literal"><span class="pre">json.loads()</span></tt></a> by default).</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The method doesn&#8217;t store read data internally, subsequent
<a class="reference internal" href="#aiohttp.web.Request.json" title="aiohttp.web.Request.json"><tt class="xref py py-meth docutils literal"><span class="pre">json()</span></tt></a> call will raise an exception.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Request.POST">
<tt class="descname">POST</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Request.POST"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.POST" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a> that reads POST parameters from
request body.</p>
<p>Returns <tt class="xref py py-class docutils literal"><span class="pre">MultiDict</span></tt> instance filled
with parsed data.</p>
<p>If <a class="reference internal" href="#aiohttp.web.Request.method" title="aiohttp.web.Request.method"><tt class="xref py py-attr docutils literal"><span class="pre">method</span></tt></a> is not <em>POST</em>, <em>PUT</em> or <em>PATCH</em> or
<a class="reference internal" href="#aiohttp.web.Request.content_type" title="aiohttp.web.Request.content_type"><tt class="xref py py-attr docutils literal"><span class="pre">content_type</span></tt></a> is not empty or
<em>application/x-www-form-urlencoded</em> or <em>multipart/form-data</em>
returns empty multidict.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The method <strong>does</strong> store read data internally, subsequent
<a class="reference internal" href="#aiohttp.web.Request.POST" title="aiohttp.web.Request.POST"><tt class="xref py py-meth docutils literal"><span class="pre">POST()</span></tt></a> call will return the same value.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Request.release">
<tt class="descname">release</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Request.release"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Request.release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release request.</p>
<p>Eat unread part of HTTP BODY if present.</p>
<p>The method is a <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">User code may never call <a class="reference internal" href="#aiohttp.web.Request.release" title="aiohttp.web.Request.release"><tt class="xref py py-meth docutils literal"><span class="pre">release()</span></tt></a>, all
required work will be processed by <a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a>
internal machinery.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="response-classes">
<span id="aiohttp-web-response"></span><h2>Response classes<a class="headerlink" href="#response-classes" title="Permalink to this headline">¶</a></h2>
<p>For now <a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> has two classes for <em>HTTP response</em>:
<a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><tt class="xref py py-class docutils literal"><span class="pre">StreamResponse</span></tt></a> and <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a>.</p>
<p>Usually you need to use the second one. <a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><tt class="xref py py-class docutils literal"><span class="pre">StreamResponse</span></tt></a>
intended for streaming data, <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a> contains <em>HTTP BODY</em> as
attribute and sends own content as single piece with correct
<em>Content-Length HTTP header</em>.</p>
<p>For sake of design decisions <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a> is derived from
<a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><tt class="xref py py-class docutils literal"><span class="pre">StreamResponse</span></tt></a> parent class.</p>
<p>The response supports <em>keep-alive</em> handling out-of-the-box if
<em>request</em> supports it.</p>
<p>You can disable <em>keep-alive</em> by <a class="reference internal" href="#aiohttp.web.StreamResponse.force_close" title="aiohttp.web.StreamResponse.force_close"><tt class="xref py py-meth docutils literal"><span class="pre">force_close()</span></tt></a> though.</p>
<p>The common case for sending answer from <a class="reference internal" href="#aiohttp-web-handler"><em>web
handler</em></a> is returning <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a> instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&quot;All right!&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="streamresponse">
<h3>StreamResponse<a class="headerlink" href="#streamresponse" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="aiohttp.web.StreamResponse">
<em class="property">class </em><tt class="descclassname">aiohttp.web.</tt><tt class="descname">StreamResponse</tt><big>(</big><em>request</em>, <em>*</em>, <em>status=200</em>, <em>reason=None</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse" title="Permalink to this definition">¶</a></dt>
<dd><p>The base class for <em>HTTP response</em> handling.</p>
<p>Contains methods for setting <em>HTTP response headers</em>, <em>cookies</em>,
<em>response status code</em>, writing <em>HTTP response BODY</em> and so on.</p>
<p>The most important thing you should know about <em>response</em> &#8212; it
is <em>Finite State Machine</em>.</p>
<p>That means you can do any manipulations on <em>headers</em>,
<em>cookies</em> and <em>status code</em> only before <a class="reference internal" href="#aiohttp.web.StreamResponse.send_headers" title="aiohttp.web.StreamResponse.send_headers"><tt class="xref py py-meth docutils literal"><span class="pre">send_headers()</span></tt></a>
called.</p>
<p>Once you call <a class="reference internal" href="#aiohttp.web.StreamResponse.send_headers" title="aiohttp.web.StreamResponse.send_headers"><tt class="xref py py-meth docutils literal"><span class="pre">send_headers()</span></tt></a> or <a class="reference internal" href="#aiohttp.web.StreamResponse.write" title="aiohttp.web.StreamResponse.write"><tt class="xref py py-meth docutils literal"><span class="pre">write()</span></tt></a> any change of
<em>HTTP header</em> part will raise <a class="reference external" href="http://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.4)"><tt class="xref py py-exc docutils literal"><span class="pre">RuntimeError</span></tt></a> exception.</p>
<p>Any <a class="reference internal" href="#aiohttp.web.StreamResponse.write" title="aiohttp.web.StreamResponse.write"><tt class="xref py py-meth docutils literal"><span class="pre">write()</span></tt></a> call after <a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><tt class="xref py py-meth docutils literal"><span class="pre">write_eof()</span></tt></a> is forbidden also.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>request</strong> (<a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><em>aiohttp.web.Request</em></a>) &#8211; HTTP request object on that the
response answers.</li>
<li><strong>status</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><em>int</em></a>) &#8211; HTTP status code, <tt class="docutils literal"><span class="pre">200</span></tt> by default.</li>
<li><strong>reason</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; HTTP reason. If param is <tt class="docutils literal"><span class="pre">None</span></tt> reason will be
calculated basing on <em>status</em>
parameter. Otherwise pass <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> with
arbitrary <em>status</em> explanation..</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.request">
<tt class="descname">request</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.request" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property for <a class="reference internal" href="#aiohttp.web.Request" title="aiohttp.web.Request"><tt class="xref py py-class docutils literal"><span class="pre">Request</span></tt></a> object used for creating
the response.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.status">
<tt class="descname">status</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.status" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property for <em>HTTP response status code</em>, <a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">int</span></tt></a>.</p>
<p><tt class="docutils literal"><span class="pre">200</span></tt> (OK) by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.reason">
<tt class="descname">reason</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.reason"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.reason" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property for <em>HTTP response reason</em>, <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.set_status">
<tt class="descname">set_status</tt><big>(</big><em>status</em>, <em>reason=None</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.set_status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.set_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Set <a class="reference internal" href="#aiohttp.web.StreamResponse.status" title="aiohttp.web.StreamResponse.status"><tt class="xref py py-attr docutils literal"><span class="pre">status</span></tt></a> and <a class="reference internal" href="#aiohttp.web.StreamResponse.reason" title="aiohttp.web.StreamResponse.reason"><tt class="xref py py-attr docutils literal"><span class="pre">reason</span></tt></a>.</p>
<p><em>reason</em> value is autocalculated if not specified (<tt class="docutils literal"><span class="pre">None</span></tt>).</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.keep_alive">
<tt class="descname">keep_alive</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.keep_alive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.keep_alive" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-only property, copy of <a class="reference internal" href="#aiohttp.web.Request.keep_alive" title="aiohttp.web.Request.keep_alive"><tt class="xref py py-attr docutils literal"><span class="pre">Request.keep_alive</span></tt></a> by default.</p>
<p>Can be switched to <tt class="docutils literal"><span class="pre">False</span></tt> by <a class="reference internal" href="#aiohttp.web.StreamResponse.force_close" title="aiohttp.web.StreamResponse.force_close"><tt class="xref py py-meth docutils literal"><span class="pre">force_close()</span></tt></a> call.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.force_close">
<tt class="descname">force_close</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.force_close"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.force_close" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable <a class="reference internal" href="#aiohttp.web.StreamResponse.keep_alive" title="aiohttp.web.StreamResponse.keep_alive"><tt class="xref py py-attr docutils literal"><span class="pre">keep_alive</span></tt></a> for connection. There are no ways to
enable it back.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.headers">
<tt class="descname">headers</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.headers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.headers" title="Permalink to this definition">¶</a></dt>
<dd><p><tt class="xref py py-class docutils literal"><span class="pre">CaseInsensitiveMultiDict</span></tt> instance
for <em>outgoing</em> <em>HTTP headers</em>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.cookies">
<tt class="descname">cookies</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.cookies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.cookies" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of <a class="reference external" href="http://docs.python.org/3/library/http.cookies.html#http.cookies.SimpleCookie" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">http.cookies.SimpleCookie</span></tt></a> for <em>outgoing</em> cookies.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Direct setting up <em>Set-Cookie</em> header may be overwritten by
explicit calls to cookie manipulation.</p>
<p class="last">We are encourage using of <a class="reference internal" href="#aiohttp.web.StreamResponse.cookies" title="aiohttp.web.StreamResponse.cookies"><tt class="xref py py-attr docutils literal"><span class="pre">cookies</span></tt></a> and
<a class="reference internal" href="#aiohttp.web.StreamResponse.set_cookie" title="aiohttp.web.StreamResponse.set_cookie"><tt class="xref py py-meth docutils literal"><span class="pre">set_cookie()</span></tt></a>, <a class="reference internal" href="#aiohttp.web.StreamResponse.del_cookie" title="aiohttp.web.StreamResponse.del_cookie"><tt class="xref py py-meth docutils literal"><span class="pre">del_cookie()</span></tt></a> for cookie
manipulations.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.set_cookie">
<tt class="descname">set_cookie</tt><big>(</big><em>name</em>, <em>value</em>, <em>*</em>, <em>expires=None</em>, <em>domain=None</em>, <em>max_age=None</em>, <em>path=None</em>, <em>secure=None</em>, <em>httponly=None</em>, <em>version=None</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.set_cookie"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.set_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenient way for setting <a class="reference internal" href="#aiohttp.web.StreamResponse.cookies" title="aiohttp.web.StreamResponse.cookies"><tt class="xref py py-attr docutils literal"><span class="pre">cookies</span></tt></a>, allows to point
additional cookie properties like <em>max_age</em> in single call.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; cookie name</li>
<li><strong>value</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; cookie value (will be converted to
<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">str</span></tt></a> if value has another type).</li>
<li><strong>expries</strong> &#8211; expiration date (optional)</li>
<li><strong>domain</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; cookie domain (optional)</li>
<li><strong>max_age</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><em>int</em></a>) &#8211; defines the lifetime of the cookie, in
seconds.  The delta-seconds value is a
decimal non- negative integer.  After
delta-seconds seconds elapse, the client
should discard the cookie.  A value of zero
means the cookie should be discarded
immediately.  (optional)</li>
<li><strong>path</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; specifies the subset of URLs to
which this cookie applies. (optional)</li>
<li><strong>secure</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#bool" title="(in Python v3.4)"><em>bool</em></a>) &#8211; attribute (with no value) directs
the user agent to use only (unspecified)
secure means to contact the origin server
whenever it sends back this cookie.
The user agent (possibly under the user&#8217;s
control) may determine what level of
security it considers appropriate for
&#8220;secure&#8221; cookies.  The <em>secure</em> should be
considered security advice from the server
to the user agent, indicating that it is in
the session&#8217;s interest to protect the cookie
contents. (optional)</li>
<li><strong>httponly</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#bool" title="(in Python v3.4)"><em>bool</em></a>) &#8211; <tt class="docutils literal"><span class="pre">True</span></tt> if the cookie HTTP only (optional)</li>
<li><strong>version</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><em>int</em></a>) &#8211; a decimal integer, identifies to which
version of the state management
specification the cookie
conforms. (Optional, <em>version=1</em> by default)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.del_cookie">
<tt class="descname">del_cookie</tt><big>(</big><em>name</em>, <em>*</em>, <em>domain=None</em>, <em>path=None</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.del_cookie"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.del_cookie" title="Permalink to this definition">¶</a></dt>
<dd><p>Deletes cookie.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; cookie name</li>
<li><strong>domain</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; optional cookie domain</li>
<li><strong>path</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; optional cookie path</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.content_length">
<tt class="descname">content_length</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.content_length"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.content_length" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Content-Length</em> for outgoing response.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.content_type">
<tt class="descname">content_type</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.content_type"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Content</em> part of <em>Content-Type</em> for outgoing response.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.StreamResponse.charset">
<tt class="descname">charset</tt><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.charset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.charset" title="Permalink to this definition">¶</a></dt>
<dd><p><em>Charset</em> aka <em>encoding</em> part of <em>Content-Type</em> for outgoing response.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.send_headers">
<tt class="descname">send_headers</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.send_headers"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.send_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Send <em>HTTP header</em>. You should not change any header data after
calling the method.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.write">
<tt class="descname">write</tt><big>(</big><em>data</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.write"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Send byte-ish data as part of <em>response BODY</em>.</p>
<p>Calls <a class="reference internal" href="#aiohttp.web.StreamResponse.send_headers" title="aiohttp.web.StreamResponse.send_headers"><tt class="xref py py-meth docutils literal"><span class="pre">send_headers()</span></tt></a> if not been called.</p>
<p>Raises <a class="reference external" href="http://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.4)"><tt class="xref py py-exc docutils literal"><span class="pre">TypeError</span></tt></a> if data is not <a class="reference external" href="http://docs.python.org/3/library/functions.html#bytes" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">bytes</span></tt></a>,
<a class="reference external" href="http://docs.python.org/3/library/functions.html#bytearray" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">bytearray</span></tt></a> or <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#memoryview" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">memoryview</span></tt></a> instance.</p>
<p>Raises <a class="reference external" href="http://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.4)"><tt class="xref py py-exc docutils literal"><span class="pre">RuntimeError</span></tt></a> if <a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><tt class="xref py py-meth docutils literal"><span class="pre">write_eof()</span></tt></a> has been called.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.StreamResponse.write_eof">
<tt class="descname">write_eof</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#StreamResponse.write_eof"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.StreamResponse.write_eof" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a> <em>may</em> be called as mark of finish
<em>HTTP response</em> processing.</p>
<p><em>Internal machinery</em> will call the method at the end of request
processing if needed.</p>
<p>After <a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><tt class="xref py py-meth docutils literal"><span class="pre">write_eof()</span></tt></a> call any manipulations with <em>response</em>
object are forbidden.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="response">
<h3>Response<a class="headerlink" href="#response" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="aiohttp.web.Response">
<em class="property">class </em><tt class="descclassname">aiohttp.web.</tt><tt class="descname">Response</tt><big>(</big><em>request</em>, <em>body=None</em>, <em>*</em>, <em>status=200</em>, <em>headers=None</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Response"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Response" title="Permalink to this definition">¶</a></dt>
<dd><p>The most usable response class, inherited from <a class="reference internal" href="#aiohttp.web.StreamResponse" title="aiohttp.web.StreamResponse"><tt class="xref py py-class docutils literal"><span class="pre">StreamResponse</span></tt></a>.</p>
<p>Accepts <em>body</em> argument for setting <em>HTTP response BODY</em>.</p>
<p>Actual <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><tt class="xref py py-attr docutils literal"><span class="pre">body</span></tt></a> sending is done in overridden
<a class="reference internal" href="#aiohttp.web.StreamResponse.write_eof" title="aiohttp.web.StreamResponse.write_eof"><tt class="xref py py-meth docutils literal"><span class="pre">write_eof()</span></tt></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>request</strong> (<em>Request</em>) &#8211; <em>HTTP request</em> object used for creation the response.</li>
<li><strong>body</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#bytes" title="(in Python v3.4)"><em>bytes</em></a>) &#8211; response&#8217;s BODY</li>
<li><strong>status</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#int" title="(in Python v3.4)"><em>int</em></a>) &#8211; HTTP status code, 200 OK by default.</li>
<li><strong>headers</strong> (<a class="reference external" href="http://docs.python.org/3/library/collections.abc.html#collections.abc.Mapping" title="(in Python v3.4)"><em>collections.abc.Mapping</em></a>) &#8211; HTTP headers that should be added to
response&#8217;s ones.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="aiohttp.web.Response.body">
<tt class="descname">body</tt><a class="reference internal" href="_modules/aiohttp/web.html#Response.body"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Response.body" title="Permalink to this definition">¶</a></dt>
<dd><p>Read-write attribute for storing response&#8217;s content aka BODY,
<a class="reference external" href="http://docs.python.org/3/library/functions.html#bytes" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">bytes</span></tt></a>.</p>
<p>Setting <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><tt class="xref py py-attr docutils literal"><span class="pre">body</span></tt></a> also recalculates
<a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><tt class="xref py py-attr docutils literal"><span class="pre">content_length</span></tt></a> value.</p>
<p>Resetting <a class="reference internal" href="#aiohttp.web.Response.body" title="aiohttp.web.Response.body"><tt class="xref py py-attr docutils literal"><span class="pre">body</span></tt></a> (assigning <tt class="docutils literal"><span class="pre">None</span></tt>) set
<a class="reference internal" href="#aiohttp.web.StreamResponse.content_length" title="aiohttp.web.StreamResponse.content_length"><tt class="xref py py-attr docutils literal"><span class="pre">content_length</span></tt></a> to <tt class="docutils literal"><span class="pre">None</span></tt> also, dropping
<em>Content-Length</em> HTTP header.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="application-and-router">
<h2>Application and Router<a class="headerlink" href="#application-and-router" title="Permalink to this headline">¶</a></h2>
<div class="section" id="application">
<h3>Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h3>
<p>Application is a synonym for web-server.</p>
<p>To get fully working example you have to make <em>application</em>, register
supported url in <em>router</em> and create <em>server socket</em> with
<tt class="xref py py-meth docutils literal"><span class="pre">make_handler()</span></tt> as <em>protocol factory</em>.</p>
<p><em>Application</em> contains <em>router</em> instance and list of callbacks that
will be called on application finishing.</p>
<p><em>Application</em> is a <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>, so you can use it as registry for
arbitrary properies for later acceess to registered values from
<a class="reference internal" href="#aiohttp-web-handler"><em>handler</em></a> via <a class="reference internal" href="#aiohttp.web.Request.app" title="aiohttp.web.Request.app"><tt class="xref py py-attr docutils literal"><span class="pre">Request.app</span></tt></a> property:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>
<span class="n">app</span><span class="p">[</span><span class="s">&#39;database&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">yield from</span> <span class="n">aiopg</span><span class="o">.</span><span class="n">create_engine</span><span class="p">(</span><span class="o">**</span><span class="n">db_config</span><span class="p">)</span>

<span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">with</span> <span class="p">(</span><span class="k">yield from</span> <span class="n">request</span><span class="o">.</span><span class="n">app</span><span class="p">[</span><span class="s">&#39;database&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;DELETE * FROM table&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="aiohttp.web.Application">
<em class="property">class </em><tt class="descclassname">aiohttp.web.</tt><tt class="descname">Application</tt><big>(</big><em>*</em>, <em>loop=None</em>, <em>router=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Application"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Application" title="Permalink to this definition">¶</a></dt>
<dd><p>The class inherits <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>loop</strong> &#8211; <p><a class="reference external" href="http://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.4)"><em class="xref std std-ref">event loop</em></a> used
for processing HTTP requests.</p>
<p>If param is <tt class="docutils literal"><span class="pre">None</span></tt> <a class="reference external" href="http://docs.python.org/3/library/asyncio-eventloops.html#asyncio.get_event_loop" title="(in Python v3.4)"><tt class="xref py py-func docutils literal"><span class="pre">asyncio.get_event_loop()</span></tt></a>
used for getting default event loop, but we strongly
recommend to use explicit loops everywhere.</p>
</li>
<li><strong>router</strong> &#8211; <tt class="xref py py-class docutils literal"><span class="pre">aiohttp.abc.AbstractRouter</span></tt> instance, system
creates <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><tt class="xref py py-class docutils literal"><span class="pre">UrlDispatcher</span></tt></a> by default if
<em>router</em> is <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li><strong>kwargs</strong> &#8211; <a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">dict</span></tt></a> of optional arguments that will be
passed to underlying
<a class="reference internal" href="api.html#aiohttp.server.ServerHttpProtocol" title="aiohttp.server.ServerHttpProtocol"><tt class="xref py py-class docutils literal"><span class="pre">aiohttp.server.ServerHttpProtocol</span></tt></a>
constructor at <a class="reference internal" href="#aiohttp.web.Application.make_handler" title="aiohttp.web.Application.make_handler"><tt class="xref py py-meth docutils literal"><span class="pre">make_handler()</span></tt></a> call.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="aiohttp.web.Application.router">
<tt class="descname">router</tt><a class="reference internal" href="_modules/aiohttp/web.html#Application.router"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Application.router" title="Permalink to this definition">¶</a></dt>
<dd><p>Readonly property that returns <em>router instance</em>.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.Application.loop">
<tt class="descname">loop</tt><a class="reference internal" href="_modules/aiohttp/web.html#Application.loop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Application.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Readonly property that returns <a class="reference external" href="http://docs.python.org/3/library/asyncio-eventloop.html#asyncio-event-loop" title="(in Python v3.4)"><em class="xref std std-ref">event loop</em></a>.</p>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.make_handler">
<tt class="descname">make_handler</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Application.make_handler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Application.make_handler" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates HTTP protocol for handling requests.</p>
<p>You should never call the method by hands but pass it to
<a class="reference external" href="http://docs.python.org/3/library/asyncio-eventloop.html#asyncio.BaseEventLoop.create_server" title="(in Python v3.4)"><tt class="xref py py-meth docutils literal"><span class="pre">create_server()</span></tt></a> instead as
<em>protocol_factory</em> parameter like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">loop</span><span class="o">=</span><span class="n">loop</span><span class="p">)</span>

<span class="c"># setup route table</span>
<span class="c"># app.router.add_route(...)</span>

<span class="k">yield from</span> <span class="n">loop</span><span class="o">.</span><span class="n">create_server</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">make_handler</span><span class="p">,</span> <span class="s">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.Application.finish">
<tt class="descname">finish</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#Application.finish"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.Application.finish" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a> that should be called after on
server stopping.</p>
<p>The method executes functions registered by
<tt class="xref py py-meth docutils literal"><span class="pre">register_on_finish()</span></tt> in LIFO order.</p>
<p>If callback raises exception the error will be stored by
<a class="reference external" href="http://docs.python.org/3/library/asyncio-eventloop.html#asyncio.BaseEventLoop.call_exception_handler" title="(in Python v3.4)"><tt class="xref py py-meth docutils literal"><span class="pre">call_exception_handler()</span></tt></a> with keys:
<em>message</em>, <em>exception</em>, <em>application</em>.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">register_on_finish(self, func, *args, **kwargs):</tt></dt>
<dd><p>Register <em>func</em> as a function to be executed at termination.
Any optional arguments that are to be passed to <em>func</em> must be
passed as arguments to <tt class="xref py py-meth docutils literal"><span class="pre">register_on_finish()</span></tt>.  It is possible to
register the same function and arguments more than once.</p>
<p>At call of <a class="reference internal" href="#aiohttp.web.Application.finish" title="aiohttp.web.Application.finish"><tt class="xref py py-meth docutils literal"><span class="pre">finish()</span></tt></a> all functions registered are called in
last in, first out order.</p>
<p><em>func</em> may be either regular function or <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a>,
<a class="reference internal" href="#aiohttp.web.Application.finish" title="aiohttp.web.Application.finish"><tt class="xref py py-meth docutils literal"><span class="pre">finish()</span></tt></a> will un-yield (<cite>yield from</cite>) the later.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="router">
<h3>Router<a class="headerlink" href="#router" title="Permalink to this headline">¶</a></h3>
<p>For dispatching URLs to <a class="reference internal" href="#aiohttp-web-handler"><em>handlers</em></a>
<a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> uses <em>routers</em>.</p>
<p>Router is any object that implements <tt class="xref py py-class docutils literal"><span class="pre">AbstractRouter</span></tt> interface.</p>
<p><a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> provides single implementation called <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><tt class="xref py py-class docutils literal"><span class="pre">UrlDispatcher</span></tt></a>.</p>
<p><a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><tt class="xref py py-class docutils literal"><span class="pre">Application</span></tt></a> uses <a class="reference internal" href="#aiohttp.web.UrlDispatcher" title="aiohttp.web.UrlDispatcher"><tt class="xref py py-class docutils literal"><span class="pre">UrlDispatcher</span></tt></a> as <tt class="xref py py-meth docutils literal"><span class="pre">router()</span></tt> by default.</p>
<dl class="class">
<dt id="aiohttp.web.UrlDispatcher">
<em class="property">class </em><tt class="descclassname">aiohttp.web.</tt><tt class="descname">UrlDispatcher</tt><a class="reference internal" href="_modules/aiohttp/web.html#UrlDispatcher"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.UrlDispatcher" title="Permalink to this definition">¶</a></dt>
<dd><p>Straightforward url-mathing router.</p>
<p>Before running <a class="reference internal" href="#aiohttp.web.Application" title="aiohttp.web.Application"><tt class="xref py py-class docutils literal"><span class="pre">Application</span></tt></a> you should to fill <em>route
table</em> first by <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_route" title="aiohttp.web.UrlDispatcher.add_route"><tt class="xref py py-meth docutils literal"><span class="pre">add_route()</span></tt></a> and <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><tt class="xref py py-meth docutils literal"><span class="pre">add_static()</span></tt></a> calls.</p>
<p><a class="reference internal" href="#aiohttp-web-handler"><em>Handler</em></a> lookup is performed by iterating on
added <em>routes</em> in FIFO order. The first matching <em>route</em> will be used
to call corresponding <em>handler</em>.</p>
<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_route">
<tt class="descname">add_route</tt><big>(</big><em>method</em>, <em>path</em>, <em>handler</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#UrlDispatcher.add_route"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_route" title="Permalink to this definition">¶</a></dt>
<dd><p>Append <a class="reference internal" href="#aiohttp-web-handler"><em>handler</em></a> to end of route table.</p>
<dl class="docutils">
<dt><em>path</em> may be either <em>contant</em> string like <tt class="docutils literal"><span class="pre">'/a/b/c'</span></tt> or</dt>
<dd><em>variable rule</em> like <tt class="docutils literal"><span class="pre">'/a/{var}'</span></tt> (see
<a class="reference internal" href="#aiohttp-web-variable-handler"><em>handling variable pathes</em></a>)</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; route path</li>
<li><strong>handler</strong> (<a class="reference external" href="http://docs.python.org/3/library/functions.html#callable" title="(in Python v3.4)"><em>callable</em></a>) &#8211; route handler</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.add_static">
<tt class="descname">add_static</tt><big>(</big><em>prefix</em>, <em>path</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#UrlDispatcher.add_static"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.UrlDispatcher.add_static" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds router for returning static files.</p>
<p>Useful for handling static content like images, java script and css files.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Use <a class="reference internal" href="#aiohttp.web.UrlDispatcher.add_static" title="aiohttp.web.UrlDispatcher.add_static"><tt class="xref py py-meth docutils literal"><span class="pre">add_static()</span></tt></a> for development only, in production
static content usually processed by web servers like <em>nginx</em>
or <em>apache</em>.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>prefix</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; URL path prefix for handled static files</li>
<li><strong>path</strong> (<a class="reference external" href="http://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.4)"><em>str</em></a>) &#8211; path to folder in file system that contains
handled static files.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="aiohttp.web.UrlDispatcher.resolve">
<tt class="descname">resolve</tt><big>(</big><em>requst</em><big>)</big><a class="reference internal" href="_modules/aiohttp/web.html#UrlDispatcher.resolve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#aiohttp.web.UrlDispatcher.resolve" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="http://docs.python.org/3/library/asyncio-task.html#coroutine" title="(in Python v3.4)"><em class="xref std std-ref">coroutine</em></a> that returns
<tt class="xref py py-class docutils literal"><span class="pre">AbstractMatchInfo</span></tt> for <em>request</em> or raises http
exception like <tt class="xref py py-exc docutils literal"><span class="pre">HTTPNotFound</span></tt> if there is no registered
route for <em>request</em>.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="utilities">
<h2>Utilities<a class="headerlink" href="#utilities" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="aiohttp.web.FileField">
<em class="property">class </em><tt class="descclassname">aiohttp.web.</tt><tt class="descname">FileField</tt><a class="headerlink" href="#aiohttp.web.FileField" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="http://docs.python.org/3/library/collections.html#collections.namedtuple" title="(in Python v3.4)"><tt class="xref py py-func docutils literal"><span class="pre">namedtuple()</span></tt></a> that returned as multidict value
by <a class="reference internal" href="#aiohttp.web.Request.POST" title="aiohttp.web.Request.POST"><tt class="xref py py-meth docutils literal"><span class="pre">Request.POST()</span></tt></a> if field is uploaded file.</p>
<dl class="attribute">
<dt id="aiohttp.web.FileField.name">
<tt class="descname">name</tt><a class="headerlink" href="#aiohttp.web.FileField.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Field name</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.FileField.filename">
<tt class="descname">filename</tt><a class="headerlink" href="#aiohttp.web.FileField.filename" title="Permalink to this definition">¶</a></dt>
<dd><p>File name as specified by uploading (client) side.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.FileField.file">
<tt class="descname">file</tt><a class="headerlink" href="#aiohttp.web.FileField.file" title="Permalink to this definition">¶</a></dt>
<dd><p>An <a class="reference external" href="http://docs.python.org/3/library/io.html#io.IOBase" title="(in Python v3.4)"><tt class="xref py py-class docutils literal"><span class="pre">io.IOBase</span></tt></a> instance with content of uploaded file.</p>
</dd></dl>

<dl class="attribute">
<dt id="aiohttp.web.FileField.content_type">
<tt class="descname">content_type</tt><a class="headerlink" href="#aiohttp.web.FileField.content_type" title="Permalink to this definition">¶</a></dt>
<dd><p><em>MIME type</em> of uploaded file, <tt class="docutils literal"><span class="pre">'text/plain'</span></tt> by default.</p>
</dd></dl>

<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="#aiohttp-web-file-upload"><em>File Uploads</em></a></p>
</div>
</dd></dl>

</div>
<div class="section" id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#module-aiohttp.web" title="aiohttp.web"><tt class="xref py py-mod docutils literal"><span class="pre">aiohttp.web</span></tt></a> defines exceptions for list of <em>HTTP status codes</em>.</p>
<p>Each class relates to a single HTTP status code.  Each class is a
subclass of the <tt class="xref py py-class docutils literal"><span class="pre">HTTPException</span></tt>.</p>
<p>Those exceptions are derived from <a class="reference internal" href="#aiohttp.web.Response" title="aiohttp.web.Response"><tt class="xref py py-class docutils literal"><span class="pre">Response</span></tt></a> also, so you can
eighter return exception object from <a class="reference internal" href="#aiohttp-web-handler"><em>Handler</em></a> or raise it.</p>
<p>The follow snippets are equals:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">HTTPFound</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;/redirect&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@asyncio.coroutine</span>
<span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">raise</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">web</span><span class="o">.</span><span class="n">HTTPFound</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&#39;/redirect&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Each exception class has a status code according to <span class="target" id="index-1"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2068.html"><strong>RFC 2068</strong></a>:
codes with 100-300 are not really errors; 400s are client errors,
and 500s are server errors.</p>
<p>Http Exception hierarchy chart:</p>
<div class="highlight-python"><div class="highlight"><pre>Exception
  HTTPException
    HTTPSuccessful
      * 200 - HTTPOk
      * 201 - HTTPCreated
      * 202 - HTTPAccepted
      * 203 - HTTPNonAuthoritativeInformation
      * 204 - HTTPNoContent
      * 205 - HTTPResetContent
      * 206 - HTTPPartialContent
    HTTPRedirection
      * 300 - HTTPMultipleChoices
      * 301 - HTTPMovedPermanently
      * 302 - HTTPFound
      * 303 - HTTPSeeOther
      * 304 - HTTPNotModified
      * 305 - HTTPUseProxy
      * 307 - HTTPTemporaryRedirect
    HTTPError
      HTTPClientError
        * 400 - HTTPBadRequest
        * 401 - HTTPUnauthorized
        * 402 - HTTPPaymentRequired
        * 403 - HTTPForbidden
        * 404 - HTTPNotFound
        * 405 - HTTPMethodNotAllowed
        * 406 - HTTPNotAcceptable
        * 407 - HTTPProxyAuthenticationRequired
        * 408 - HTTPRequestTimeout
        * 409 - HTTPConflict
        * 410 - HTTPGone
        * 411 - HTTPLengthRequired
        * 412 - HTTPPreconditionFailed
        * 413 - HTTPRequestEntityTooLarge
        * 414 - HTTPRequestURITooLong
        * 415 - HTTPUnsupportedMediaType
        * 416 - HTTPRequestRangeNotSatisfiable
        * 417 - HTTPExpectationFailed
      HTTPServerError
        * 500 - HTTPInternalServerError
        * 501 - HTTPNotImplemented
        * 502 - HTTPBadGateway
        * 503 - HTTPServiceUnavailable
        * 504 - HTTPGatewayTimeout
        * 505 - HTTPVersionNotSupported
</pre></div>
</div>
<p>All http exceptions has constructor like:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTPNotFound(request, *, headers=None, reason=None)
</pre></div>
</div>
<p>if other not directly specified. <em>headers</em> will be added to <em>default
response headers</em>.</p>
<p>Classes <tt class="xref py py-class docutils literal"><span class="pre">HTTPMultipleChoices</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">HTTPMovedPermanently</span></tt>,
<tt class="xref py py-class docutils literal"><span class="pre">HTTPFound</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">HTTPSeeOther</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">HTTPUseProxy</span></tt>,
<tt class="xref py py-class docutils literal"><span class="pre">HTTPTemporaryRedirect</span></tt> has constructor signature like:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTPFound(request, location, *, headers=None, reason=None)
</pre></div>
</div>
<p>where <em>location</em> is value for <em>Location HTTP header</em>.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">HTTPMethodNotAllowed</span></tt> constructed with pointing trial method
and list of allowed methods:</p>
<div class="highlight-python"><div class="highlight"><pre>HTTPMethodNotAllowed(request, method, allowed_methods, *, headers=None, reason=None)
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/aiohttp-icon.svg" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">High-level HTTP Server</a><ul>
<li><a class="reference internal" href="#run-a-simple-web-server">Run a simple web server</a></li>
<li><a class="reference internal" href="#handler">Handler</a></li>
<li><a class="reference internal" href="#file-uploads">File Uploads</a></li>
<li><a class="reference internal" href="#request">Request</a></li>
<li><a class="reference internal" href="#response-classes">Response classes</a><ul>
<li><a class="reference internal" href="#streamresponse">StreamResponse</a></li>
<li><a class="reference internal" href="#response">Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#application-and-router">Application and Router</a><ul>
<li><a class="reference internal" href="#application">Application</a></li>
<li><a class="reference internal" href="#router">Router</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utilities">Utilities</a></li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="client.html"
                        title="previous chapter">HTTP Client</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="server.html"
                        title="next chapter">Low-level HTTP Server</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/web.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="server.html" title="Low-level HTTP Server"
             >next</a> |</li>
        <li class="right" >
          <a href="client.html" title="HTTP Client"
             >previous</a> |</li>
        <li><a href="index.html">aiohttp 0.10.0-a documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, KeepSafe.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>