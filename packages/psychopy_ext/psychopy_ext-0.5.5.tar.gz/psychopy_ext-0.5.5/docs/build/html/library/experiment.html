<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Create an experiment with exp &mdash; psychopy_ext 0.5.4 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="psychopy_ext 0.5.4 documentation" href="../index.html" />
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <link rel="shortcut icon" href="../_static/favicon.ico">
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="description" content="A framework for a rapid reproducible design, analysis and plotting of experiments in neuroscience and psychology">
  <meta name="author" content="Jonas Kubilius">

  </head>
  <body>

  <!-- Navigation
  ========================================== -->
  
  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          psychopy_ext 0.5.4</a>
<!--
        <span class="navbar-text navbar-version pull-left"><b>0.5.4</b></span>
-->
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            <li><a href="../intro/index.html">Quick intro</a></li>
            <li><a href="index.html">Tutorial</a></li>
            <li><a href="../api/index.html">API</a></li>
            <li><a href="https://github.com/qbilius/psychopy_ext">GitHub</a></li>
<!--
            
              <h3><a href="../index.html">Table Of Contents</a></h3>

              
            
-->
<!--
            
            
            
            
-->
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>


  
    <div class="container">
      <div class="row">
        <!-- Sidebar1
        ========================================== -->
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  
  <ul>
<li><a class="reference internal" href="#">Create an experiment with <tt class="docutils literal"><span class="pre">exp</span></tt></a><ul>
<li><a class="reference internal" href="#importing-computer-settings">Importing computer settings</a></li>
<li><a class="reference internal" href="#setting-up-paths-set-paths">Setting up paths: <tt class="docutils literal"><span class="pre">set_paths()</span></tt></a></li>
<li><a class="reference internal" href="#the-experiment-experiment">The experiment: <tt class="docutils literal"><span class="pre">Experiment</span></tt></a><ul>
<li><a class="reference internal" href="#initialization-init">Initialization: <tt class="docutils literal"><span class="pre">__init__()</span></tt></a></li>
<li><a class="reference internal" href="#setup-setup">Setup: <tt class="docutils literal"><span class="pre">setup()</span></tt></a></li>
<li><a class="reference internal" href="#run-run">Run: <tt class="docutils literal"><span class="pre">run()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-tasks-task">Defining tasks: <tt class="docutils literal"><span class="pre">Task</span></tt></a><ul>
<li><a class="reference internal" href="#create-stimuli-create-stimuli">Create stimuli: <tt class="docutils literal"><span class="pre">create_stimuli()</span></tt></a></li>
<li><a class="reference internal" href="#create-trial-structure-create-trial">Create trial structure: <tt class="docutils literal"><span class="pre">create_trial()</span></tt></a></li>
<li><a class="reference internal" href="#create-an-experiment-plan-create-exp-plan">Create an experiment plan: <tt class="docutils literal"><span class="pre">create_exp_plan()</span></tt></a></li>
<li><a class="reference internal" href="#setup-setup-task">Setup: <tt class="docutils literal"><span class="pre">setup_task()</span></tt></a></li>
<li><a class="reference internal" href="#running-task-run-task">Running task: <tt class="docutils literal"><span class="pre">run_task()</span></tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#committing-and-pushing-data-to-a-repository">Committing and pushing data to a repository</a><ul>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#what-s-available">What&#8217;s available</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-features">Other features</a><ul>
<li><a class="reference internal" href="#autorun">Autorun</a></li>
<li><a class="reference internal" href="#no-output">No output</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-analysis-class">Data analysis class</a></li>
</ul>
</li>
</ul>

<div id="sourcelink">
<!--
  <a href="../_sources/library/experiment.txt"
     rel="nofollow">Source</a> |
-->
  <a href="https://github.com/qbilius/psychopy_ext/blob/master/docs/source/library\experiment.rst"
     rel="nofollow">Show on GitHub</a> |
  <a href="https://github.com/qbilius/psychopy_ext/edit/master/docs/source/library\experiment.rst"
     rel="nofollow">Edit on GitHub</a>
</div>
<form action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
        </div>
      </div>

        <!-- Main content
        ========================================== -->
        <div class="col-md-9">
          
  <div class="section" id="create-an-experiment-with-exp">
<span id="exp"></span><h1>Create an experiment with <a class="reference internal" href="../api/index.html#module-psychopy_ext.exp" title="psychopy_ext.exp"><tt class="xref py py-mod docutils literal"><span class="pre">exp</span></tt></a><a class="headerlink" href="#create-an-experiment-with-exp" title="Permalink to this headline">¶</a></h1>
<p>Each experiment is a module (i.e., a &#8216;.py&#8217; script). Usually, it does at least the following:</p>
<ul class="simple">
<li>imports computer settings (<tt class="docutils literal"><span class="pre">import</span> <span class="pre">computer</span></tt>), see <a class="reference internal" href="computer.html#computer"><em>Computer setup</em></a></li>
<li>sets up paths (<tt class="docutils literal"><span class="pre">PATH</span></tt> variable)</li>
<li>defines a stimuli presentation class (inherited from <tt class="xref py py-class docutils literal"><span class="pre">Experiment</span></tt>)</li>
<li>defines an analysis class (inherited from <tt class="xref py py-class docutils literal"><span class="pre">object</span></tt> or, for fMRI analyses, inherited from  <tt class="xref py py-class docutils literal"><span class="pre">Analysis</span></tt>).</li>
</ul>
<p>Let&#8217;s see how it works out in our demo file (<tt class="docutils literal"><span class="pre">demos/scripts/main.py</span></tt>).</p>
<div class="section" id="importing-computer-settings">
<h2>Importing computer settings<a class="headerlink" href="#importing-computer-settings" title="Permalink to this headline">¶</a></h2>
<p>As discussed in <a class="reference internal" href="computer.html#computer"><em>Computer setup</em></a>, <tt class="docutils literal"><span class="pre">psychopy_ext</span></tt> encourages users to keep computer settings in a plain text file (<tt class="docutils literal"><span class="pre">computer.py</span></tt>) in the same folder as your scripts (so typically in the <tt class="docutils literal"><span class="pre">scripts/</span></tt> folder). Import this file at the top of your experiment so that all classes could use it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">computer</span>
</pre></div>
</div>
<p>If you need to modify certain settings (e.g., <tt class="docutils literal"><span class="pre">valid_responses</span></tt> that defines keyboard keys that are allowed for responding), do so during the initialization of your class (see <a class="reference internal" href="#exp-init"><em>Initialization: __init__()</em></a>)</p>
</div>
<div class="section" id="setting-up-paths-set-paths">
<span id="set-paths"></span><h2>Setting up paths: <a class="reference internal" href="../api/generated/psychopy_ext.exp.set_paths.html#psychopy_ext.exp.set_paths" title="psychopy_ext.exp.set_paths"><tt class="xref py py-func docutils literal"><span class="pre">set_paths()</span></tt></a><a class="headerlink" href="#setting-up-paths-set-paths" title="Permalink to this headline">¶</a></h2>
<p>Paths specify where various bits of project information (data, logs etc) should be stored. The default is the following (found in <a class="reference internal" href="../api/generated/psychopy_ext.exp.set_paths.html#psychopy_ext.exp.set_paths" title="psychopy_ext.exp.set_paths"><tt class="xref py py-func docutils literal"><span class="pre">set_paths()</span></tt></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">set_paths</span><span class="p">(</span><span class="n">exp_root</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">computer</span><span class="o">=</span><span class="n">default_computer</span><span class="p">,</span> <span class="n">fmri_rel</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="n">fmri_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">computer</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">fmri_rel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">exp_root</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">exp_root</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;root&#39;</span><span class="p">:</span> <span class="n">computer</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
        <span class="s">&#39;exp_root&#39;</span><span class="p">:</span> <span class="n">exp_root</span><span class="p">,</span>
        <span class="s">&#39;fmri_root&#39;</span><span class="p">:</span> <span class="n">fmri_root</span><span class="p">,</span>
        <span class="s">&#39;analysis&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_root</span><span class="p">,</span> <span class="s">&#39;analysis/&#39;</span><span class="p">),</span>  <span class="c"># where analysis files are stored</span>
        <span class="s">&#39;logs&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_root</span><span class="p">,</span> <span class="s">&#39;logs/&#39;</span><span class="p">),</span>
        <span class="s">&#39;data&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_root</span><span class="p">,</span> <span class="s">&#39;data/&#39;</span><span class="p">),</span>
        <span class="s">&#39;report&#39;</span><span class="p">:</span> <span class="s">&#39;report/&#39;</span><span class="p">,</span>
        <span class="s">&#39;data_behav&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span> <span class="s">&#39;data_behav/&#39;</span><span class="p">),</span>  <span class="c"># for fMRI behav data</span>
        <span class="s">&#39;data_fmri&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span><span class="s">&#39;data_fmri/&#39;</span><span class="p">),</span>
        <span class="s">&#39;data_struct&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span><span class="s">&#39;data_struct/&#39;</span><span class="p">),</span>  <span class="c"># anatomical data</span>
        <span class="s">&#39;spm_analysis&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span> <span class="s">&#39;analysis/&#39;</span><span class="p">),</span>
        <span class="s">&#39;rec&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span><span class="s">&#39;reconstruction/&#39;</span><span class="p">),</span> <span class="c"># CARET reconstructions</span>
        <span class="s">&#39;rois&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span><span class="s">&#39;rois/&#39;</span><span class="p">),</span>  <span class="c"># ROIs (no data, just masks)</span>
        <span class="s">&#39;data_rois&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fmri_root</span><span class="p">,</span><span class="s">&#39;data_rois/&#39;</span><span class="p">),</span> <span class="c"># preprocessed and masked data</span>
        <span class="s">&#39;sim&#39;</span><span class="p">:</span> <span class="n">exp_root</span><span class="p">,</span>  <span class="c"># path for storing simulations of models</span>
        <span class="p">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">PATHS</span></tt> variable is defined at the top of your script after all imports are done:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">computer</span>  <span class="c"># computer params defined in the previous section</span>
<span class="n">PATHS</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">set_paths</span><span class="p">(</span><span class="n">exp_root</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">computer</span><span class="o">=</span><span class="n">computer</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">exp_root=''</span></tt> is the default setting recommended for a single experiment. It means that data is stored where the &#8216;run.py&#8217; file is, in the &#8216;data&#8217; folder. But if you have more than one experiment, <tt class="docutils literal"><span class="pre">exp_root='minimal'</span></tt> would be better (for the &#8220;minimal&#8221; experiment; for the &#8220;main&#8221;, you would call it <tt class="docutils literal"><span class="pre">exp_root='main'</span></tt>). That means that for this experiment will be in the &#8216;data&#8217; folder inside the &#8216;minimal&#8217; folder.</p>
</div>
<div class="section" id="the-experiment-experiment">
<h2>The experiment: <tt class="xref py py-class docutils literal"><span class="pre">Experiment</span></tt><a class="headerlink" href="#the-experiment-experiment" title="Permalink to this headline">¶</a></h2>
<p>An <em>experiment</em> is conceptualized as a wrapper of one or more <em>tasks</em> that a participant is supposed to perform. For example, first you may want to train them on a certain task, and next you want to measure their performance. Each task is defined as a class (using <tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt>, see <a class="reference internal" href="#task"><em>Defining tasks: Task</em></a>), and the two tasks can neatly be combined into a single continuous experiment with the <tt class="xref py py-class docutils literal"><span class="pre">Experiment</span></tt> class.</p>
<p>Note that if you only have a single task, you do not need to work with tasks at all. For your convenience, defining stimuli and trials directly in the Experiment class is possible (and encouraged).</p>
<p>So the experiment is defined in a <em>class</em>. The convenience of having classes is that we can now inherit multiple handy routines from <tt class="xref py py-class docutils literal"><span class="pre">exp.Experiment</span></tt>. Some of these routines are discussed below; otherwise, check the <a class="reference internal" href="../api/index.html#api"><em>API reference</em></a>.</p>
<p>So let&#8217;s define the <tt class="docutils literal"><span class="pre">Confsup</span></tt> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Confsup</span><span class="p">(</span><span class="n">exp</span><span class="o">.</span><span class="n">Experiment</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The configural superiority effect experiment</span>

<span class="sd">    Explanation of the task here.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Your experiments should always inherit from <tt class="xref py py-class docutils literal"><span class="pre">exp.Experiment</span></tt>. Also, to encourage the good practice of <a class="reference external" href="http://www.python.org/dev/peps/pep-0257/">docstrings</a>, task description is supposed to be provided in this docstring. <tt class="xref py py-class docutils literal"><span class="pre">exp.Experiment</span></tt> will take it and use it by default.</p>
<div class="section" id="initialization-init">
<span id="exp-init"></span><h3>Initialization: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.__init__.html#psychopy_ext.exp.Experiment.__init__" title="psychopy_ext.exp.Experiment.__init__"><tt class="xref py py-func docutils literal"><span class="pre">__init__()</span></tt></a><a class="headerlink" href="#initialization-init" title="Permalink to this headline">¶</a></h3>
<p>Here is a quick example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;exp&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;subjid&#39;</span><span class="p">,</span> <span class="s">&#39;confsup_&#39;</span><span class="p">),</span> <span class="n">actions</span><span class="o">=</span><span class="s">&#39;run&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Confsup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span>
                                  <span class="n">computer</span><span class="o">=</span><span class="n">computer</span><span class="p">,</span>
                                  <span class="n">paths</span><span class="o">=</span><span class="n">PATHS</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">computer</span><span class="o">.</span><span class="n">valid_responses</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;num_4&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;num_5&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;num_1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">&#39;num_2&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stim_size</span> <span class="o">=</span> <span class="mf">3.</span>  <span class="c"># in deg</span>
    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">_Train</span><span class="p">,</span> <span class="n">_Test</span><span class="p">]</span>
</pre></div>
</div>
<p>First, look at the parameters passed to the <tt class="docutils literal"><span class="pre">__init__()</span></tt> method:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd><p class="first last">This is the name of this experiment which is used to call this particular experiment from CLI and which is seen as a tab label in the GUI.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">info</span></tt></dt>
<dd><p class="first">A dictionary or a tuple of information that you want to record in the output file. Usually, you want to record participant id, but sometimes also session number etc. Upon calling <tt class="xref py py-func docutils literal"><span class="pre">exp.Experiment.__init__()</span></tt>, info is updated to be <tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt> (we use <em>OrderedDict</em> instead of a regular dictionary so that the order of entired is retained in the output file.) <tt class="docutils literal"><span class="pre">info</span></tt> will be updated to contain at least the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">OrderedDict</span><span class="p">([(</span><span class="s">&#39;subjid&#39;</span><span class="p">,</span> <span class="s">&#39;subj&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p class="last">So the default value for <tt class="docutils literal"><span class="pre">subjid</span></tt> is always <em>subj</em> unless, of course, you provided thsi value yourself, as in our example, in which case it becomes <tt class="docutils literal"><span class="pre">info['subjid']</span> <span class="pre">=</span> <span class="pre">'confsup'</span></tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">rp</span></tt></dt>
<dd><p class="first">We omitted <tt class="docutils literal"><span class="pre">rp</span></tt> in this example because the default <tt class="docutils literal"><span class="pre">rp</span></tt> was sufficient. It stores other run parameters that you may want to manipulate via the CLI/GUI. By default:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">rp</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>  <span class="c"># these control how the experiment is run</span>
    <span class="p">(</span><span class="s">&#39;no_output&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>  <span class="c"># do you want output? or just playing around?</span>
    <span class="p">(</span><span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>  <span class="c"># not fullscreen presentation etc</span>
    <span class="p">(</span><span class="s">&#39;autorun&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c"># if &gt;0, will autorun at the specified speed</span>
    <span class="p">(</span><span class="s">&#39;unittest&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>  <span class="c"># like autorun but no breaks at show_instructions</span>
    <span class="p">(</span><span class="s">&#39;register&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>  <span class="c"># add and commit changes, like new data files?</span>
    <span class="p">(</span><span class="s">&#39;push&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>  <span class="c"># add, commit and push to a hg repo?</span>
    <span class="p">])</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">actions</span></tt></dt>
<dd><p class="first last">A list of function names in this class that are &#8220;callable&#8221; from CLI and are seen as buttons in the GUI.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">computer</span></tt></dt>
<dd><p class="first last">The computer module (see <a class="reference internal" href="computer.html#computer"><em>Computer setup</em></a>) that holds information of your computer parameters.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">paths</span></tt></dt>
<dd><p class="first last">A dictionary of various paths for storing data (see <a class="reference internal" href="#set-paths"><em>Setting up paths: set_paths()</em></a> above).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">data_fname</span></tt></dt>
<dd><p class="first last">File name where data will be stored. (Similar to PsychoPy&#8217;s <tt class="docutils literal"><span class="pre">dataFilename</span></tt>.) This produces a <a class="reference internal" href="../api/generated/psychopy_ext.exp.Datafile.html#psychopy_ext.exp.Datafile" title="psychopy_ext.exp.Datafile"><tt class="xref py py-class docutils literal"><span class="pre">Datafile</span></tt></a> instance (stored in <tt class="docutils literal"><span class="pre">self.datafile</span></tt>) which we use later to write data.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">**kwargs</span></tt></dt>
<dd><p class="first">This argument allows for other keywords arguments to be passed.</p>
<p class="last">..note:: When you inherit this class, you must have at least <tt class="docutils literal"><span class="pre">info</span></tt> and <tt class="docutils literal"><span class="pre">rp</span></tt> (or simply <tt class="docutils literal"><span class="pre">**kwargs</span></tt>) keywords because <tt class="xref py py-class docutils literal"><span class="pre">Control</span></tt> expects them. In fact, all &#8220;callable&#8221; classes (the ones that can be accessed via GUI or CLI) must accept at least <tt class="docutils literal"><span class="pre">info</span></tt> and <tt class="docutils literal"><span class="pre">rp</span></tt>. Read more about this in <a class="reference internal" href="ui.html#ui-init"><em>Initialization procedure</em></a>.</p>
</dd>
</dl>
</li>
</ul>
<p>Next, the parent class (i.e., <tt class="xref py py-class docutils literal"><span class="pre">Experiment</span></tt>) is initialized. Observe the parameters that it accepts.</p>
<p>You should specify all &#8220;global&#8221; parameters such as stimulus size during the initialization of the Experiment. This is encouraged so that all parameters are in one place and defined before any other functions are called. Also notice how we use this opportunity to redefine <tt class="docutils literal"><span class="pre">valid_responses</span></tt>.</p>
<p>Finally, if you have more than one task, you have to provide it here by defining a <tt class="docutils literal"><span class="pre">self.tasks</span></tt> variable as list of tasks (classes) that you want to run in the oreder you want to run them. If you only have a single task, don&#8217;t bother with creating a <tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt> and simply define your stimuli and trials in the same Experiment class.</p>
</div>
<div class="section" id="setup-setup">
<span id="exp-setup"></span><h3>Setup: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.setup.html#psychopy_ext.exp.Experiment.setup" title="psychopy_ext.exp.Experiment.setup"><tt class="xref py py-func docutils literal"><span class="pre">setup()</span></tt></a><a class="headerlink" href="#setup-setup" title="Permalink to this headline">¶</a></h3>
<p>Typical setup procedure consists of:</p>
<ul class="simple">
<li>collecting run time information</li>
<li>setting up logging and seed (<a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.set_logging.html#psychopy_ext.exp.Experiment.set_logging" title="psychopy_ext.exp.Experiment.set_logging"><tt class="xref py py-func docutils literal"><span class="pre">set_logging()</span></tt></a>)</li>
<li>creating a window for stimuli presentation (<a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.create_win.html#psychopy_ext.exp.Experiment.create_win" title="psychopy_ext.exp.Experiment.create_win"><tt class="xref py py-func docutils literal"><span class="pre">create_win()</span></tt></a>)</li>
</ul>
<p>All these steps are conveniently wrapped into a <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.setup.html#psychopy_ext.exp.Experiment.setup" title="psychopy_ext.exp.Experiment.setup"><tt class="xref py py-func docutils literal"><span class="pre">setup()</span></tt></a> and you should try to use it unless you need something special. This means that usually the setup function is not redefined.</p>
</div>
<div class="section" id="run-run">
<span id="exp-run"></span><h3>Run: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.run.html#psychopy_ext.exp.Experiment.run" title="psychopy_ext.exp.Experiment.run"><tt class="xref py py-func docutils literal"><span class="pre">run()</span></tt></a><a class="headerlink" href="#run-run" title="Permalink to this headline">¶</a></h3>
<p>When you call <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.run.html#psychopy_ext.exp.Experiment.run" title="psychopy_ext.exp.Experiment.run"><tt class="xref py py-func docutils literal"><span class="pre">run()</span></tt></a> (or <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.run_exp.html#psychopy_ext.exp.Experiment.run_exp" title="psychopy_ext.exp.Experiment.run_exp"><tt class="xref py py-func docutils literal"><span class="pre">run_exp()</span></tt></a>), the following steps are performed:</p>
<ul class="simple">
<li>Setting up of the experiment (<a class="reference internal" href="#exp-setup"><em>Setup: setup()</em></a>)</li>
<li>Instructions are shown (<a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.before_exp.html#psychopy_ext.exp.Experiment.before_exp" title="psychopy_ext.exp.Experiment.before_exp"><tt class="xref py py-func docutils literal"><span class="pre">before_exp()</span></tt></a>). By default, the docstring of the experiment class is used thus encouraging you to keep up a good practice of commenting your code. Moreover, if you have <tt class="docutils literal"><span class="pre">docutils</span></tt> installed, <em>reST</em> syntax will be parsed automatically! And if you don&#8217;t have it, you can still format text with HTML tags (see more on <a class="reference external" href="http://www.pyglet.org/doc/api/pyglet.text.formats.html-module.html">pyglet&#8217;s website</a>). You can also redefine what&#8217;s shown by default simply by redefining <a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.before_exp.html#psychopy_ext.exp.Experiment.before_exp" title="psychopy_ext.exp.Experiment.before_exp"><tt class="xref py py-func docutils literal"><span class="pre">before_exp()</span></tt></a>.</li>
<li>Each task is called in a row</li>
<li>Final message (&#8220;Thank you&#8221;) is show (<a class="reference internal" href="../api/generated/psychopy_ext.exp.Experiment.after_exp.html#psychopy_ext.exp.Experiment.after_exp" title="psychopy_ext.exp.Experiment.after_exp"><tt class="xref py py-func docutils literal"><span class="pre">after_exp()</span></tt></a>)</li>
</ul>
<p>This routine is usually suffient and is not redefined.</p>
</div>
</div>
<div class="section" id="defining-tasks-task">
<span id="task"></span><h2>Defining tasks: <tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt><a class="headerlink" href="#defining-tasks-task" title="Permalink to this headline">¶</a></h2>
<p>Stimuli and trials are defined using a <tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt> class.</p>
<p>Arguments that each Task requires:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">parent</span></tt> (<tt class="xref py py-class docutils literal"><span class="pre">Experiment</span></tt>)</dt>
<dd><p class="first last">The Experiment to which this Tast belongs.</p>
</dd>
</dl>
</li>
</ul>
<p>Other parameters:</p>
<ul>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt> (str, default: &#8216;&#8217;)</dt>
<dd><p class="first last">Name of the experiment. Currently not used anywhere.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">version</span></tt> (str, default: &#8216;0.1&#8217;)</dt>
<dd><p class="first last">Version of your experiment. Also not used.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">method</span></tt> ({&#8216;sequential&#8217;, &#8216;random&#8217;}, default: &#8216;random&#8217;)</dt>
<dd><p class="first">Order of trials:</p>
<blockquote>
<div><ul class="simple">
<li>sequential: trials and blocks presented sequentially</li>
<li>random: trials presented randomly, blocks sequentially</li>
<li>fullRandom: converted to &#8216;random&#8217;</li>
</ul>
</div></blockquote>
<p class="last">Note that there is no explicit possibility to randomize the order of blocks. This is intentional because you in fact define block order in the <cite>blockcol</cite>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">data_fname</span></tt> (str, default=None)</dt>
<dd><p class="first last">The name of the main data file for storing output. If None, reuses <a class="reference internal" href="../api/generated/psychopy_ext.exp.Datafile.html#psychopy_ext.exp.Datafile" title="psychopy_ext.exp.Datafile"><tt class="xref py py-class docutils literal"><span class="pre">Datafile</span></tt></a> instance from its parent; otherwise, a new one is created (stored in <tt class="docutils literal"><span class="pre">self.datafile</span></tt>).</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal"><span class="pre">blockcol</span></tt> (str, default: None)</dt>
<dd><p class="first last">Column name in <cite>self.exp_plan</cite> that defines which trial should be presented during which block.</p>
</dd>
</dl>
</li>
</ul>
<div class="section" id="create-stimuli-create-stimuli">
<h3>Create stimuli: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.create_stimuli.html#psychopy_ext.exp.Task.create_stimuli" title="psychopy_ext.exp.Task.create_stimuli"><tt class="xref py py-func docutils literal"><span class="pre">create_stimuli()</span></tt></a><a class="headerlink" href="#create-stimuli-create-stimuli" title="Permalink to this headline">¶</a></h3>
<p>Here you should define all your stimuli and put them in a <tt class="docutils literal"><span class="pre">self.s</span></tt> dictionary. This need not be a complete specification of all stimuli properties as usually some properties are defined during the runtime. However, at the very least you should create the &#8220;placeholder&#8221; objects.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">create_fixation</span><span class="p">()</span>
<span class="n">sh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_size</span><span class="o">/</span><span class="mi">2</span>
<span class="n">diag45</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">ThickShapeStim</span><span class="p">(</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span>
    <span class="n">lineColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_color</span><span class="p">,</span>
    <span class="n">lineWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_width</span><span class="p">,</span>
    <span class="n">fillColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_color</span><span class="p">,</span>
    <span class="n">closeShape</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="n">sh</span><span class="p">,</span> <span class="o">-</span><span class="n">sh</span><span class="p">],</span> <span class="p">[</span><span class="n">sh</span><span class="p">,</span> <span class="n">sh</span><span class="p">]]</span>
    <span class="p">)</span>
<span class="n">diag135</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">ThickShapeStim</span><span class="p">(</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span>
    <span class="n">lineColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_color</span><span class="p">,</span>
    <span class="n">lineWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_width</span><span class="p">,</span>
    <span class="n">fillColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_color</span><span class="p">,</span>
    <span class="n">closeShape</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="n">sh</span><span class="p">,</span> <span class="n">sh</span><span class="p">],</span> <span class="p">[</span><span class="n">sh</span><span class="p">,</span> <span class="o">-</span><span class="n">sh</span><span class="p">]]</span>
    <span class="p">)</span>
<span class="n">corner</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">ThickShapeStim</span><span class="p">(</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">win</span><span class="p">,</span>
    <span class="n">lineColor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_color</span><span class="p">,</span>
    <span class="n">lineWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stim_width</span><span class="p">,</span>
    <span class="n">fillColor</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
    <span class="n">closeShape</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">vertices</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="n">sh</span><span class="p">,</span> <span class="n">sh</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">sh</span><span class="p">,</span> <span class="o">-</span><span class="n">sh</span><span class="p">],</span> <span class="p">[</span><span class="n">sh</span><span class="p">,</span> <span class="o">-</span><span class="n">sh</span><span class="p">]]</span>
    <span class="p">)</span>

<span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;fix&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixation</span><span class="p">,</span>
    <span class="s">&#39;parts&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="o">.</span><span class="n">GroupStim</span><span class="p">(</span><span class="n">stimuli</span><span class="o">=</span><span class="n">diag45</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;parts&#39;</span><span class="p">),</span>
    <span class="s">&#39;parts_odd&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="o">.</span><span class="n">GroupStim</span><span class="p">(</span><span class="n">stimuli</span><span class="o">=</span><span class="n">diag135</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;parts_odd&#39;</span><span class="p">),</span>
    <span class="s">&#39;whole&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="o">.</span><span class="n">GroupStim</span><span class="p">(</span><span class="n">stimuli</span><span class="o">=</span><span class="p">[</span><span class="n">corner</span><span class="p">,</span> <span class="n">diag45</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;whole&#39;</span><span class="p">),</span>  <span class="c"># arrow</span>
    <span class="s">&#39;whole_odd&#39;</span><span class="p">:</span> <span class="n">exp</span><span class="o">.</span><span class="n">GroupStim</span><span class="p">(</span><span class="n">stimuli</span><span class="o">=</span><span class="p">[</span><span class="n">corner</span><span class="p">,</span> <span class="n">diag135</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;whole_odd&#39;</span><span class="p">)</span>  <span class="c"># triangle</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="create-trial-structure-create-trial">
<h3>Create trial structure: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.create_trial.html#psychopy_ext.exp.Task.create_trial" title="psychopy_ext.exp.Task.create_trial"><tt class="xref py py-func docutils literal"><span class="pre">create_trial()</span></tt></a><a class="headerlink" href="#create-trial-structure-create-trial" title="Permalink to this headline">¶</a></h3>
<p>Trials are composed of events (<a class="reference internal" href="../api/generated/psychopy_ext.exp.Event.html#psychopy_ext.exp.Event" title="psychopy_ext.exp.Event"><tt class="xref py py-class docutils literal"><span class="pre">Event</span></tt></a>) that can be of are defined using the following parameters:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">dur</span></tt> &#8211; duration of an event in seconds; could be a number or a list of numbers for each trial separately</li>
<li><tt class="docutils literal"><span class="pre">display</span></tt> &#8211; which stimuli are shown during an event. This might not always be possible so you can also pass <em>None</em> and access stimuli later from <tt class="docutils literal"><span class="pre">self.s</span></tt></li>
<li><tt class="docutils literal"><span class="pre">func</span></tt> &#8211; function controling what to do with those stimuli. There are several predefined for you:<ul>
<li><tt class="xref py py-func docutils literal"><span class="pre">exp.Experiment.wait_until_response()</span></tt> which waits until response is produced and exits then</li>
<li><tt class="xref py py-func docutils literal"><span class="pre">exp.Experiment.idle_event()</span></tt> which simply sits and waits until its time is up while catching key presses</li>
<li><tt class="xref py py-func docutils literal"><span class="pre">exp.Experiment.feedback()</span></tt> for providing feedback after the trial with a fixation color change (correct response &#8211; green, incorrect - red)</li>
</ul>
</li>
</ul>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">trial</span> <span class="o">=</span> <span class="p">[</span><span class="n">exp</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>  <span class="c"># parent of this event</span>
                        <span class="n">dur</span><span class="o">=</span><span class="mf">0.300</span><span class="p">,</span>  <span class="c"># in seconds</span>
                        <span class="n">display</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="s">&#39;fix&#39;</span><span class="p">],</span>
                        <span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idle_event</span><span class="p">),</span>
              <span class="n">exp</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">dur</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;inf&#39;</span><span class="p">),</span>  <span class="c"># this means present until response</span>
                        <span class="n">display</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>  <span class="c"># we&#39;ll select which condition to</span>
                                       <span class="c"># present during the runtime with</span>
                                       <span class="c"># :func:`set_stimuli`</span>
                        <span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">during_trial</span><span class="p">),</span>
              <span class="n">exp</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">dur</span><span class="o">=.</span><span class="mi">300</span><span class="p">,</span>
                        <span class="n">display</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="s">&#39;fix&#39;</span><span class="p">],</span>
                        <span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">feedback</span><span class="p">)</span>
             <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="create-an-experiment-plan-create-exp-plan">
<span id="exp-plan"></span><h3>Create an experiment plan: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.create_exp_plan.html#psychopy_ext.exp.Task.create_exp_plan" title="psychopy_ext.exp.Task.create_exp_plan"><tt class="xref py py-func docutils literal"><span class="pre">create_exp_plan()</span></tt></a><a class="headerlink" href="#create-an-experiment-plan-create-exp-plan" title="Permalink to this headline">¶</a></h3>
<p>This is the place to define properties of each trial. It is advisable to start by defining the total trial duration in the <tt class="docutils literal"><span class="pre">self.trial_dur</span></tt> variable (though if you don&#8217;t, <tt class="xref py py-func docutils literal"><span class="pre">set_TrialHandler()</span></tt> will do that for you later).</p>
<p>Each dictionary entry will be recorded in a separate column in the output file so think about good data sharing practices (<a class="reference external" href="http://dx.doi.org/10.7287/peerj.preprints.7">White et al. (2013)</a>):</p>
<ul class="simple">
<li>One column - one value (i.e., a number, a string, or a boolean). No lists, dictionaries etc. You don&#8217;t really need them for stimulus construction during the runtime &#8211; instead, implement stimulus construction in the trial&#8217;s <cite>func</cite> function. Trust me, you can do it!</li>
<li>Dates are formatted as YYYY-MM-DD per <a class="reference external" href="http://www.iso.org/iso/support/faqs/faqs_widely_used_standards/widely_used_standards_other/iso8601">ISO 8601</a> and XKCD&#8217;s <a class="reference external" href="http://xkcd.com/1179/">Public service announcement</a></li>
<li>Avoid special characters and commas (as the output is a plain comma-separated file).</li>
<li>Blank values are supposed to be &#8216;&#8217;. No None, no NA or <cite>numpy.nan</cite>.</li>
</ul>
<p><em>What should go into a data file?</em> Your data file is supposed to describe <em>completely</em> what you did so that it was perfectly reproducible by somebody else. That should be your guiding principle.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exp_plan</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nreps</span><span class="p">):</span>  <span class="c"># repeat the defined number of times</span>
    <span class="k">for</span> <span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">posname</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">paratable</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">cond</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span>
        <span class="n">exp_plan</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="s">&#39;rep&#39;</span><span class="p">,</span> <span class="n">rep</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;cond&#39;</span><span class="p">,</span> <span class="n">cond</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;context&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;posname&#39;</span><span class="p">,</span> <span class="n">posname</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;pos&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;onset&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;dur&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;corr_resp&#39;</span><span class="p">,</span> <span class="n">pos</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;subj_resp&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;rt&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
            <span class="p">]))</span>
<span class="bp">self</span><span class="o">.</span><span class="n">exp_plan</span> <span class="o">=</span> <span class="n">exp_plan</span>
</pre></div>
</div>
<p>Notice how we already define <tt class="docutils literal"><span class="pre">onset</span></tt>, <tt class="docutils literal"><span class="pre">dur</span></tt>, <tt class="docutils literal"><span class="pre">subj_resp</span></tt>, <tt class="docutils literal"><span class="pre">accuracy</span></tt>, and <tt class="docutils literal"><span class="pre">rt</span></tt>, even though currently they are empty. These values will be modified during the run time. You don&#8217;t have to list them here but it&#8217;s nicer to see all values that will be recorded.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike in <em>PsychoPy</em>, here we record data (responses, reaction times etc.) in <tt class="docutils literal"><span class="pre">self.exp_plan</span></tt>. Nothing is kept in <tt class="docutils literal"><span class="pre">self.data</span></tt> and it is not saved in the resulting data file. This is done in order to facilitate an easy import of data to <tt class="xref py py-class docutils literal"><span class="pre">pandas.DataFrame</span></tt>. You will appreciate the power of <tt class="docutils literal"><span class="pre">pandas</span></tt> in <a class="reference internal" href="stats.html#stats"><em>Statistics with stats</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you need to break your experiment into blocks, include a column that indicates a sequence number of that block. For example, the &#8216;rep&#8217; column could be used to break the experiment into five intervals (of eight trials each). You need to define which column holds this information during the initialization by passing <tt class="docutils literal"><span class="pre">blockcol</span></tt> parameter to <tt class="xref py py-class docutils literal"><span class="pre">Task</span></tt>.</p>
</div>
</div>
<div class="section" id="setup-setup-task">
<h3>Setup: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.setup_task.html#psychopy_ext.exp.Task.setup_task" title="psychopy_ext.exp.Task.setup_task"><tt class="xref py py-func docutils literal"><span class="pre">setup_task()</span></tt></a><a class="headerlink" href="#setup-setup-task" title="Permalink to this headline">¶</a></h3>
<p>Setup can only bi initiated after the setup of the parent Experiment has been completed. Typical task setup procedure consists of:</p>
<ul class="simple">
<li>creating stimuli (<tt class="xref py py-func docutils literal"><span class="pre">create_stimuli()</span></tt>)</li>
<li>creating a trial structure (<tt class="xref py py-func docutils literal"><span class="pre">create_trial()</span></tt>)</li>
<li>create a list of trials with each trial&#8217;s properties defined (<tt class="xref py py-func docutils literal"><span class="pre">create_exp_plan()</span></tt>)</li>
<li>defining <cite>self.trial_dur</cite> if not defined yet</li>
<li>adjusting the list of trials for auto run</li>
<li>blocks during the experiment are inferred (<a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.get_blocks.html#psychopy_ext.exp.Task.get_blocks" title="psychopy_ext.exp.Task.get_blocks"><tt class="xref py py-func docutils literal"><span class="pre">get_blocks()</span></tt></a>) using the <tt class="docutils literal"><span class="pre">self.blockcol</span></tt> parameter (read more in <a class="reference internal" href="#exp-plan"><em>Create an experiment plan: create_exp_plan()</em></a>)</li>
</ul>
<p>All these steps are conveniently wrapped into a <tt class="xref py py-func docutils literal"><span class="pre">setup()</span></tt> and you should try to use it unless you need something special. This means that usually the setup function is not redefined.</p>
</div>
<div class="section" id="running-task-run-task">
<h3>Running task: <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.run_task.html#psychopy_ext.exp.Task.run_task" title="psychopy_ext.exp.Task.run_task"><tt class="xref py py-func docutils literal"><span class="pre">run_task()</span></tt></a><a class="headerlink" href="#running-task-run-task" title="Permalink to this headline">¶</a></h3>
<p>The experiment starts by setting up everything (<tt class="xref py py-func docutils literal"><span class="pre">setup()</span></tt>). Then, instructions are shown just like explained before in <a class="reference internal" href="#exp-run"><em>Run: run()</em></a> using <tt class="xref py py-func docutils literal"><span class="pre">before_task()</span></tt>. A data output file is opened for writing (it&#8217;s a <tt class="docutils literal"><span class="pre">cvs</span></tt> format with a header).</p>
<p>Once this is ready, the experiment starts with the presentation of task instructions (<tt class="docutils literal"><span class="pre">self.instructions</span></tt>). Then the experimental loop is controlled by the <tt class="docutils literal"><span class="pre">run_blocks</span></tt> function which goes through each block in <tt class="docutils literal"><span class="pre">self.blocks</span></tt> (from <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.get_blocks.html#psychopy_ext.exp.Task.get_blocks" title="psychopy_ext.exp.Task.get_blocks"><tt class="xref py py-func docutils literal"><span class="pre">get_blocks()</span></tt></a>). Each block runs through its own TrialHandler, and each trial goes through events. Key presses are recorded throughout using the <a class="reference internal" href="../api/generated/psychopy_ext.exp.Task.post_trial.html#psychopy_ext.exp.Task.post_trial" title="psychopy_ext.exp.Task.post_trial"><tt class="xref py py-func docutils literal"><span class="pre">post_trial()</span></tt></a> function (where the mapping between key input and <tt class="docutils literal"><span class="pre">self.computer.valid_responses</span></tt> is done, and accuracy and response time are computed). Data is then recorded immediatelly at the end of each trial in the datafile..</p>
</div>
</div>
<div class="section" id="committing-and-pushing-data-to-a-repository">
<h2>Committing and pushing data to a repository<a class="headerlink" href="#committing-and-pushing-data-to-a-repository" title="Permalink to this headline">¶</a></h2>
<div class="section" id="motivation">
<h3>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h3>
<p>In the ideal world, how should data be treated? It should be registered at the
point of its acquiry meaning that one should be able to go back and see it as
it came out. Data files are not immutable. Sometimes there is a spelling mistake that
you want to fix, or an extra column that you realized only two participants later you should have included. So you want to overwrite your data which poses a problem that
it may go wrong but you notice it too late. This is where the confidence of
having the original version help.</p>
<p>Of course, you could keep all versions of your data files but this is both
inefficient (a year later, will you remember whether &#8216;data_corr&#8217; or &#8216;data_final&#8217;
was the correct one?) and unncessary. It is much easier to track (and record)
changes. Welcome revision control systems (<a class="reference external" href="http://gestaltrevision.be/wiki/python/vc">learn more</a>).</p>
<p>This approach provides a more stringent data and source code handling.
Bonus: simple plot sharing as can be seen in the utl repo.</p>
</div>
<div class="section" id="what-s-available">
<h3>What&#8217;s available<a class="headerlink" href="#what-s-available" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">register</span></tt> when you want to put a tag at some important point of your
experiment development, for example, when you&#8217;re about to test the first
participant or when you do a pilot, so that you can always go back to that
point in time and see how your code looked exactly. &#8216;Registration&#8217; is
inspired by the <a class="reference external" href="http://openscienceframework.org/">Open Science Framework</a>
<tt class="docutils literal"><span class="pre">commit</span></tt> after data collection so that data files are added to the
revision control system right away
<tt class="docutils literal"><span class="pre">push</span></tt> to put your data on the remote repository immediately. This is
recommended over <tt class="docutils literal"><span class="pre">commit</span></tt> unless you run experiments without the internet connection.</p>
<p>You can either add these flags when you run the experiment (except <tt class="docutils literal"><span class="pre">register</span></tt>),
for example, so that data is pushed right away, or, if you forgot to do so intially, just run
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">run.py</span> <span class="pre">--push</span></tt> (or another flag) and the operation will be completed.
(Note: for <tt class="docutils literal"><span class="pre">register</span></tt> and <tt class="docutils literal"><span class="pre">commit</span></tt>, a tag or a message has to be included.)</p>
</div>
</div>
<div class="section" id="other-features">
<h2>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="autorun">
<h3>Autorun<a class="headerlink" href="#autorun" title="Permalink to this headline">¶</a></h3>
<p>You can simulate experiments by automatically running them. Just provide a value for <tt class="docutils literal"><span class="pre">autorun</span></tt>. I usually run them at 100x speed (thus, I enter 100). The experiment will run and record simulated responses by itself, stopping at each instructions screen and waiting for your response. If you rather have the experiment go no stop (good for making sure evertyhing works fine), select the <tt class="docutils literal"><span class="pre">unittest</span></tt> flag instead (it runs at 100x speed).</p>
</div>
<div class="section" id="no-output">
<h3>No output<a class="headerlink" href="#no-output" title="Permalink to this headline">¶</a></h3>
<p>Use <tt class="docutils literal"><span class="pre">no_output</span></tt> flag to run without creating or changing any output files. This is useful when debugging. For example, if the experiment fails before anything is shown, no (empty) data file is generated.</p>
</div>
<div class="section" id="debugging">
<h3>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">debug</span></tt> flag is used to open the windon not in a fullscreen mode that comes by default. This is useful when you&#8217;re doing debugging since you want to be able to access the terminal.</p>
</div>
</div>
<div class="section" id="data-analysis-class">
<h2>Data analysis class<a class="headerlink" href="#data-analysis-class" title="Permalink to this headline">¶</a></h2>
<p>There is no generalized way to run an analysis, so <tt class="docutils literal"><span class="pre">psychopy_ext</span></tt> does not provide a class for that. However, it should be constructed in a similar manner to <tt class="xref py py-class docutils literal"><span class="pre">Experiment</span></tt>, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Analysis</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;analysis&#39;</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;subjid&#39;</span><span class="p">:</span> <span class="s">&#39;confsup_&#39;</span><span class="p">}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp</span> <span class="o">=</span> <span class="n">exp</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then define various analysis routines, for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">PATHS</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.csv&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exp</span><span class="o">.</span><span class="n">get_behav_df</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="n">pattern</span><span class="p">)</span>
    <span class="n">agg_acc</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">accuracy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="s">&#39;context&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s">&#39;subjid&#39;</span><span class="p">)</span>
    <span class="n">agg_rt</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">accuracy</span><span class="o">==</span><span class="s">&#39;correct&#39;</span><span class="p">],</span> <span class="n">cols</span><span class="o">=</span><span class="s">&#39;context&#39;</span><span class="p">,</span>
                             <span class="n">values</span><span class="o">=</span><span class="s">&#39;rt&#39;</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="s">&#39;subjid&#39;</span><span class="p">)</span>

    <span class="n">plt</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">agg_acc</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">agg_rt</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&#39;bar&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>You&#8217;ll notice that now we use <a class="reference internal" href="../api/index.html#module-psychopy_ext.stats" title="psychopy_ext.stats"><tt class="xref py py-mod docutils literal"><span class="pre">stats</span></tt></a> and <a class="reference internal" href="../api/index.html#module-psychopy_ext.plot" title="psychopy_ext.plot"><tt class="xref py py-mod docutils literal"><span class="pre">plot</span></tt></a>. Learn how to work with them: <a class="reference internal" href="stats.html#stats"><em>Statistics with stats</em></a>.</p>
</div>
</div>


        </div>

        <!-- Sidebar2
        ========================================== -->
          
      </div>
    </div>
  
  <footer>
  <div class="row">
    <div class="container">
      <div class="col-md-5">
        <img class="featurette-image img-rounded" src="../_static/gpl.png" alt="Generic placeholder image">
      </div>
      <div class="col-md-7">
        <h2 class="featurette-heading">Free and Open Source.</h2>
        <p class="lead">psychopy_ext is licensed under GNU General Public License 3+.</p>
        <p class="author">Part of PsychoPy Standalone distribution.</p>
        <p class="author">Please cite it as: Kubilius, J. (2014). A framework for streamlining research workflow in neuroscience and psychology. <em>Frontiers in Neuroinformatics</em>, <em>7</em>, 52. doi: <a href="http://www.frontiersin.org/Neuroinformatics/10.3389/fninf.2013.00052/abstract">10.3389/fninf.2013.00052</a></p>
        <p class="author">Brought to you by Jonas Kubilius / <a href="http://klab.lt">klab.lt</a>, 2010-2014, using a <a href="https://github.com/ryan-roemer/sphinx-bootstrap-theme">themed</a> trio of <a href="http://sphinx-doc.org/">sphinx</a>, <a href="http://getbootstrap.com/">bootstrap</a> & <a href="http://bootswatch.com/">bootswatch</a></p>
      </div>
    </div>
  </div>
</footer>
  </body>
</html>