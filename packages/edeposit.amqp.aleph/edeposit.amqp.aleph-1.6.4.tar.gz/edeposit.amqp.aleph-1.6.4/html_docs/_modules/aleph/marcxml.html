<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>aleph.marcxml &mdash; edeposit.amqp.aleph 1.6.4 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.6.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="edeposit.amqp.aleph 1.6.4 documentation" href="../../index.html" />
    <link rel="up" title="aleph" href="../aleph.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">edeposit.amqp.aleph 1.6.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../aleph.html" accesskey="U">aleph</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for aleph.marcxml</h1><div class="highlight"><pre>
<span class="c">#! /usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#</span>
<span class="c"># Interpreter version: python 2.7</span>
<span class="c">#</span>
<span class="c">## TODO:</span>
<span class="c">#    - Add setters</span>
<span class="c">#</span>
<span class="c">#= Imports ====================================================================</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module for parsing and high-level processing of MARC XML records.</span>

<span class="sd">Standard MARC record is made from three parts:</span>

<span class="sd">* `leader` - Binary something, you can probably ignore it.</span>
<span class="sd">* `controlfileds` - MARC fields with ``ID &lt; 10``.</span>
<span class="sd">* `datafields` - Informations you actually want.</span>

<span class="sd">Basic MARC XML scheme has this structure::</span>

<span class="sd">    &lt;record xmlns=definition..&gt;</span>
<span class="sd">        &lt;leader&gt;optional_binary_something&lt;/leader&gt;</span>

<span class="sd">        &lt;controlfield tag=&quot;001&quot;&gt;data&lt;/controlfield&gt;</span>
<span class="sd">        ...</span>
<span class="sd">        &lt;controlfield tag=&quot;010&quot;&gt;data&lt;/controlfield&gt;</span>

<span class="sd">        &lt;datafield tag=&quot;011&quot; ind1=&quot; &quot; ind2=&quot; &quot;&gt;</span>
<span class="sd">            &lt;subfield code=&quot;scode&quot;&gt;data&lt;/subfield&gt;</span>
<span class="sd">            &lt;subfield code=&quot;a&quot;&gt;data&lt;/subfield&gt;</span>
<span class="sd">            &lt;subfield code=&quot;a&quot;&gt;another data, but same code!&lt;/subfield&gt;</span>
<span class="sd">            ...</span>
<span class="sd">            &lt;subfield code&quot;scode+&quot;&gt;another data&lt;/subfield&gt;</span>
<span class="sd">        &lt;/datafield&gt;</span>

<span class="sd">        ...</span>

<span class="sd">        &lt;datafield tag=&quot;999&quot; ind1=&quot; &quot; ind2=&quot; &quot;&gt;</span>
<span class="sd">            ...</span>
<span class="sd">        &lt;/datafield&gt;</span>
<span class="sd">    &lt;/record&gt;</span>

<span class="sd">`&lt;leader&gt;` is optional and it is parsed into :attr:`MARCXMLRecord.leader` as</span>
<span class="sd">string.</span>

<span class="sd">`&lt;controlfield&gt;s` are optional and are parsed as dictionary into</span>
<span class="sd">:class:`MARCXMLRecord.controlfields`. Dictionary for data in example above</span>
<span class="sd">would look like this::</span>

<span class="sd">    MARCXMLRecord.controlfields = {</span>
<span class="sd">        &quot;001&quot;: &quot;data&quot;,</span>
<span class="sd">        ...</span>
<span class="sd">        &quot;010&quot;: &quot;data&quot;</span>
<span class="sd">    }</span>

<span class="sd">`&lt;datafield&gt;s` are non-optional and are parsed into</span>
<span class="sd">:class:`MARCXMLRecord.datafields`, which is little bit more complicated</span>
<span class="sd">dictionary. Complicated is mainly because tag parameter is not unique, so there</span>
<span class="sd">can be more `&lt;datafield&gt;s` with same tag!</span>

<span class="sd">`scode` (subfield code) is always one character (ASCII lowercase), or number.</span>

<span class="sd">Example dict::</span>

<span class="sd">    MARCXMLRecord.datafields = {</span>
<span class="sd">        &quot;011&quot;: [{</span>
<span class="sd">            &quot;ind1&quot;: &quot; &quot;,</span>
<span class="sd">            &quot;ind2&quot;: &quot; &quot;,</span>
<span class="sd">            &quot;scode&quot;: [&quot;data&quot;],</span>
<span class="sd">            &quot;scode+&quot;: [&quot;another data&quot;]</span>
<span class="sd">        }],</span>

<span class="sd">        # real example</span>
<span class="sd">        &quot;928&quot;: [{</span>
<span class="sd">            &quot;ind1&quot;: &quot;1&quot;,</span>
<span class="sd">            &quot;ind2&quot;: &quot; &quot;,</span>
<span class="sd">            &quot;a&quot;: [&quot;Portál&quot;]</span>
<span class="sd">        }],</span>

<span class="sd">        &quot;910&quot;: [</span>
<span class="sd">            {</span>
<span class="sd">                &quot;ind1&quot;: &quot;1&quot;,</span>
<span class="sd">                &quot;ind2&quot;: &quot; &quot;,</span>
<span class="sd">                &quot;a&quot;: [&quot;ABA001&quot;]</span>
<span class="sd">            },</span>
<span class="sd">            {</span>
<span class="sd">                &quot;ind1&quot;: &quot;2&quot;,</span>
<span class="sd">                &quot;ind2&quot;: &quot; &quot;,</span>
<span class="sd">                &quot;a&quot;: [&quot;BOA001&quot;],</span>
<span class="sd">                &quot;b&quot;: [&quot;2-1235.975&quot;]</span>
<span class="sd">            },</span>
<span class="sd">            {</span>
<span class="sd">                &quot;ind1&quot;: &quot;3&quot;,</span>
<span class="sd">                &quot;ind2&quot;: &quot; &quot;,</span>
<span class="sd">                &quot;a&quot;: [&quot;OLA001&quot;],</span>
<span class="sd">                &quot;b&quot;: [&quot;1-218.844&quot;]</span>
<span class="sd">            }</span>
<span class="sd">        ]</span>
<span class="sd">    }</span>

<span class="sd">Warning:</span>
<span class="sd">    NOTICE, THAT RECORDS ARE STORED IN ARRAY, NO MATTER IF IT IS JUST ONE</span>
<span class="sd">    RECORD, OR MULTIPLE RECORDS. SAME APPLY TO SUBFIELDS.</span>

<span class="sd">Example above corresponds with this piece of code from real world::</span>

<span class="sd">    &lt;datafield tag=&quot;910&quot; ind1=&quot;1&quot; ind2=&quot; &quot;&gt;</span>
<span class="sd">    &lt;subfield code=&quot;a&quot;&gt;ABA001&lt;/subfield&gt;</span>
<span class="sd">    &lt;/datafield&gt;</span>
<span class="sd">    &lt;datafield tag=&quot;910&quot; ind1=&quot;2&quot; ind2=&quot; &quot;&gt;</span>
<span class="sd">    &lt;subfield code=&quot;a&quot;&gt;BOA001&lt;/subfield&gt;</span>
<span class="sd">    &lt;subfield code=&quot;b&quot;&gt;2-1235.975&lt;/subfield&gt;</span>
<span class="sd">    &lt;/datafield&gt;</span>
<span class="sd">    &lt;datafield tag=&quot;910&quot; ind1=&quot;3&quot; ind2=&quot; &quot;&gt;</span>
<span class="sd">    &lt;subfield code=&quot;a&quot;&gt;OLA001&lt;/subfield&gt;</span>
<span class="sd">    &lt;subfield code=&quot;b&quot;&gt;1-218.844&lt;/subfield&gt;</span>
<span class="sd">    &lt;/datafield&gt;</span>

<span class="sd">OAI</span>
<span class="sd">===</span>
<span class="sd">To prevent things to be too much simple, there is also another type of MARC</span>
<span class="sd">XML document - OAI format.</span>

<span class="sd">OAI documents are little bit different, but almost same in structure.</span>

<span class="sd">`leader` is optional and is stored in ``MARCXMLRecord.controlfields[&quot;LDR&quot;]``,</span>
<span class="sd">but also in :attr:`MARCXMLRecord.leader` for backward compatibility.</span>

<span class="sd">`&lt;controlfield&gt;` is renamed to `&lt;fixfield&gt;` and its &quot;tag&quot; parameter to &quot;label&quot;.</span>

<span class="sd">`&lt;datafield&gt;` tag is not named datafield, but `&lt;varfield&gt;`, &quot;tag&quot; parameter is</span>
<span class="sd">&quot;id&quot; and ind1/ind2 are named i1/i2, but works the same way.</span>

<span class="sd">`&lt;subfield&gt;s` parameter &quot;code&quot; is renamed to &quot;label&quot;.</span>

<span class="sd">Real world example::</span>

<span class="sd">    &lt;oai_marc&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;LDR&quot;&gt;-----nam-a22------aa4500&lt;/fixfield&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;FMT&quot;&gt;BK&lt;/fixfield&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;001&quot;&gt;cpk19990652691&lt;/fixfield&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;003&quot;&gt;CZ-PrNK&lt;/fixfield&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;005&quot;&gt;20130513104801.0&lt;/fixfield&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;007&quot;&gt;tu&lt;/fixfield&gt;</span>
<span class="sd">    &lt;fixfield id=&quot;008&quot;&gt;990330m19981999xr-af--d------000-1-cze--&lt;/fixfield&gt;</span>
<span class="sd">    &lt;varfield id=&quot;015&quot; i1=&quot; &quot; i2=&quot; &quot;&gt;</span>
<span class="sd">    &lt;subfield label=&quot;a&quot;&gt;cnb000652691&lt;/subfield&gt;</span>
<span class="sd">    &lt;/varfield&gt;</span>
<span class="sd">    &lt;varfield id=&quot;020&quot; i1=&quot; &quot; i2=&quot; &quot;&gt;</span>
<span class="sd">    &lt;subfield label=&quot;a&quot;&gt;80-7174-091-8 (sv. 1 : váz.) :&lt;/subfield&gt;</span>
<span class="sd">    &lt;subfield label=&quot;c&quot;&gt;Kč 182,00&lt;/subfield&gt;</span>
<span class="sd">    &lt;/varfield&gt;</span>
<span class="sd">    ...</span>
<span class="sd">    &lt;/oai_marc&gt;</span>

<span class="sd">MARC documentation</span>
<span class="sd">------------------</span>
<span class="sd">`Definition of MARC OAI`_, `simplified MARC XML schema`_ and `full MARC XML</span>
<span class="sd">specification`_ of all elements (19492 lines of code) is freely accessible for</span>
<span class="sd">anyone interested.</span>

<span class="sd">.. _Definition of MARC OAI: http://www.openarchives.org/OAI/oai_marc.xsd</span>
<span class="sd">.. _simplified MARC XML schema: http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd</span>
<span class="sd">.. _full MARC XML specification: http://www.loc.gov/standards/marcxml/mrcbxmlfile.dtd </span>

<span class="sd">API</span>
<span class="sd">===</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>


<span class="kn">import</span> <span class="nn">dhtmlparser</span>
<span class="kn">from</span> <span class="nn">dhtmlparser</span> <span class="kn">import</span> <span class="n">HTMLElement</span>


<span class="c">#= Functions &amp; objects ========================================================</span>
<span class="k">def</span> <span class="nf">_undefinedPattern</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">undefined</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If ``fn(value) == True``, return `undefined`, else `value`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fn</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">undefined</span>

    <span class="k">return</span> <span class="n">value</span>


<div class="viewcode-block" id="resorted"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.resorted">[docs]</a><span class="k">def</span> <span class="nf">resorted</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort values, but put numbers after alphabetically sorted words.</span>

<span class="sd">    This function is here to make outputs diff-compatible with Aleph.</span>

<span class="sd">    Example::</span>
<span class="sd">        &gt;&gt;&gt; sorted([&quot;b&quot;, &quot;1&quot;, &quot;a&quot;])</span>
<span class="sd">        [&#39;1&#39;, &#39;a&#39;, &#39;b&#39;]</span>
<span class="sd">        &gt;&gt;&gt; resorted([&quot;b&quot;, &quot;1&quot;, &quot;a&quot;])</span>
<span class="sd">        [&#39;a&#39;, &#39;b&#39;, &#39;1&#39;]</span>

<span class="sd">    Args:</span>
<span class="sd">        values (iterable): any iterable object/list/tuple/whatever.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list of sorted values, but with numbers after words</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span> <span class="n">values</span><span class="p">)</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">words</span> <span class="o">+</span> <span class="n">numbers</span>

</div>
<div class="viewcode-block" id="Person"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.Person">[docs]</a><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;Person&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span>
                                   <span class="s">&quot;second_name&quot;</span><span class="p">,</span>
                                   <span class="s">&quot;surname&quot;</span><span class="p">,</span>
                                   <span class="s">&quot;title&quot;</span><span class="p">])):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents informations about persons as they are defined in</span>
<span class="sd">    MARC standards.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str)</span>
<span class="sd">        second_name (str)</span>
<span class="sd">        surname (str)</span>
<span class="sd">        title (str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

</div>
<div class="viewcode-block" id="Corporation"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.Corporation">[docs]</a><span class="k">class</span> <span class="nc">Corporation</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&quot;Corporation&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="s">&quot;place&quot;</span><span class="p">,</span> <span class="s">&quot;date&quot;</span><span class="p">])):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Some informations about corporations (fields 110, 610, 710, 810).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str):  Name of the corporation.</span>
<span class="sd">        place (str): Location of the corporation/action.</span>
<span class="sd">        date (str):  Date in unspecified format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

</div>
<div class="viewcode-block" id="MarcSubrecord"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MarcSubrecord">[docs]</a><span class="k">class</span> <span class="nc">MarcSubrecord</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is used to store data returned from</span>
<span class="sd">    :meth:`MARCXMLRecord.getDataRecords()`.</span>

<span class="sd">    It looks kinda like overshot, but when you are parsing the MARC XML,</span>
<span class="sd">    values from `subrecords`, you need to know the context in which the</span>
<span class="sd">    `subrecord` is put.</span>

<span class="sd">    This context is provided by the ``i1``/``i2`` values, but sometimes it is</span>
<span class="sd">    also useful to have access to the other subfields from this `subrecord`.</span>

<span class="sd">    This class provides this access by :meth:`getI1`/:meth:`getI2` and</span>
<span class="sd">    :meth:`getOtherSubfiedls` getters. As a bonus, it is also fully replaceable</span>
<span class="sd">    with string, in which case only the value of `subrecord` is preserved.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        arg (str):   Value of `subrecord`.</span>
<span class="sd">        ind1 (char): Indicator one.</span>
<span class="sd">        ind2 (char): Indicator two.</span>
<span class="sd">        other_subfields (dict): Dictionary with other subfields from the same</span>
<span class="sd">                                `subrecord`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="n">other_subfields</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">ind1</span><span class="p">,</span> <span class="n">ind2</span><span class="p">,</span> <span class="n">other_subfields</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind1</span> <span class="o">=</span> <span class="n">ind1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span> <span class="o">=</span> <span class="n">ind2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other_subfields</span> <span class="o">=</span> <span class="n">other_subfields</span>

<div class="viewcode-block" id="MarcSubrecord.getI1"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MarcSubrecord.getI1">[docs]</a>    <span class="k">def</span> <span class="nf">getI1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind1</span>
</div>
<div class="viewcode-block" id="MarcSubrecord.getI2"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MarcSubrecord.getI2">[docs]</a>    <span class="k">def</span> <span class="nf">getI2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind2</span>
</div>
<div class="viewcode-block" id="MarcSubrecord.getOtherSubfiedls"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MarcSubrecord.getOtherSubfiedls">[docs]</a>    <span class="k">def</span> <span class="nf">getOtherSubfiedls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return reference to dictionary, from which the `subrecord` was given.</span>

<span class="sd">        Note:</span>
<span class="sd">            This method is used to get `backlink` to other fields (reference to</span>
<span class="sd">            field in :attr:`MARCXMLRecord.datafields`). It is not clean, but it</span>
<span class="sd">            works.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">other_subfields</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arg</span>

</div>
<div class="viewcode-block" id="MARCXMLRecord"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord">[docs]</a><span class="k">class</span> <span class="nc">MARCXMLRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for serialization/deserialization of MARC XML and MARC OAI</span>
<span class="sd">    documents.</span>

<span class="sd">    This class parses everything between ``&lt;root&gt;`` elements. It checks, if</span>
<span class="sd">    there is root element, so please, give it full XML.</span>

<span class="sd">    Internal format is described in module docstring. You can access</span>
<span class="sd">    internal data directly, or using few handy methods on two different</span>
<span class="sd">    levels of abstraction.</span>

<span class="sd">    **No abstraction at all**</span>

<span class="sd">    You can choose to access data directly and for this use, there is few</span>
<span class="sd">    important properties:</span>

<span class="sd">    Attributes:</span>
<span class="sd">      leader         (string): Leader of MARC XML document.</span>
<span class="sd">      oai_marc       (bool): True/False, depending if doc is OAI doc or not</span>
<span class="sd">      controlfields  (dict): Controlfields stored in dict.</span>
<span class="sd">      datafields     (dict of arrays of dict of arrays of strings ^-^):</span>
<span class="sd">                     Datafileds stored in nested dicts/arrays.</span>

<span class="sd">    :attr:`controlfields` is simple and easy to use dictionary, where keys are</span>
<span class="sd">    field identificators (string, 3 chars, all chars digits). Value is</span>
<span class="sd">    always string.</span>

<span class="sd">    :attr:`datafields` is little more complicated; it is dictionary made of</span>
<span class="sd">    arrays of dictionaries, which consists of arrays of strings and two special</span>
<span class="sd">    parameters.</span>

<span class="sd">    It sounds horrible, but it is not that hard to understand::</span>

<span class="sd">        .datafields = {</span>
<span class="sd">            &quot;011&quot;: [&quot;ind1&quot;: &quot; &quot;, &quot;ind2&quot;: &quot; &quot;]  # array of 0 or more dicts</span>
<span class="sd">            &quot;012&quot;: [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;a&quot;: [&quot;a) subsection value&quot;],</span>
<span class="sd">                    &quot;b&quot;: [&quot;b) subsection value&quot;],</span>
<span class="sd">                    &quot;ind1&quot;: &quot; &quot;,</span>
<span class="sd">                    &quot;ind2&quot;: &quot; &quot;</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;a&quot;: [</span>
<span class="sd">                        &quot;multiple values in a) subsections are possible!&quot;,</span>
<span class="sd">                        &quot;another value in a) subsection&quot;</span>
<span class="sd">                    ],</span>
<span class="sd">                    &quot;c&quot;: [</span>
<span class="sd">                        &quot;subsection identificator is always one character long&quot;</span>
<span class="sd">                    ],</span>
<span class="sd">                    &quot;ind1&quot;: &quot; &quot;,</span>
<span class="sd">                    &quot;ind2&quot;: &quot; &quot;</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>
<span class="sd">        }</span>

<span class="sd">    Notice ``ind1``/``ind2`` keywords, which are reserved indicators and used</span>
<span class="sd">    in few cases thru MARC standard.</span>

<span class="sd">    Dict structure is not that hard to understand, but kinda long to access,</span>
<span class="sd">    so there is also higher-level abstraction access methods.</span>

<span class="sd">    **Lowlevel abstraction**</span>

<span class="sd">    To access data little bit easier, there are defined two methods to</span>
<span class="sd">    access and two methods to add data to internal dictionaries:</span>

<span class="sd">        - :meth:`addControlField`</span>
<span class="sd">        - :meth:`addDataField`</span>

<span class="sd">    Getters are also simple to use:</span>

<span class="sd">        - :meth:`getControlRecord`</span>
<span class="sd">        - :meth:`getDataRecords`</span>

<span class="sd">    :meth:`getControlRecord` is just wrapper over :attr:`controlfields` and</span>
<span class="sd">    works same way as accessing ``.controlfields[controlfield]``.</span>

<span class="sd">    ``.getDataRecords(datafield, subfield, throw_exceptions)`` return list of</span>
<span class="sd">    :class:`MarcSubrecord` objects* with informations from section `datafield`</span>
<span class="sd">    subsection `subfield`.</span>

<span class="sd">    If `throw_exceptions` parameter is set to ``False``, method returns empty</span>
<span class="sd">    list instead of throwing :exc:`~exceptions.KeyError`.</span>

<span class="sd">    \*As I said, function returns list of :class:`MarcSubrecord` objects. They</span>
<span class="sd">    are almost same thing as normal ``str`` (they are actually subclassed</span>
<span class="sd">    strings), but defines few important methods, which can make your life</span>
<span class="sd">    little bit easier:</span>

<span class="sd">        - :meth:`~MarcSubrecord.getI1`</span>
<span class="sd">        - :meth:`~MarcSubrecord.getI2`</span>
<span class="sd">        - :meth:`~MarcSubrecord.getOtherSubfiedls`</span>

<span class="sd">    :meth:`~MarcSubrecord.getOtherSubfiedls` returns dictionary with other</span>
<span class="sd">    subsections from subfield requested by calling :meth:`getDataRecords`. It</span>
<span class="sd">    works as backlink to object, from which you get the record.</span>

<span class="sd">    **Highlevel abstractions**</span>

<span class="sd">    There is also lot of highlevel getters:</span>

<span class="sd">        - :meth:`getName`</span>
<span class="sd">        - :meth:`getSubname`</span>
<span class="sd">        - :meth:`getPrice`</span>
<span class="sd">        - :meth:`getPart`</span>
<span class="sd">        - :meth:`getPartName`</span>
<span class="sd">        - :meth:`getPublisher`</span>
<span class="sd">        - :meth:`getPubDate`</span>
<span class="sd">        - :meth:`getPubOrder`</span>
<span class="sd">        - :meth:`getFormat`</span>
<span class="sd">        - :meth:`getPubPlace`</span>
<span class="sd">        - :meth:`getAuthors`</span>
<span class="sd">        - :meth:`getCorporations`</span>
<span class="sd">        - :meth:`getDistributors`</span>
<span class="sd">        - :meth:`getISBNs`</span>
<span class="sd">        - :meth:`getBinding`</span>
<span class="sd">        - :meth:`getOriginals`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leader</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_i_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="s">&quot; 0123456789&quot;</span><span class="p">)</span>

        <span class="c"># it is always possible to create blank object and add values into it</span>
        <span class="c"># piece by piece thru .addControlField()/.addDataField() methods.</span>
        <span class="k">if</span> <span class="n">xml</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_original_xml</span> <span class="o">=</span> <span class="n">xml</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parseString</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>

<div class="viewcode-block" id="MARCXMLRecord.addControlField"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.addControlField">[docs]</a>    <span class="k">def</span> <span class="nf">addControlField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new control field `value` with under `name` into control field</span>
<span class="sd">        dictionary :attr:`controlfields`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;name parameter have to be exactly 3 chars long!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.addDataField"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.addDataField">[docs]</a>    <span class="k">def</span> <span class="nf">addDataField</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">subfields_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add new datafield into :attr:`datafields`.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): name of datafield</span>
<span class="sd">            i1 (char): value of i1/ind1 parameter</span>
<span class="sd">            i2 (char): value of i2/ind2 parameter</span>
<span class="sd">            subfields_dict (dict): dictionary containing subfields</span>

<span class="sd">        `subfields_dict` is expected to be in this format::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;field_id&quot;: [&quot;subfield data&quot;,],</span>
<span class="sd">                ...</span>
<span class="sd">                &quot;z&quot;: [&quot;X0456b&quot;]</span>
<span class="sd">            }</span>

<span class="sd">        Warning:</span>
<span class="sd">            ``field_id`` can be only one character long!</span>

<span class="sd">        Function takes care of OAI MARC.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">i1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_i_chars</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid i1parameter &#39;&quot;</span> <span class="o">+</span> <span class="n">i1</span> <span class="o">+</span> <span class="s">&quot;&#39;!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_i_chars</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid i2parameter &#39;&quot;</span> <span class="o">+</span> <span class="n">i2</span> <span class="o">+</span> <span class="s">&quot;&#39;!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;name parameter have to be exactly 3 chars long!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subfields_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;subfields_dict parameter has to be dict instance!&quot;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">subfields_dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s">&quot;subfields_dict can be only one character long!&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subfields_dict</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s">&quot;Values at under &#39;&quot;</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;&#39; have to be list!&quot;</span>
                <span class="p">)</span>

        <span class="n">subfields_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i1</span>
        <span class="n">subfields_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">i2</span>

        <span class="c"># append dict, or add new dict into self.datafields</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfields_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">subfields_dict</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getControlRecord"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getControlRecord">[docs]</a>    <span class="k">def</span> <span class="nf">getControlRecord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controlfield</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return record from given `controlfield`. Returned type: str.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">[</span><span class="n">controlfield</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getDataRecords"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getDataRecords">[docs]</a>    <span class="k">def</span> <span class="nf">getDataRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafield</span><span class="p">,</span> <span class="n">subfield</span><span class="p">,</span> <span class="n">throw_exceptions</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return content of given `subfield` in `datafield`.</span>

<span class="sd">        Args:</span>
<span class="sd">            datafield (str): Section name (for example &quot;001&quot;, &quot;100&quot;, &quot;700&quot;)</span>
<span class="sd">            subfield (str):  Subfield name (for example &quot;a&quot;, &quot;1&quot;, etc..)</span>
<span class="sd">            throw_exceptions (bool): If ``True``, :exc:`~exceptions.KeyError` is</span>
<span class="sd">                                     raised if method couldn&#39;t found given</span>
<span class="sd">                                     `datafield`/`subfield`. If ``False``, blank</span>
<span class="sd">                                     array ``[]`` is returned.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: of :class:`MarcSubrecord`. MarcSubrecord is practically      \</span>
<span class="sd">        same thing as string, but has defined :meth:`~MarcSubrecord.getI1()`   \</span>
<span class="sd">        and :meth:`~MarcSubrecord.getI2()` properties. Believe me, you will    \</span>
<span class="sd">        need to be able to get this, because MARC XML depends on them from time\</span>
<span class="sd">        to time (name of authors for example).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datafield</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;datafield parameter have to be exactly 3 chars long!&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subfield</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;Bad subfield specification - subfield have to be 3 chars long!&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">datafield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">throw_exceptions</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">datafield</span> <span class="o">+</span> <span class="s">&quot; is not in datafields!&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">datafield</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">subfield</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">throw_exceptions</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">subfield</span> <span class="o">+</span> <span class="s">&quot; is not in subfields!&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[]</span>

            <span class="c"># records are not returned just like plain string, but like</span>
            <span class="c"># MarcSubrecord, because you will need ind1/ind2 values</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">subfield</span><span class="p">]:</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">MarcSubrecord</span><span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span>
                        <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span>
                        <span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span>
                        <span class="n">df</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getName"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getName">[docs]</a>    <span class="k">def</span> <span class="nf">getName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Name of the book.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: when name is not specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;245&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getSubname"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getSubname">[docs]</a>    <span class="k">def</span> <span class="nf">getSubname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            undefined (optional): returned if sub-name record is not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Sub-name of the book or `undefined` if name is not defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;245&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPrice"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPrice">[docs]</a>    <span class="k">def</span> <span class="nf">getPrice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Price of the book (with currency).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;020&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPart"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPart">[docs]</a>    <span class="k">def</span> <span class="nf">getPart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Which part of the book series is this record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;245&quot;</span><span class="p">,</span> <span class="s">&quot;p&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPartName"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPartName">[docs]</a>    <span class="k">def</span> <span class="nf">getPartName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Name of the part of the series.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;245&quot;</span><span class="p">,</span> <span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPublisher"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPublisher">[docs]</a>    <span class="k">def</span> <span class="nf">getPublisher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: name of the publisher (&quot;``Grada``&quot; for example)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;260&quot;</span><span class="p">,</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPubDate"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPubDate">[docs]</a>    <span class="k">def</span> <span class="nf">getPubDate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: date of publication (month and year usually)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;260&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPubOrder"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPubOrder">[docs]</a>    <span class="k">def</span> <span class="nf">getPubOrder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: information about order in which was the book published</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;901&quot;</span><span class="p">,</span> <span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getFormat"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getFormat">[docs]</a>    <span class="k">def</span> <span class="nf">getFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: dimensions of the book (&#39;``23 cm``&#39; for example)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;300&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getPubPlace"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getPubPlace">[docs]</a>    <span class="k">def</span> <span class="nf">getPubPlace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">undefined</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            str: name of city/country where the book was published</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_undefinedPattern</span><span class="p">(</span>
            <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;260&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
            <span class="n">undefined</span>
        <span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getAuthors"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getAuthors">[docs]</a>    <span class="k">def</span> <span class="nf">getAuthors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: authors represented as Person objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">authors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsePersons</span><span class="p">(</span><span class="s">&quot;100&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">authors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsePersons</span><span class="p">(</span><span class="s">&quot;600&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">authors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsePersons</span><span class="p">(</span><span class="s">&quot;700&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>
        <span class="n">authors</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsePersons</span><span class="p">(</span><span class="s">&quot;800&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">authors</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getCorporations"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getCorporations">[docs]</a>    <span class="k">def</span> <span class="nf">getCorporations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;dst&quot;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            roles (list, optional): specify which types of corporations you</span>
<span class="sd">                  need. Set to ``[&quot;any&quot;]`` for any role, ``[&quot;dst&quot;]`` for</span>
<span class="sd">                  distributors, etc..</span>
<span class="sd">                  See http://www.loc.gov/marc/relators/relaterm.html for</span>
<span class="sd">                  details.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: :class:`Corporation` objects specified by roles parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">corporations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parseCorporations</span><span class="p">(</span><span class="s">&quot;110&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span>
        <span class="n">corporations</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parseCorporations</span><span class="p">(</span><span class="s">&quot;610&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span>
        <span class="n">corporations</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parseCorporations</span><span class="p">(</span><span class="s">&quot;710&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span>
        <span class="n">corporations</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parseCorporations</span><span class="p">(</span><span class="s">&quot;810&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">corporations</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getDistributors"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getDistributors">[docs]</a>    <span class="k">def</span> <span class="nf">getDistributors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: distributors represented as :class:`Corporation` object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCorporations</span><span class="p">(</span><span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;dst&quot;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getISBNs"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getISBNs">[docs]</a>    <span class="k">def</span> <span class="nf">getISBNs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: array with ISBN strings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;020&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">ISBN</span><span class="p">:</span> <span class="n">ISBN</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;020&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;901&quot;</span><span class="p">,</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">ISBN</span><span class="p">:</span> <span class="n">ISBN</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;901&quot;</span><span class="p">,</span> <span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getBinding"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getBinding">[docs]</a>    <span class="k">def</span> <span class="nf">getBinding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: array of strings with bindings (``[&quot;brož.&quot;]``) or blank list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;020&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">filter</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="s">&quot; &quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;020&quot;</span><span class="p">,</span> <span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getOriginals"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getOriginals">[docs]</a>    <span class="k">def</span> <span class="nf">getOriginals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns:</span>
<span class="sd">            list: of original names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="s">&quot;765&quot;</span><span class="p">,</span> <span class="s">&quot;t&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MARCXMLRecord.getI"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.getI">[docs]</a>    <span class="k">def</span> <span class="nf">getI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">is_oai</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is used mainly internally, but it can be handy if you work</span>
<span class="sd">        with with raw MARC XML object and not using getters.</span>

<span class="sd">        Args:</span>
<span class="sd">            num (int): Which indicator you need (1/2).</span>
<span class="sd">            is_oai (bool/None): If None, :attr:`MARCXMLRecord.oai_marc` is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: current name of ``i1``/``ind1`` parameter based on \</span>
<span class="sd">                 :attr:`oai_marc` property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;num parameter have to be 1 or 2!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">is_oai</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">is_oai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span>

        <span class="n">i_name</span> <span class="o">=</span> <span class="s">&quot;ind&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_oai</span> <span class="k">else</span> <span class="s">&quot;i&quot;</span>

        <span class="k">return</span> <span class="n">i_name</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_parseCorporations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafield</span><span class="p">,</span> <span class="n">subfield</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;any&quot;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse informations about corporations from given field identified</span>
<span class="sd">        by `datafield` parameter.</span>

<span class="sd">        Args:</span>
<span class="sd">            datafield (str): MARC field ID (&quot;``110``&quot;, &quot;``610``&quot;, etc..)</span>
<span class="sd">            subfield (str):  MARC subfield ID with name, which is typically</span>
<span class="sd">                             stored in &quot;``a``&quot; subfield.</span>
<span class="sd">            roles (str): specify which roles you need. Set to ``[&quot;any&quot;]`` for</span>
<span class="sd">                         any role, ``[&quot;dst&quot;]`` for distributors, etc.. For</span>
<span class="sd">                         details, see</span>
<span class="sd">                         http://www.loc.gov/marc/relators/relaterm.html</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: :class:`Corporation` objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">datafield</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;datafield parameter have to be exactly 3 chars long!&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">subfield</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;Bad subfield specification - subield have to be 3 chars long!&quot;</span>
            <span class="p">)</span>
        <span class="n">parsed_corporations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">corporation</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="n">datafield</span><span class="p">,</span> <span class="n">subfield</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
            <span class="n">other_subfields</span> <span class="o">=</span> <span class="n">corporation</span><span class="o">.</span><span class="n">getOtherSubfiedls</span><span class="p">()</span>

            <span class="c"># check if corporation have at least one of the roles specified in</span>
            <span class="c"># &#39;roles&#39; parameter of function</span>
            <span class="k">if</span> <span class="s">&quot;4&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span> <span class="ow">and</span> <span class="n">roles</span> <span class="o">!=</span> <span class="p">[</span><span class="s">&quot;any&quot;</span><span class="p">]:</span>
                <span class="n">corp_roles</span> <span class="o">=</span> <span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;4&quot;</span><span class="p">]</span>  <span class="c"># list of role parameters</span>

                <span class="n">relevant</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">role</span><span class="p">:</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">,</span> <span class="n">corp_roles</span><span class="p">))</span>

                <span class="c"># skip non-relevant corporations</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">relevant</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">place</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">date</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">corporation</span>

            <span class="k">if</span> <span class="s">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span><span class="p">:</span>
                <span class="n">place</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&quot;d&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">])</span>

            <span class="n">parsed_corporations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Corporation</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">place</span><span class="p">,</span> <span class="n">date</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">parsed_corporations</span>

    <span class="k">def</span> <span class="nf">_parsePersons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datafield</span><span class="p">,</span> <span class="n">subfield</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;aut&quot;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse persons from given datafield.</span>

<span class="sd">        Args:</span>
<span class="sd">            datafield (str): code of datafield (&quot;010&quot;, &quot;730&quot;, etc..)</span>
<span class="sd">            subfield (char):  code of subfield (&quot;a&quot;, &quot;z&quot;, &quot;4&quot;, etc..)</span>
<span class="sd">            role (list of str): set to [&quot;any&quot;] for any role, [&quot;aut&quot;] for</span>
<span class="sd">                 authors, etc.. For details see</span>
<span class="sd">                 http://www.loc.gov/marc/relators/relaterm.html</span>

<span class="sd">        Main records for persons are: &quot;100&quot;, &quot;600&quot; and &quot;700&quot;, subrecords &quot;c&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Person objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># parse authors</span>
        <span class="n">parsed_persons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_persons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDataRecords</span><span class="p">(</span><span class="n">datafield</span><span class="p">,</span> <span class="n">subfield</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">raw_persons</span><span class="p">:</span>
            <span class="n">ind1</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">getI1</span><span class="p">()</span>
            <span class="n">ind2</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">getI2</span><span class="p">()</span>
            <span class="n">other_subfields</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">getOtherSubfiedls</span><span class="p">()</span>

            <span class="c"># check if person have at least one of the roles specified in</span>
            <span class="c"># &#39;roles&#39; parameter of function</span>
            <span class="k">if</span> <span class="s">&quot;4&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span> <span class="ow">and</span> <span class="n">roles</span> <span class="o">!=</span> <span class="p">[</span><span class="s">&quot;any&quot;</span><span class="p">]:</span>
                <span class="n">person_roles</span> <span class="o">=</span> <span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;4&quot;</span><span class="p">]</span>  <span class="c"># list of role parameters</span>

                <span class="n">relevant</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">role</span><span class="p">:</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">,</span> <span class="n">person_roles</span><span class="p">))</span>

                <span class="c"># skip non-relevant persons</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">relevant</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="c"># result is string, so ind1/2 in MarcSubrecord are lost</span>
            <span class="n">person</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">second_name</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">surname</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

            <span class="c"># here it gets nasty - there is lot of options in ind1/ind2</span>
            <span class="c"># parameters</span>
            <span class="k">if</span> <span class="n">ind1</span> <span class="o">==</span> <span class="s">&quot;1&quot;</span> <span class="ow">and</span> <span class="n">ind2</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&quot;,&quot;</span> <span class="ow">in</span> <span class="n">person</span><span class="p">:</span>
                    <span class="n">surname</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s">&quot; &quot;</span> <span class="ow">in</span> <span class="n">person</span><span class="p">:</span>
                    <span class="n">surname</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">surname</span> <span class="o">=</span> <span class="n">person</span>

                <span class="k">if</span> <span class="s">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">ind1</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">ind2</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="s">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span><span class="p">:</span>
                    <span class="n">second_name</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="s">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span><span class="p">:</span>
                    <span class="n">surname</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">ind1</span> <span class="o">==</span> <span class="s">&quot;1&quot;</span> <span class="ow">and</span> <span class="n">ind2</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span> <span class="ow">or</span> <span class="n">ind1</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span> <span class="ow">and</span> <span class="n">ind2</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">person</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&quot;c&quot;</span> <span class="ow">in</span> <span class="n">other_subfields</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other_subfields</span><span class="p">[</span><span class="s">&quot;c&quot;</span><span class="p">])</span>

            <span class="n">parsed_persons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Person</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="n">second_name</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="n">surname</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
                    <span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">parsed_persons</span>

    <span class="k">def</span> <span class="nf">__parseString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse MARC XML document to dicts, which are contained in</span>
<span class="sd">        self.controlfields and self.datafields.</span>

<span class="sd">        Args:</span>
<span class="sd">            xml (str or HTMLElement): input data</span>

<span class="sd">        Also detect if this is oai marc format or not (see elf.oai_marc).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xml</span><span class="p">,</span> <span class="n">HTMLElement</span><span class="p">):</span>
            <span class="n">xml</span> <span class="o">=</span> <span class="n">dhtmlparser</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">xml</span><span class="p">))</span>

        <span class="c"># check if there are any records</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;record&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;There is no &lt;record&gt; in your MARC XML document!&quot;</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;oai_marc&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="c"># leader is separate only in marc21</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span><span class="p">:</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;leader&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">leader</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">leader</span> <span class="o">=</span> <span class="n">leader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span>

        <span class="c"># parse body in respect of OAI MARC format possibility</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parseControlFields</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;fixfield&quot;</span><span class="p">),</span> <span class="s">&quot;id&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parseDataFields</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;varfield&quot;</span><span class="p">),</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;label&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parseControlFields</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;controlfield&quot;</span><span class="p">),</span> <span class="s">&quot;tag&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__parseDataFields</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;datafield&quot;</span><span class="p">),</span> <span class="s">&quot;tag&quot;</span><span class="p">,</span> <span class="s">&quot;code&quot;</span><span class="p">)</span>

        <span class="c"># for backward compatibility of MARC XML with OAI</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="ow">and</span> <span class="s">&quot;LDR&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">leader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">[</span><span class="s">&quot;LDR&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__parseControlFields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tag_id</span><span class="o">=</span><span class="s">&quot;tag&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse control fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            fields (list): list of HTMLElements</span>
<span class="sd">            tag_id (str):  parameter name, which holds the information, about</span>
<span class="sd">                           field name this is normally &quot;tag&quot;, but in case of</span>
<span class="sd">                           oai_marc &quot;id&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">params</span>
            <span class="k">if</span> <span class="n">tag_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>  <span class="c"># skip tags with blank parameters</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="n">tag_id</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__parseDataFields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">tag_id</span><span class="o">=</span><span class="s">&quot;tag&quot;</span><span class="p">,</span> <span class="n">sub_id</span><span class="o">=</span><span class="s">&quot;code&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse data fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            fields (list): of HTMLElements</span>
<span class="sd">            tag_id (str): parameter name, which holds the information, about</span>
<span class="sd">                          field name this is normally &quot;tag&quot;, but in case of</span>
<span class="sd">                          oai_marc &quot;id&quot;</span>
<span class="sd">            sub_id (str): id of parameter, which holds informations about</span>
<span class="sd">                          subfield name this is normally &quot;code&quot; but in case of</span>
<span class="sd">                          oai_marc &quot;label&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">field_repr</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">params</span>

            <span class="k">if</span> <span class="n">tag_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">tag</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">tag_id</span><span class="p">]</span>

            <span class="c"># take care of iX/indX parameter - I have no idea what is this, but</span>
            <span class="c"># they look important (=they are everywhere)</span>
            <span class="n">i1_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">i2_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">field_repr</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">i1_name</span><span class="p">:</span> <span class="s">&quot; &quot;</span> <span class="k">if</span> <span class="n">i1_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="n">i1_name</span><span class="p">],</span>
                <span class="n">i2_name</span><span class="p">:</span> <span class="s">&quot; &quot;</span> <span class="k">if</span> <span class="n">i2_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span> <span class="k">else</span> <span class="n">params</span><span class="p">[</span><span class="n">i2_name</span><span class="p">],</span>
            <span class="p">}</span>

            <span class="c"># process all subfields</span>
            <span class="k">for</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;subfield&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sub_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subfield</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">subfield</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">sub_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">field_repr</span><span class="p">:</span>
                    <span class="n">field_repr</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subfield</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">field_repr</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">subfield</span><span class="o">.</span><span class="n">getContent</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_repr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">field_repr</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__serializeControlFields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s">&#39;&lt;$TAGNAME $FIELD_NAME=&quot;$FIELD_ID&quot;&gt;$CONTENT&lt;/$TAGNAME&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">tagname</span> <span class="o">=</span> <span class="s">&quot;controlfield&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="k">else</span> <span class="s">&quot;fixfield&quot;</span>
        <span class="n">field_name</span> <span class="o">=</span> <span class="s">&quot;tag&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="k">else</span> <span class="s">&quot;id&quot;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">resorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">):</span>
            <span class="c"># some control fields are specific for oai</span>
            <span class="c"># if not self.oai_marc and field_id in [&quot;LDR&quot;, &quot;FMT&quot;]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field_id</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">continue</span>

            <span class="n">output</span> <span class="o">+=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span>
                <span class="n">TAGNAME</span><span class="o">=</span><span class="n">tagname</span><span class="p">,</span>
                <span class="n">FIELD_NAME</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                <span class="n">FIELD_ID</span><span class="o">=</span><span class="n">field_id</span><span class="p">,</span>
                <span class="n">CONTENT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">controlfields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">__serializeDataSubfields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subfields</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&lt;$TAGNAME $FIELD_NAME=&quot;$FIELD_ID&quot;&gt;$CONTENT&lt;/$TAGNAME&gt;&#39;</span>

        <span class="n">tagname</span> <span class="o">=</span> <span class="s">&quot;subfield&quot;</span>
        <span class="n">field_name</span> <span class="o">=</span> <span class="s">&quot;code&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="k">else</span> <span class="s">&quot;label&quot;</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">resorted</span><span class="p">(</span><span class="n">subfields</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">subfield</span> <span class="ow">in</span> <span class="n">subfields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]:</span>
                <span class="n">output</span> <span class="o">+=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span>
                    <span class="n">TAGNAME</span><span class="o">=</span><span class="n">tagname</span><span class="p">,</span>
                    <span class="n">FIELD_NAME</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                    <span class="n">FIELD_ID</span><span class="o">=</span><span class="n">field_id</span><span class="p">,</span>
                    <span class="n">CONTENT</span><span class="o">=</span><span class="n">subfield</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">__serializeDataFields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s">&#39;&lt;$TAGNAME $FIELD_NAME=&quot;$FIELD_ID&quot; $I1_NAME=&quot;$I1_VAL&quot; &#39;</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="s">&#39;$I2_NAME=&quot;$I2_VAL&quot;&gt;&#39;</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="s">&#39;$CONTENT</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">template</span> <span class="o">+=</span> <span class="s">&#39;&lt;/$TAGNAME&gt;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="n">tagname</span> <span class="o">=</span> <span class="s">&quot;datafield&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="k">else</span> <span class="s">&quot;varfield&quot;</span>
        <span class="n">field_name</span> <span class="o">=</span> <span class="s">&quot;tag&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="k">else</span> <span class="s">&quot;id&quot;</span>

        <span class="n">i1_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">i2_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="n">resorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">):</span>
            <span class="c"># unpac dicts from array</span>
            <span class="k">for</span> <span class="n">dict_field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">datafields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]:</span>
                <span class="c"># this allows to convert between OAI and XML formats simply</span>
                <span class="c"># by switching .oai_marc property</span>
                <span class="n">real_i1_name</span> <span class="o">=</span> <span class="n">i1_name</span> <span class="k">if</span> <span class="n">i1_name</span> <span class="ow">in</span> <span class="n">dict_field</span> \
                                       <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span><span class="p">)</span>
                <span class="n">real_i2_name</span> <span class="o">=</span> <span class="n">i2_name</span> <span class="k">if</span> <span class="n">i2_name</span> <span class="ow">in</span> <span class="n">dict_field</span> \
                                       <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getI</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span><span class="p">)</span>

                <span class="n">i1_val</span> <span class="o">=</span> <span class="n">dict_field</span><span class="p">[</span><span class="n">real_i1_name</span><span class="p">]</span>
                <span class="n">i2_val</span> <span class="o">=</span> <span class="n">dict_field</span><span class="p">[</span><span class="n">real_i2_name</span><span class="p">]</span>

                <span class="c"># temporarily remove i1/i2 from dict</span>
                <span class="k">del</span> <span class="n">dict_field</span><span class="p">[</span><span class="n">real_i1_name</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">dict_field</span><span class="p">[</span><span class="n">real_i2_name</span><span class="p">]</span>

                <span class="n">output</span> <span class="o">+=</span> <span class="n">Template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span>
                    <span class="n">TAGNAME</span><span class="o">=</span><span class="n">tagname</span><span class="p">,</span>
                    <span class="n">FIELD_NAME</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                    <span class="n">FIELD_ID</span><span class="o">=</span><span class="n">field_id</span><span class="p">,</span>
                    <span class="n">I1_NAME</span><span class="o">=</span><span class="n">i1_name</span><span class="p">,</span>
                    <span class="n">I2_NAME</span><span class="o">=</span><span class="n">i2_name</span><span class="p">,</span>
                    <span class="n">I1_VAL</span><span class="o">=</span><span class="n">i1_val</span><span class="p">,</span>
                    <span class="n">I2_VAL</span><span class="o">=</span><span class="n">i2_val</span><span class="p">,</span>
                    <span class="n">CONTENT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__serializeDataSubfields</span><span class="p">(</span><span class="n">dict_field</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c"># put back temporarily removed i1/i2</span>
                <span class="n">dict_field</span><span class="p">[</span><span class="n">real_i1_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i1_val</span>
                <span class="n">dict_field</span><span class="p">[</span><span class="n">real_i2_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2_val</span>

        <span class="k">return</span> <span class="n">output</span>

<div class="viewcode-block" id="MARCXMLRecord.toXML"><a class="viewcode-back" href="../../api/aleph.marcxml.html#aleph.marcxml.MARCXMLRecord.toXML">[docs]</a>    <span class="k">def</span> <span class="nf">toXML</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert object back to XML string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: String which should be same as original input, if everything\</span>
<span class="sd">                 works as expected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">marcxml_template</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;record xmlns=&quot;http://www.loc.gov/MARC21/slim/&quot;</span>
<span class="s">xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="s">xsi:schemaLocation=&quot;http://www.loc.gov/MARC21/slim</span>
<span class="s">http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd&quot;&gt;</span>
<span class="s">$LEADER</span>
<span class="s">$CONTROL_FIELDS</span>
<span class="s">$DATA_FIELDS</span>
<span class="s">&lt;/record&gt;</span>
<span class="s">&quot;&quot;&quot;</span>

        <span class="n">oai_template</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;record&gt;</span>
<span class="s">&lt;metadata&gt;</span>
<span class="s">&lt;oai_marc&gt;</span>
<span class="s">$LEADER$CONTROL_FIELDS</span>
<span class="s">$DATA_FIELDS</span>
<span class="s">&lt;/oai_marc&gt;</span>
<span class="s">&lt;/metadata&gt;</span>
<span class="s">&lt;/record&gt;</span>
<span class="s">&quot;&quot;&quot;</span>

        <span class="c"># serialize leader, if it is present and record is marc xml</span>
        <span class="n">leader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leader</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">leader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">leader</span><span class="p">:</span>  <span class="c"># print only visible leaders</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="s">&quot;&lt;leader&gt;&quot;</span> <span class="o">+</span> <span class="n">leader</span> <span class="o">+</span> <span class="s">&quot;&lt;/leader&gt;&quot;</span>

        <span class="c"># discard leader for oai</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span><span class="p">:</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>

        <span class="c"># serialize</span>
        <span class="n">xml_template</span> <span class="o">=</span> <span class="n">oai_template</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oai_marc</span> <span class="k">else</span> <span class="n">marcxml_template</span>
        <span class="n">xml_output</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">xml_template</span><span class="p">)</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span>
            <span class="n">LEADER</span><span class="o">=</span><span class="n">leader</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="n">CONTROL_FIELDS</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__serializeControlFields</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="n">DATA_FIELDS</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__serializeDataFields</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">xml_output</span>
</div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toXML</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/nkp_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">edeposit.amqp.aleph 1.6.4 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
          <li><a href="../aleph.html" >aleph</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014 E-deposit team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>