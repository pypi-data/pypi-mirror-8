<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Map Views &mdash; django-wms 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="django-wms 0.1.0 documentation" href="index.html" />
    <link rel="prev" title="Maps" href="maps.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="maps.html" title="Maps"
             accesskey="P">previous</a> |</li>
        <li><a href="toc.html">django-wms 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="map-views">
<h1>Map Views<a class="headerlink" href="#map-views" title="Permalink to this headline">¶</a></h1>
<p>The third step in creating a map service is to create a class based view by extending the <tt class="docutils literal"><span class="pre">WmsView</span></tt> class. The WmsView class passes the request from django to mapscript and returns the rendered image. By default, the WmsView acts as a proper Web Map Service view, and expects the corresponding parameters in the html request for it to work. It can also act as Tile Map Service if the urlpattern is configured accordingly (see below).</p>
<p>After creating at least one WmsLayer and adding it to a WmsMap, the WmsView can be setup by sublcassing VmsView and pointing the newly created class to the WmsMap subclass.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># In myapp.wmsviews</span>

<span class="kn">from</span> <span class="nn">wms.views</span> <span class="kn">import</span> <span class="n">WmsView</span>
<span class="kn">from</span> <span class="nn">myapp.wmsmaps</span> <span class="kn">import</span> <span class="n">MyWmsMap</span>

<span class="k">class</span> <span class="nc">MyWmsView</span><span class="p">(</span><span class="n">WmsView</span><span class="p">):</span>
    <span class="n">map_class</span> <span class="o">=</span> <span class="n">MyWmsMap</span>
</pre></div>
</div>
<div class="section" id="web-map-server">
<h2>Web Map Server<a class="headerlink" href="#web-map-server" title="Permalink to this headline">¶</a></h2>
<p>With a view prepared, the view can be added to a url pattern by calling the <tt class="docutils literal"><span class="pre">as_view()</span></tt> method, which will return a proper view function. In the case of a WMS url, the url pattern is straightforward.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span><span class="n">url</span>
<span class="kn">from</span> <span class="nn">myapp.wmsviews</span> <span class="kn">import</span> <span class="n">MyWmsView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># WMS endpoint</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^wms/$&#39;</span><span class="p">,</span> <span class="n">MyWmsView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;wms&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Since MapServer works with query parameters, the WmsView urlpattern is simple, all additional information is passed on through the GET request parameters. The WmsView will automatically handle those request parameters to render a corresponding image.</p>
</div>
<div class="section" id="tile-map-server-xyz">
<h2>Tile Map Server (XYZ)<a class="headerlink" href="#tile-map-server-xyz" title="Permalink to this headline">¶</a></h2>
<p>The same view can also be used to create a Tile Map Service. The TMS functionality looks for five arguments it obtains from the urlpattern: <cite>layers</cite>, <cite>x</cite>, <cite>y</cite>, <cite>z</cite> and <cite>format</cite>. If those three arguments are present in the urlpattern, the view will act as a tile map service and return the corresponding indexed tile for the layer and format requested. An example url configuration could look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span><span class="n">url</span>
<span class="kn">from</span> <span class="nn">myapp.wmsviews</span> <span class="kn">import</span> <span class="n">MyWmsView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># TMS endpoint</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tile/(?P&lt;layers&gt;[^/]+)/(?P&lt;z&gt;[0-9]+)/(?P&lt;x&gt;[0-9]+)/(?P&lt;y&gt;[0-9]+)(?P&lt;format&gt;\.jpg|\.png)$&#39;</span><span class="p">,</span>
        <span class="n">MyWmsView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;tile&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In the TMS case, the WmsView calculates the lat/lon bounds for the requested tile behind the scenes and passes that on to the &#8220;normal&#8221; WmsView mode. The TMS functionality is thus simply a routine that is sandwiched between the normal WmsView part and the request, dynamically calculating tile bounds from the x-y-z indices.</p>
</div>
<div class="section" id="caching">
<h2>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h2>
<p>For larger data sets, the dynamic rendering of WMS or TMS request can be quite expensive. Also, for mapping applications, the requested map fragments are often repeated. This is specially true for indexed tiles, as those have short and static urls. WMS requests often have coordinate values that are floating point numbers and tend to vary more.</p>
<p>In any case, it is recommended to use the django-wms package in combination with a caching framework. If a caching backend is configured, caching the map service views is trivial. One simple example is the following, where the reuqested tiles would be cached for 24 hours</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.views.decorators.cache</span> <span class="kn">import</span> <span class="n">cache_page</span>

<span class="n">url</span><span class="p">(</span><span class="s">r&#39;^tile/(?P&lt;layers&gt;[^/]+)/(?P&lt;z&gt;[0-9]+)/(?P&lt;x&gt;[0-9]+)/(?P&lt;y&gt;[0-9]+)(?P&lt;format&gt;\.jpg|\.png)$&#39;</span><span class="p">,</span>
    <span class="n">cache_page</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)(</span><span class="n">MyWmsView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;tile&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>For more information on how to setup caching with django, see the <a class="reference external" href="https://docs.djangoproject.com/en/dev/topics/cache/">official documentation</a>.</p>
</div>
<div class="section" id="module-docs">
<h2>Module docs<a class="headerlink" href="#module-docs" title="Permalink to this headline">¶</a></h2>
<p>Auto-generated part of the module documentation.</p>
<span class="target" id="module-wms.views"></span><dl class="class">
<dt id="wms.views.WmsView">
<em class="property">class </em><tt class="descclassname">wms.views.</tt><tt class="descname">WmsView</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/wms/views.html#WmsView"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wms.views.WmsView" title="Permalink to this definition">¶</a></dt>
<dd><p>WMS view class for setting up WMS endpoints</p>
<dl class="method">
<dt id="wms.views.WmsView.get">
<tt class="descname">get</tt><big>(</big><em>request</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/wms/views.html#WmsView.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wms.views.WmsView.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Html GET method of WmsView. This view renders WMS requests into 
corresponding responses using the attached WmsMap class.
Responses are mainly images and xml files.</p>
</dd></dl>

<dl class="method">
<dt id="wms.views.WmsView.get_tile_bounds">
<tt class="descname">get_tile_bounds</tt><big>(</big><em>x</em>, <em>y</em>, <em>z</em><big>)</big><a class="reference internal" href="_modules/wms/views.html#WmsView.get_tile_bounds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wms.views.WmsView.get_tile_bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates tile bounding box from Tile Map Service XYZ indices.</p>
</dd></dl>

<dl class="method">
<dt id="wms.views.WmsView.tiles">
<tt class="descname">tiles</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/wms/views.html#WmsView.tiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#wms.views.WmsView.tiles" title="Permalink to this definition">¶</a></dt>
<dd><p>This method checks the url parameters for xyz arguments, if found it
uses those to compute bounds for wms rendering.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="toc.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Django WMS Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="maps.html">Maps</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Map Views</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#web-map-server">Web Map Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tile-map-server-xyz">Tile Map Server (XYZ)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#caching">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-docs">Module docs</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/views.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="maps.html" title="Maps"
             >previous</a> |</li>
        <li><a href="toc.html">django-wms 0.1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Daniel Wiesmann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>