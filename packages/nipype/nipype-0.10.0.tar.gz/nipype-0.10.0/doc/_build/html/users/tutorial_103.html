<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python - Pipelines and Interfaces &mdash; nipy pipeline and interfaces package</title>
    
    <link rel="stylesheet" href="../_static/nipype.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="nipy pipeline and interfaces package" href="../index.html" />
 
<meta name="keywords" content="nipype, neuroimaging, pipeline, workflow, parallel, python, neuroscience">
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-339450-7', 'nipy.org/nipype');
  ga('send', 'pageview');
</script>

  </head>
  <body>
<div class="header-wrapper">
    <div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
            <a href="../index.html">
            <img src="../_static/nipype-banner-bg.png" alt="NIPY logo"  border="0" />
        <div style="margin-top: 1em;
                border-top: 1px solid #AAA;
                border-bottom: 1px solid #AAA;
                border-radius: 5px;
                padding: 3px 1em;">
            <link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />
<style type="text/css">
    a.navbar {
    color: ;
    letter-spacing: .05em;
    font-weight: bold;
        }
</style>

<a class="navbar" href="../index.html">Home</a> ·
<a class="navbar" href="../quickstart.html">Quickstart</a> ·
<a class="navbar" href="../documentation.html">Documentation</a> ·
<a class="navbar" href="../about.html">Citation</a> ·
<a class="navbar" href="http://nipy.org">NiPy</a>

        </div>
    </div>
</div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<style type="text/css">
    input.gsc-input {
        border-color: #BCCDF0;
    }
    input.gsc-search-button {
        border-color: #666666;
        background-color: #CECECE;
        padding: 0;
    }
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
    div.sphinxsidebar input[type="text"] {
        width: 100%;
    }
    div.sphinxsidebar input[type="submit"] {
        width: 100%;
    }
</style>

<div class="sidebarblock">
    <div id="cse-search-form">Loading</div>

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load('search', '1', {language : 'en'});
        google.setOnLoadCallback(function() {
            var customSearchControl = new google.search.CustomSearchControl(
                    '010960497803984932957:u8pmqf7fdoq');

            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.enableSearchboxOnly("../searchresults.html");
            customSearchControl.draw('cse-search-form', options);
        }, true);
    </script>
</div>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Pipeline 103</a><ul>
<li><a class="reference internal" href="#modifying-inputs-to-pipeline-nodes">Modifying inputs to pipeline nodes</a></li>
<li><a class="reference internal" href="#distributed-computation">Distributed computation</a></li>
<li><a class="reference internal" href="#debugging">Debugging</a></li>
<li><a class="reference internal" href="#relocation-of-workdir">Relocation of workdir</a></li>
</ul>
</li>
</ul>

<style type="text/css">
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
</style>
<div class="sidebarblock">
    <h3>Versions</h3>

    <div class="tile">
        <table style="width: 100%;">
            <tr style="font-weight: bold;">
                <td align="left">Release</td><td align="right">Devel</td>
            </tr>
            <tr>
                <td align="left">0.10.0</td><td align="right">1.0-dev</td>
            </tr>
            <tr>
                <td align="left"><a href="install.html">Download</a></td>
                <td align="right"><a href="https://github.com/nipy/nipype">Github</a></td>
            </tr>
        </table>
    </div>

    <div id="buttons">
        <div id="ohloh-use" style="margin-right: 25px; margin-top: -2px; float: left;">
            <script type="text/javascript"
                    src="http://www.ohloh.net/p/480871/widgets/project_users_logo.js">
            </script>
        </div><!-- use -->
        <g:plusone size="medium" annotation="none"></g:plusone>
        <div class="clear"></div>
    </div><!-- buttons container -->
</div>


<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>

<h3>Links</h3>

<ul>
    <li>Docs: <a href="http://nipy.org/nipype">Stable</a> · <a href="http://www.mit.edu/~satra/nipype-nightly/">Nightly</a></li>
    <li>Code: <a href="http://github.com/nipy/nipype">Github</a> · <a href="http://github.com/nipy/nipype/issues">Bugs-Requests</a></li>
    <li>Forum: <a href="http://neurostars.org/t/nipype">User</a> · <a href="http://projects.scipy.org/mailman/listinfo/nipy-devel">Developer</a></li>
    <li><a href="http://nipy.org/software/license/index.html"><img src="https://pypip.in/license/nipype/badge.png" alt="License"></a> · <a href="http://nipy.org/about/funding.html">Funding</a></li>
    <li><a href="https://travis-ci.org/nipy/nipype"><img src="https://travis-ci.org/nipy/nipype.png?branch=master" alt="travis"></a> · <a href='https://coveralls.io/r/nipy/nipype'><img src='https://coveralls.io/repos/nipy/nipype/badge.png' alt='Coverage Status' /></a></li>
    <li><a href="https://pypi.python.org/pypi/nipype/"><img src="https://pypip.in/download/nipype/badge.png" alt="Downloads"></a> · <a href='https://pypi.python.org/pypi/nipype/'><img src='https://pypip.in/py_versions/nipype/badge.png' alt='Python Versions' /></a></li>
</ul>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pipeline-103">
<span id="tutorial-103"></span><h1>Pipeline 103<a class="headerlink" href="#pipeline-103" title="Permalink to this headline">¶</a></h1>
<div class="section" id="modifying-inputs-to-pipeline-nodes">
<h2>Modifying inputs to pipeline nodes<a class="headerlink" href="#modifying-inputs-to-pipeline-nodes" title="Permalink to this headline">¶</a></h2>
<p>Two nodes can be connected as shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="s">&#39;realigned_files&#39;</span><span class="p">,</span> <span class="n">smoother</span><span class="p">,</span> <span class="s">&#39;infile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The connection mechanism allows for a function to be evaluated on the
output field (&#8216;realigned files&#8217;) of the source node (realigner) and
have its result be sent to the input field (&#8216;infile&#8217;) of the
destination node (smoother).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">reverse_order</span><span class="p">(</span><span class="n">inlist</span><span class="p">):</span>
    <span class="n">inlist</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">inlist</span>

<span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;realigned_files&#39;</span><span class="p">,</span> <span class="n">reverse_order</span><span class="p">),</span>
                 <span class="n">smoother</span><span class="p">,</span> <span class="s">&#39;infile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be extended to provide additional arguments to the
function. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="n">inlist</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
   <span class="k">return</span> <span class="p">[</span><span class="n">inlist</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>

<span class="n">workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">realigner</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;realigned_files&#39;</span><span class="p">,</span> <span class="n">reorder</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                 <span class="n">smoother</span><span class="p">,</span> <span class="s">&#39;infile&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, we assume the realigned_files produces a list of 4
files. We can reorder these files in a particular order using the
modifier. Since such modifications are not tracked, they should be
used with extreme care and only in cases where absolutely
necessary. Often, one may find that it is better to insert a node
rather than a function.</p>
</div>
<div class="section" id="distributed-computation">
<h2>Distributed computation<a class="headerlink" href="#distributed-computation" title="Permalink to this headline">¶</a></h2>
<p>The pipeline engine has built-in support for distributed computation on
clusters. This can be achieved via plugin-modules for <a class="reference external" href="http://www.python.org">Python</a> multiprocessing or
the <a class="reference external" href="http://ipython.scipy.org">IPython</a> distributed computing interface or SGE/PBS/Condor, provided the
user sets up a workflow on a shared filesystem. These modules can take arguments
that specify additional distribution engine parameters. For <a class="reference external" href="http://ipython.scipy.org">IPython</a> the
environment needs to be configured for distributed operation. Details are
available at <a class="reference internal" href="plugins.html#plugins"><em>Using Nipype Plugins</em></a>.</p>
<p>The default behavior is to run in series using the Linear plugin.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>In some cases it may be advantageous to run the workflow in series locally
(e.g., debugging, small-short pipelines, large memory only interfaces,
relocating working directory/updating hashes).</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>When a crash happens while running a pipeline, a crashdump is stored in
the pipeline&#8217;s working directory unless the config option &#8216;crashdumpdir&#8217;
has been set (see :ref:config_options).</p>
<p>The crashdump is a compressed numpy file that stores a dictionary
containing three fields:</p>
<blockquote>
<div><ol class="arabic simple">
<li>node - the node that failed</li>
<li>execgraph - the graph that the node came from</li>
<li>traceback - from local or remote session for the failure.</li>
</ol>
</div></blockquote>
<p>We keep extending the information contained in the file and making
it easier to troubleshoot the failures. However, in the meantime the following
can help to recover information related to the failure.</p>
<p>in <a class="reference external" href="http://ipython.scipy.org">IPython</a> do (<tt class="docutils literal"><span class="pre">%pdb</span></tt> in <a class="reference external" href="http://ipython.scipy.org">IPython</a> is similar to <tt class="docutils literal"><span class="pre">dbstop</span></tt> if error in
Matlab):</p>
<div class="highlight-python"><div class="highlight"><pre>from nipype.utils.filemanip import loadflat
crashinfo = loadflat(&#39;crashdump....npz&#39;)
%pdb
crashinfo[&#39;node&#39;].run()  # re-creates the crash
pdb&gt; up  #typically, but not necessarily the crash is one stack frame up
pdb&gt; inspect variables
pdb&gt;quit
</pre></div>
</div>
</div>
<div class="section" id="relocation-of-workdir">
<h2>Relocation of workdir<a class="headerlink" href="#relocation-of-workdir" title="Permalink to this headline">¶</a></h2>
<p>In some circumstances, one might decide to move their entire working
directory to a new location. It would be convenient to rerun only
necessary components of the pipeline, instead of running all the nodes
all over again. It is possible to do that with the
<tt class="xref py py-func docutils literal"><span class="pre">updatehash()</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">updatehash</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This will execute the workflow and update all the hash values that
were stored without actually running any of the interfaces.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
        &copy; Copyright 2009-14, Neuroimaging in Python team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
</div>

  </body>
</html>