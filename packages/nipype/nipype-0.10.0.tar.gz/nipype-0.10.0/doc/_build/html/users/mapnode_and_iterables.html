<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python - Pipelines and Interfaces &mdash; nipy pipeline and interfaces package</title>
    
    <link rel="stylesheet" href="../_static/nipype.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="nipy pipeline and interfaces package" href="../index.html" />
 
<meta name="keywords" content="nipype, neuroimaging, pipeline, workflow, parallel, python, neuroscience">
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-339450-7', 'nipy.org/nipype');
  ga('send', 'pageview');
</script>

  </head>
  <body>
<div class="header-wrapper">
    <div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
            <a href="../index.html">
            <img src="../_static/nipype-banner-bg.png" alt="NIPY logo"  border="0" />
        <div style="margin-top: 1em;
                border-top: 1px solid #AAA;
                border-bottom: 1px solid #AAA;
                border-radius: 5px;
                padding: 3px 1em;">
            <link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />
<style type="text/css">
    a.navbar {
    color: ;
    letter-spacing: .05em;
    font-weight: bold;
        }
</style>

<a class="navbar" href="../index.html">Home</a> ·
<a class="navbar" href="../quickstart.html">Quickstart</a> ·
<a class="navbar" href="../documentation.html">Documentation</a> ·
<a class="navbar" href="../about.html">Citation</a> ·
<a class="navbar" href="http://nipy.org">NiPy</a>

        </div>
    </div>
</div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<style type="text/css">
    input.gsc-input {
        border-color: #BCCDF0;
    }
    input.gsc-search-button {
        border-color: #666666;
        background-color: #CECECE;
        padding: 0;
    }
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
    div.sphinxsidebar input[type="text"] {
        width: 100%;
    }
    div.sphinxsidebar input[type="submit"] {
        width: 100%;
    }
</style>

<div class="sidebarblock">
    <div id="cse-search-form">Loading</div>

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load('search', '1', {language : 'en'});
        google.setOnLoadCallback(function() {
            var customSearchControl = new google.search.CustomSearchControl(
                    '010960497803984932957:u8pmqf7fdoq');

            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.enableSearchboxOnly("../searchresults.html");
            customSearchControl.draw('cse-search-form', options);
        }, true);
    </script>
</div>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MapNode, iterfield, and iterables explained</a><ul>
<li><a class="reference internal" href="#mapnode-and-iterfield">MapNode and iterfield</a></li>
<li><a class="reference internal" href="#iterables">Iterables</a></li>
</ul>
</li>
</ul>

<style type="text/css">
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
</style>
<div class="sidebarblock">
    <h3>Versions</h3>

    <div class="tile">
        <table style="width: 100%;">
            <tr style="font-weight: bold;">
                <td align="left">Release</td><td align="right">Devel</td>
            </tr>
            <tr>
                <td align="left">0.10.0</td><td align="right">1.0-dev</td>
            </tr>
            <tr>
                <td align="left"><a href="install.html">Download</a></td>
                <td align="right"><a href="https://github.com/nipy/nipype">Github</a></td>
            </tr>
        </table>
    </div>

    <div id="buttons">
        <div id="ohloh-use" style="margin-right: 25px; margin-top: -2px; float: left;">
            <script type="text/javascript"
                    src="http://www.ohloh.net/p/480871/widgets/project_users_logo.js">
            </script>
        </div><!-- use -->
        <g:plusone size="medium" annotation="none"></g:plusone>
        <div class="clear"></div>
    </div><!-- buttons container -->
</div>


<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>

<h3>Links</h3>

<ul>
    <li>Docs: <a href="http://nipy.org/nipype">Stable</a> · <a href="http://www.mit.edu/~satra/nipype-nightly/">Nightly</a></li>
    <li>Code: <a href="http://github.com/nipy/nipype">Github</a> · <a href="http://github.com/nipy/nipype/issues">Bugs-Requests</a></li>
    <li>Forum: <a href="http://neurostars.org/t/nipype">User</a> · <a href="http://projects.scipy.org/mailman/listinfo/nipy-devel">Developer</a></li>
    <li><a href="http://nipy.org/software/license/index.html"><img src="https://pypip.in/license/nipype/badge.png" alt="License"></a> · <a href="http://nipy.org/about/funding.html">Funding</a></li>
    <li><a href="https://travis-ci.org/nipy/nipype"><img src="https://travis-ci.org/nipy/nipype.png?branch=master" alt="travis"></a> · <a href='https://coveralls.io/r/nipy/nipype'><img src='https://coveralls.io/repos/nipy/nipype/badge.png' alt='Coverage Status' /></a></li>
    <li><a href="https://pypi.python.org/pypi/nipype/"><img src="https://pypip.in/download/nipype/badge.png" alt="Downloads"></a> · <a href='https://pypi.python.org/pypi/nipype/'><img src='https://pypip.in/py_versions/nipype/badge.png' alt='Python Versions' /></a></li>
</ul>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="mapnode-iterfield-and-iterables-explained">
<span id="mapnode-and-iterables"></span><h1>MapNode, iterfield, and iterables explained<a class="headerlink" href="#mapnode-iterfield-and-iterables-explained" title="Permalink to this headline">¶</a></h1>
<p>In this chapter we will try to explain the concepts behind MapNode, iterfield,
and iterables.</p>
<div class="section" id="mapnode-and-iterfield">
<h2>MapNode and iterfield<a class="headerlink" href="#mapnode-and-iterfield" title="Permalink to this headline">¶</a></h2>
<p>Imagine that you have a list of items (lets say files) and you want to execute
the same node on them (for example some smoothing or masking). Some nodes accept
multiple files and do exactly the same thing on them, but some don&#8217;t (they expect
only one file). MapNode can solve this problem. Imagine you have the following
workflow:</p>
<p class="graphviz">
<img src="../_images/graphviz-21aa3a9a2cd7a6375a3c4fd07666a22d942cec4e.png" alt="digraph mapnode_before {
&quot;A&quot; -&gt; &quot;B&quot; -&gt; &quot;C&quot;;
}" />
</p>
<p>Node &#8220;A&#8221; outputs a list of files, but node &#8220;B&#8221; accepts only one file. Additionally
&#8220;C&#8221; expects a list of files. What you would like is to run &#8220;B&#8221; for every file in
the output of &#8220;A&#8221; and collect the results as a list and feed it to &#8220;C&#8221;. Something
like this:</p>
<p class="graphviz">
<img src="../_images/graphviz-5ccfc22ea445e4176159a1a40eca28bcfd01d77b.png" alt="digraph mapnode_after {
&quot;A&quot; -&gt; &quot;B1&quot; -&gt; &quot;C&quot;;
&quot;A&quot; -&gt; &quot;B2&quot; -&gt; &quot;C&quot;;
&quot;A&quot; -&gt; &quot;B3&quot; -&gt; &quot;C&quot;;
&quot;A&quot; -&gt; &quot;Bn&quot; -&gt; &quot;C&quot;;
}" />
</p>
<p>The code to achieve this is quite simple</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nipype.pipeline.engine</span> <span class="kn">as</span> <span class="nn">pe</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">A</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">C</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">)</span>

<span class="n">my_workflow</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;my_workflow&quot;</span><span class="p">)</span>
<span class="n">my_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,[(</span><span class="s">&#39;out_files&#39;</span><span class="p">,</span><span class="s">&#39;in_file&#39;</span><span class="p">)]),</span>
                     <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,[(</span><span class="s">&#39;out_file&#39;</span><span class="p">,</span><span class="s">&#39;in_files&#39;</span><span class="p">)])</span>
                     <span class="p">])</span>
</pre></div>
</div>
<p>assuming that interfaces &#8220;A&#8221; and &#8220;C&#8221; have one input &#8220;in_files&#8221; and one output
&#8220;out_files&#8221; (both lists of files). Interface &#8220;B&#8221; has single file input &#8220;in_file&#8221;
and single file output &#8220;out_file&#8221;.</p>
<p>You probably noticed that you connect nodes as if &#8220;B&#8221; could accept and output
list of files. This is because it is wrapped using MapNode instead of Node. This
special version of node will (under the bonnet) create an instance of &#8220;B&#8221; for
every item in the list from the input. The compulsory argument &#8220;iterfield&#8221;
defines which input should it iterate over (for example in single file smooth
interface you would like to iterate over input files not the smoothing width). At
the end outputs are collected into a list again. In other words this is map and
reduce scenario.</p>
<p>You might have also noticed that the iterfield arguments expects a list of input
names instead of just one name. This suggests that there can be more than one!
Even though a bit confusing this is true. You can specify more than one input to
iterate over but the lists that you provide (for all the inputs specified in
iterfield) have to have the same length. MapNode will then pair the parameters up
and run the first instance with first set of parameters and second with second set
of parameters. For example, this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;in_file&#39;</span><span class="p">,</span> <span class="s">&#39;n&#39;</span><span class="p">])</span>
<span class="n">b</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;another_file&#39;</span><span class="p">,</span> <span class="s">&#39;different_file&#39;</span><span class="p">]</span>
<span class="n">b</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">b</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>is almost the same as running</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">b1</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;b1&quot;</span><span class="p">)</span>
<span class="n">b1</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="s">&#39;file&#39;</span>
<span class="n">b1</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">b2</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;b2&quot;</span><span class="p">)</span>
<span class="n">b2</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="s">&#39;another_file&#39;</span>
<span class="n">b2</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">b3</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;b3&quot;</span><span class="p">)</span>
<span class="n">b3</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="s">&#39;different_file&#39;</span>
<span class="n">b3</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
<p>It is a rarely used feature, but you can sometimes find it useful.</p>
<p>In more advanced applications it is useful to be able to iterate over items
of nested lists (for example [[1,2],[3,4]]). MapNode allows you to do this
with the &#8220;nested=True&#8221; parameter. Outputs will preserve the same nested
structure as the inputs.</p>
</div>
<div class="section" id="iterables">
<h2>Iterables<a class="headerlink" href="#iterables" title="Permalink to this headline">¶</a></h2>
<p>Now imagine a different scenario. You have your workflow as before</p>
<p class="graphviz">
<img src="../_images/graphviz-b65596b443fdc105a6508acf176afcc6261aa65a.png" alt="digraph iterables_before {
&quot;A&quot; -&gt; &quot;B&quot; -&gt; &quot;C&quot;;
}" />
</p>
<p>and there are three possible values of one of the inputs node &#8220;B&#8221; you would like
to investigate (for example width of 2,4, and 6 pixels of a smoothing node). You
would like to see how different parameters in node &#8220;B&#8221; would influence everything
that depends on its outputs (node &#8220;C&#8221; in our example). Therefore the new graph
should look like this:</p>
<p class="graphviz">
<img src="../_images/graphviz-675dc232294d6cecf3284efeace35923746f8ac8.png" alt="digraph foo {
&quot;A&quot; -&gt; &quot;B1&quot; -&gt; &quot;C1&quot;;
&quot;A&quot; -&gt; &quot;B2&quot; -&gt; &quot;C2&quot;;
&quot;A&quot; -&gt; &quot;B3&quot; -&gt; &quot;C3&quot;;
}" />
</p>
<p>Of course you can do it manually by creating copies of all the nodes for
different parameter set, but this can be very time consuming, especially when there
are more than one node taking inputs from &#8220;B&#8221;. Luckily nipype supports this
scenario! Its called iterables and and you use it this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nipype.pipeline.engine</span> <span class="kn">as</span> <span class="nn">pe</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">A</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">B</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;b&quot;</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">C</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="p">)</span>

<span class="n">my_workflow</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Workflow</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;my_workflow&quot;</span><span class="p">)</span>
<span class="n">my_workflow</span><span class="o">.</span><span class="n">connect</span><span class="p">([(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,[(</span><span class="s">&#39;out_file&#39;</span><span class="p">,</span><span class="s">&#39;in_file&#39;</span><span class="p">)]),</span>
                     <span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,[(</span><span class="s">&#39;out_file&#39;</span><span class="p">,</span><span class="s">&#39;in_file&#39;</span><span class="p">)])</span>
                     <span class="p">])</span>
</pre></div>
</div>
<p>Assuming that you want to try out values 1, 2, and 3 of input &#8220;n&#8221; of the node
&#8220;B&#8221;. This will also create three different versions of node &#8220;C&#8221; - each with
inputs from instances of node &#8220;C&#8221; with different values of &#8220;n&#8221;.</p>
<p>Additionally, you can set multiple iterables for a node with a list of tuples
in the above format.</p>
<p>Iterables are commonly used to execute the same workflow for many subjects.
Usually one parametrises DataGrabber node with subject ID. This is achieved by
connecting an IdentityInterface in front of DataGrabber. When you set iterables of the
IdentityInterface to the list of subjects IDs, the same workflow will be executed
for every subject. See <a class="reference internal" href="examples/fmri_spm.html"><em>fMRI: SPM, FSL</em></a> to see this pattern in action.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
        &copy; Copyright 2009-14, Neuroimaging in Python team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
</div>

  </body>
</html>