<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Neuroimaging in Python - Pipelines and Interfaces &mdash; nipy pipeline and interfaces package</title>
    
    <link rel="stylesheet" href="../_static/nipype.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="top" title="nipy pipeline and interfaces package" href="../index.html" />
 
<meta name="keywords" content="nipype, neuroimaging, pipeline, workflow, parallel, python, neuroscience">
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-339450-7', 'nipy.org/nipype');
  ga('send', 'pageview');
</script>

  </head>
  <body>
<div class="header-wrapper">
    <div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
            <a href="../index.html">
            <img src="../_static/nipype-banner-bg.png" alt="NIPY logo"  border="0" />
        <div style="margin-top: 1em;
                border-top: 1px solid #AAA;
                border-bottom: 1px solid #AAA;
                border-radius: 5px;
                padding: 3px 1em;">
            <link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" />
<style type="text/css">
    a.navbar {
    color: ;
    letter-spacing: .05em;
    font-weight: bold;
        }
</style>

<a class="navbar" href="../index.html">Home</a> ·
<a class="navbar" href="../quickstart.html">Quickstart</a> ·
<a class="navbar" href="../documentation.html">Documentation</a> ·
<a class="navbar" href="../about.html">Citation</a> ·
<a class="navbar" href="http://nipy.org">NiPy</a>

        </div>
    </div>
</div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<style type="text/css">
    input.gsc-input {
        border-color: #BCCDF0;
    }
    input.gsc-search-button {
        border-color: #666666;
        background-color: #CECECE;
        padding: 0;
    }
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
    div.sphinxsidebar input[type="text"] {
        width: 100%;
    }
    div.sphinxsidebar input[type="submit"] {
        width: 100%;
    }
</style>

<div class="sidebarblock">
    <div id="cse-search-form">Loading</div>

    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load('search', '1', {language : 'en'});
        google.setOnLoadCallback(function() {
            var customSearchControl = new google.search.CustomSearchControl(
                    '010960497803984932957:u8pmqf7fdoq');

            customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
            var options = new google.search.DrawOptions();
            options.enableSearchboxOnly("../searchresults.html");
            customSearchControl.draw('cse-search-form', options);
        }, true);
    </script>
</div>

  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Pipeline 102</a><ul>
<li><a class="reference internal" href="#name-the-mandatory-keyword-arg">&#8216;name&#8217; : the mandatory keyword arg</a><ul>
<li><a class="reference internal" href="#iterables">iterables</a></li>
<li><a class="reference internal" href="#iterfield">iterfield</a></li>
<li><a class="reference internal" href="#overwrite">overwrite</a></li>
<li><a class="reference internal" href="#the-clone-function">The <cite>clone</cite> function</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<style type="text/css">
    div.sphinxsidebar .tile {
        border: 1px solid #D1DDE2;
        border-radius: 10px;
        background-color: #E1E8EC;
        padding-left: 0.5em;
        margin: 1em 0;
    }
</style>
<div class="sidebarblock">
    <h3>Versions</h3>

    <div class="tile">
        <table style="width: 100%;">
            <tr style="font-weight: bold;">
                <td align="left">Release</td><td align="right">Devel</td>
            </tr>
            <tr>
                <td align="left">0.10.0</td><td align="right">1.0-dev</td>
            </tr>
            <tr>
                <td align="left"><a href="install.html">Download</a></td>
                <td align="right"><a href="https://github.com/nipy/nipype">Github</a></td>
            </tr>
        </table>
    </div>

    <div id="buttons">
        <div id="ohloh-use" style="margin-right: 25px; margin-top: -2px; float: left;">
            <script type="text/javascript"
                    src="http://www.ohloh.net/p/480871/widgets/project_users_logo.js">
            </script>
        </div><!-- use -->
        <g:plusone size="medium" annotation="none"></g:plusone>
        <div class="clear"></div>
    </div><!-- buttons container -->
</div>


<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>

<h3>Links</h3>

<ul>
    <li>Docs: <a href="http://nipy.org/nipype">Stable</a> · <a href="http://www.mit.edu/~satra/nipype-nightly/">Nightly</a></li>
    <li>Code: <a href="http://github.com/nipy/nipype">Github</a> · <a href="http://github.com/nipy/nipype/issues">Bugs-Requests</a></li>
    <li>Forum: <a href="http://neurostars.org/t/nipype">User</a> · <a href="http://projects.scipy.org/mailman/listinfo/nipy-devel">Developer</a></li>
    <li><a href="http://nipy.org/software/license/index.html"><img src="https://pypip.in/license/nipype/badge.png" alt="License"></a> · <a href="http://nipy.org/about/funding.html">Funding</a></li>
    <li><a href="https://travis-ci.org/nipy/nipype"><img src="https://travis-ci.org/nipy/nipype.png?branch=master" alt="travis"></a> · <a href='https://coveralls.io/r/nipy/nipype'><img src='https://coveralls.io/repos/nipy/nipype/badge.png' alt='Coverage Status' /></a></li>
    <li><a href="https://pypi.python.org/pypi/nipype/"><img src="https://pypip.in/download/nipype/badge.png" alt="Downloads"></a> · <a href='https://pypi.python.org/pypi/nipype/'><img src='https://pypip.in/py_versions/nipype/badge.png' alt='Python Versions' /></a></li>
</ul>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pipeline-102">
<span id="tutorial-102"></span><h1>Pipeline 102<a class="headerlink" href="#pipeline-102" title="Permalink to this headline">¶</a></h1>
<p>Now that you know how to construct a workflow and execute it, we will go
into more advanced concepts. This tutorial focuses on
<a class="reference internal" href="../api/generated/nipype.pipeline.engine.html#nipype.pipeline.engine.Workflow" title="nipype.pipeline.engine.Workflow"><tt class="xref py py-class docutils literal"><span class="pre">nipype.pipeline.engine.Workflow</span></tt></a>
<a class="reference internal" href="../api/generated/nipype.pipeline.engine.html#nipype.pipeline.engine.Node" title="nipype.pipeline.engine.Node"><tt class="xref py py-class docutils literal"><span class="pre">nipype.pipeline.engine.Node</span></tt></a> and
<a class="reference internal" href="../api/generated/nipype.pipeline.engine.html#nipype.pipeline.engine.MapNode" title="nipype.pipeline.engine.MapNode"><tt class="xref py py-class docutils literal"><span class="pre">nipype.pipeline.engine.MapNode</span></tt></a>.</p>
<p>A workflow is a <strong>directed acyclic graph (DAG)</strong> consisting of nodes
which can be of type <cite>Workflow</cite>, <cite>Node</cite> or <cite>MapNode</cite>. Workflows can
be re-used and hierarchical workflows can be easily constructed.</p>
<div class="section" id="name-the-mandatory-keyword-arg">
<h2>&#8216;name&#8217; : the mandatory keyword arg<a class="headerlink" href="#name-the-mandatory-keyword-arg" title="Permalink to this headline">¶</a></h2>
<p>When instantiating a Workflow, Node or MapNode, a <cite>name</cite> has to be
provided. For any given level of a workflow, no two nodes can have the
same name. The engine will let you know if this is the case when you add
nodes to a workflow either directly using <cite>add_nodes</cite> or using the
<cite>connect</cite> function.</p>
<p>Names have many internal uses. They determine the name of the directory
in which the workflow/node is run and the outputs are stored.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">realigner</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">spm</span><span class="o">.</span><span class="n">Realign</span><span class="p">(),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;RealignSPM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now this output will be stored in a directory called
<em>RealignSPM</em>. Proper naming of your nodes can be advantageous
from the perspective that it provides a semantic descriptor aligned with
your thought process. This name parameter is also used to refer to nodes in
embedded workflows.</p>
<div class="section" id="iterables">
<h3>iterables<a class="headerlink" href="#iterables" title="Permalink to this headline">¶</a></h3>
<p>This can only be set for Node and MapNode. This is syntactic sugar for
running a subgraph with the Node/MapNode at its root in a <tt class="docutils literal"><span class="pre">for</span></tt>
loop. For example, consider an fMRI preprocessing pipeline that you
would like to run for all your subjects. You can define a workflow and
then execute it for every single subject inside a <tt class="docutils literal"><span class="pre">for</span></tt> loop. Consider
the simplistic example below, where startnode is a node belonging to
workflow &#8216;mywork.&#8217;</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
    <span class="n">startnode</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_id</span> <span class="o">=</span> <span class="n">s</span>
    <span class="n">mywork</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The pipeline engine provides a convenience function that simplifies
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">startnode</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">subjects</span><span class="p">)</span>
<span class="n">mywork</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This will achieve the same exact behavior as the for loop above. The
workflow graph is:</p>
<a class="reference internal image-reference" href="../_images/proc2subj.png"><img alt="../_images/proc2subj.png" src="../_images/proc2subj.png" style="width: 650px;" /></a>
<p>Now consider the situation in which you want the last node (typically
smoothing) of your preprocessing pipeline to smooth using two
different kernels (0 mm and 6 mm FWHM). Again the common approach
would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
    <span class="n">startnode</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">subject_id</span> <span class="o">=</span> <span class="n">s</span>
    <span class="n">uptosmoothingworkflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="n">smoothnode</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">infile</span> <span class="o">=</span> <span class="n">lastnode</span><span class="o">.</span><span class="n">output</span><span class="o">.</span><span class="n">outfile</span>
    <span class="k">for</span> <span class="n">fwhm</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
        <span class="n">smoothnode</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">fwhm</span> <span class="o">=</span> <span class="n">fwhm</span>
        <span class="n">remainingworkflow</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Instead of having multiple <tt class="docutils literal"><span class="pre">for</span></tt> loops at various stages, you can set up
another set of iterables for the smoothnode.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">startnode</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">subjects</span><span class="p">)</span>
<span class="n">smoothnode</span><span class="o">.</span><span class="n">iterables</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;fwhm&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">mywork</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This will run the preprocessing workflow for two different smoothing
kernels over all subjects.</p>
<a class="reference internal image-reference" href="../_images/proc2subj2fwhm.png"><img alt="../_images/proc2subj2fwhm.png" src="../_images/proc2subj2fwhm.png" style="width: 650px;" /></a>
<p>Thus setting iterables has a multiplicative effect. In the above
examples there is a separate, distinct specifymodel node that&#8217;s
executed for each combination of subject and smoothing.</p>
</div>
<div class="section" id="iterfield">
<h3>iterfield<a class="headerlink" href="#iterfield" title="Permalink to this headline">¶</a></h3>
<p>This is a mandatory keyword arg for MapNode. This enables running the
underlying interface over a set of inputs and is particularly useful
when the interface can only operate on a single input. For example, the
<tt class="xref py py-class docutils literal"><span class="pre">nipype.interfaces.fsl.BET</span></tt> will operate on only one (3d or 4d)
NIfTI file. But wrapping BET in a MapNode can execute it over a list of files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">better</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fsl</span><span class="o">.</span><span class="n">Bet</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;stripper&#39;</span><span class="p">,</span>
                    <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;in_file&#39;</span><span class="p">])</span>
<span class="n">better</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">in_file</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;file1.nii&#39;</span><span class="p">,</span><span class="s">&#39;file2.nii&#39;</span><span class="p">]</span>
<span class="n">better</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>This will create a directory called <tt class="docutils literal"><span class="pre">stripper</span></tt> and inside it two
subdirectories called <tt class="docutils literal"><span class="pre">in_file_0</span></tt> and <tt class="docutils literal"><span class="pre">in_file_1</span></tt>. The output of running bet
separately on each of those files will be stored in those two
subdirectories.</p>
<p>This can be extended to run it on pairwise inputs. For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">transform</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">MapNode</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">ApplyVolTransform</span><span class="p">(),</span>
                       <span class="n">name</span><span class="o">=</span><span class="s">&#39;warpvol&#39;</span><span class="p">,</span>
                       <span class="n">iterfield</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;source_file&#39;</span><span class="p">,</span> <span class="s">&#39;reg_file&#39;</span><span class="p">])</span>
<span class="n">transform</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">source_file</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;file1.nii&#39;</span><span class="p">,</span><span class="s">&#39;file2.nii&#39;</span><span class="p">]</span>
<span class="n">transform</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">reg_file</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;file1.reg&#39;</span><span class="p">,</span><span class="s">&#39;file2.reg&#39;</span><span class="p">]</span>
<span class="n">transform</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>The above will be equivalent to running transform by taking corresponding items from
each of the two fields in iterfield. The subdirectories get always
named with respect to the first iterfield.</p>
</div>
<div class="section" id="overwrite">
<h3>overwrite<a class="headerlink" href="#overwrite" title="Permalink to this headline">¶</a></h3>
<p>The overwrite keyword arg forces a node to be rerun.</p>
</div>
<div class="section" id="the-clone-function">
<h3>The <cite>clone</cite> function<a class="headerlink" href="#the-clone-function" title="Permalink to this headline">¶</a></h3>
<p>The <cite>clone</cite> function can be used to create a copy of a workflow. No
references to the original workflow are retained. As such the clone
function requires a name keyword arg that specifies a new name for the
duplicate workflow.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

    <div class="footer">
        &copy; Copyright 2009-14, Neuroimaging in Python team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<div class="footer">This page uses <a href="http://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
</div>

  </body>
</html>