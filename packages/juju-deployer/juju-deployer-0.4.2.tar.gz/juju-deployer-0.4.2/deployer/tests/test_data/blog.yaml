
metrics-base:
  services:
    newrelic:
      branch: lp:charms/precise/newrelic
      options:
        key: measureallthethings

wordpress-base:
  series: precise
  services:
    blog:
      charm: cs:precise/wordpress
    db:
      charm: cs:precise/mysql


wordpress-stage:
  series: precise
  inherits:
    - wordpress-base
    - metrics-base
  services:
    blog:
      constraints: instance-type=m1.small
      num_units: 3
      options:
        tuning: optimized
        engine: apache
        wp-content: include-base64://blog.snippet
    cache:
      branch: lp:charms/precise/memcached
      options:
        size: 100
    haproxy:
      charm_url: cs:precise/haproxy
      options:
        services: include-file://blog-haproxy-services.yaml
  relations:
        - [blog, db]
        - - blog
          - cache
        - - blog
          - haproxy

wordpress-prod:
    series: precise
    inherits: wordpress-stage
    services:
        blog:
            options:
                engine: nginx
                tuning: optimized
            constraints: instance-type=m1.large

        db:
            constraints: instance-type=m1.large
            options:
                tuning-level: safest
