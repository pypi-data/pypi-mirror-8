<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Дизайнер UI</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
        <style type='text/css'>
            html, body{font-family:Tahoma,Sans;font-size:11px;}
            #loading-mask{position:absolute;top:0;left:0;width:100%;height:100%;background:#000000;z-index:1001;}
            #loading{position:absolute;top:40%;left:45%;z-index:1002;}
        </style>
    
        <!-- extjs -->
        <link rel='stylesheet' type='text/css' href='/m3static/vendor/extjs/resources/css/ext-all.css'/>
        <link rel='stylesheet' type='text/css' href='/m3static/vendor/extjs/resources/css/ux/ux-all.css'/>
        <!--<link rel="stylesheet" type="text/css" href="/m3static/vendor/extjs/resources/css/xtheme-slate.css" />-->
        <link rel="stylesheet" type="text/css" href="/static/css/xtheme-slate.css" />

        <link rel="stylesheet" type="text/css" href="/m3static/ext/css/TreeGrid.css"/>

        <!-- m3 css-->
        <link rel='stylesheet' type='text/css' href='/m3static/m3/css/m3.css'/>
        <link rel='stylesheet' type='text/css' href='/m3static/m3/css/icons.css'/>

        <!-- m3 lightbox css-->
        <link rel='stylesheet' type='text/css' href='/m3static/ext/css/lightbox.css'/>

        <!-- CodeMirror Themes-->
        <link rel='stylesheet' type='text/css' href='/static/css/codemirror-themes.css'/>


        <script type="text/javascript" src="/m3static/vendor/extjs/adapter/ext/ext-base.js"></script>
        <script type='text/javascript' src='/m3static/vendor/extjs/ext-all-debug.js'></script>
        <script type='text/javascript' src='/m3static/vendor/extjs/ux-all-debug.js'></script>
        <script type='text/javascript' src='/m3static/vendor/extjs/locale/ext-lang-ru.js'></script>

        <script type='text/javascript' src='/m3static/m3/js/m3-debug.js'></script>
        <!-- CodeEditor -->
        <script type="text/javascript" src='/m3static/vendor/codemirror/js/codemirror.js'></script>

        <!-- Дизайнер -->
        <link rel='stylesheet' type='text/css' href='/static/css/designer.css'/>

        <script type="text/javascript" src="/static/designer-src/underscore-min.js"></script>
        <script type="text/javascript" src="/static/designer-src/utils.js"></script>
        <script type="text/javascript" src="/static/js/urls.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/view.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/property-editor.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/transfer.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/controller.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/model.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/ui.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/model-types.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/server.js"></script>
        <script type="text/javascript" src="/static/designer-src/ui-desginer/model-types-config.js"></script>
        <script type="text/javascript" src="/static/designer-src/code-editor/code-assist.js"></script>
        <script type="text/javascript" src="/static/designer-src/code-editor/code-viewers.js"></script>
        <script type="text/javascript" src='/static/designer-src/ide/workspace.js'></script>
        <script type="text/javascript" src='/static/designer-src/ui-desginer/ui-mocks.js'></script>
        <script type="text/javascript" src='/static/designer-src/extensions.js'></script>
        <script type="text/javascript" src='/static/designer-src/ide/requests.js'></script>


        <script type="text/javascript" src="/static/designer-src/ide/helpers.js"></script>
        <script type="text/javascript" src="/static/designer-src/ide/commands.js"></script>
        <script type="text/javascript" src="/static/designer-src/ide/project-explorer.js"></script>
        <script type="text/javascript" src="/static/designer-src/ide/controller.js"></script>


        <!-- Файлы проекта -->
        <link rel='stylesheet' type='text/css' href='/static/css/main.css'/>

    </head>
    <body scroll="no">

        <script type="text/javascript">
            Ext.enableForcedBoxModel = true;
            Ext.USE_NATIVE_JSON = true; 
            Ext.onReady(function(){
                
                Ext.QuickTips.init();

                var tree = new M3Designer.ide.ProjectExplorer({rootText : '{{ project_name }}'});

                var accordion = new Ext.Panel({
                    id:'accordion-view',
                    layout:'accordion',
                    layoutConfig: {
                        animate: true,
                        collapseFirst: true
                    },
                    items: [{
                        title: 'Структура проекта',
                        layout: 'fit',
                        items: [tree]
                    },{
                        title: 'Свойства',
                        id: 'property-panel',
                        layout: 'fit'
                    }],
                    listeners:{
                        clear: function(){
                            var panel = Ext.getCmp('property-panel');
                            panel.removeAll();
                            panel.setTitle('Свойства');
                            var accordionView = panel.ownerCt;
                            if (accordionView.items.itemAt(0).collapsed){
                                accordionView.items.itemAt(0).expand();
                            }
                        }
                    }
                });

                var tab = new Ext.TabPanel({
                        id:'tab-panel',
                        region: 'center',
                        xtype: 'tabpanel',
                        idDelimiter: '___', //измененый разделитель id (причина __init__.py)
                        activeTab: 0,
                        items: [{
                            title: 'Обзор',
                            html: '<iframe src="http://m3.bars-open.ru" width="100%" height="100%" style="border: 0px none;"></iframe>',
                            silent: true
                        }]
                });


                new Ext.Viewport({
                    title: 'Дизайнер UI m3'
                    ,layout: 'border'
                    ,items: [{
                        region: 'west'
                        ,collapsible: true
                        ,title: 'М3 Дизайнер'
                        ,split: true
                        ,width: 300
                        ,maxWidth: 300
                        ,minWidth: 200
                        ,layout: 'fit'
                        ,items: accordion
                    },
                    tab]
                });

                var controller = new M3Designer.ide.Controller({
                    explorerTree: tree,
                    tabPanel : tab
                });
            });

        </script>
        
    </body>
</html>
