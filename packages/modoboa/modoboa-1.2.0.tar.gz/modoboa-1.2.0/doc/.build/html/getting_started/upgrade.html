<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Upgrading an existing installation &mdash; Modoboa 1.2.0-rc1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0-rc1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Modoboa 1.2.0-rc1 documentation" href="../index.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Modoboa 1.2.0-rc1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="upgrading-an-existing-installation">
<h1>Upgrading an existing installation<a class="headerlink" href="#upgrading-an-existing-installation" title="Permalink to this headline">¶</a></h1>
<p>This section contains all the upgrade procedures required to use
newest versions of Modoboa.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before running a migration, we recommend that you make
a copy of your existing database.</p>
</div>
<div class="section" id="latest-version">
<span id="latestversion"></span><h2>Latest version<a class="headerlink" href="#latest-version" title="Permalink to this headline">¶</a></h2>
<p>Fetch the latest version (see <a class="reference internal" href="install.html#get-modoboa"><em>Get Modoboa</em></a>) and install
it. <tt class="docutils literal"><span class="pre">pip</span></tt> users, just run the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ pip install modoboa==&lt;VERSION&gt;
</pre></div>
</div>
<p>Replace <tt class="docutils literal"><span class="pre">&lt;VERSION&gt;</span></tt> by the appropriate value.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you migrate to <strong>1.1.0</strong>, please follow the <a class="reference internal" href="#id3"><em>dedicated migration
procedure</em></a> and skip the usual one.</p>
</div>
<p>As for a fresh installation, <tt class="docutils literal"><span class="pre">modoboa-admin.py</span></tt> is used to upgrade
your local configuration. To do so, remove the directory where your
instance was first deployed:</p>
<div class="highlight-python"><div class="highlight"><pre>$ rm -rf &lt;modoboa_instance_dir&gt;
</pre></div>
</div>
<p>If you customized your configuration file (<tt class="file docutils literal"><span class="pre">settings.py</span></tt>) with
non-standard settings, you&#8217;ll have to re-apply them.</p>
<p>Then, run <tt class="docutils literal"><span class="pre">modoboa-admin.py</span> <span class="pre">deploy</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ modoboa-admin.py deploy &lt;modoboa_instance_dir&gt; --dbaction upgrade --collectstatic [--with-amavis] [--dburl database-url] [--amavis_dburl database-url] [--domain hostname] [--lang lang] [--timezone timezone]
</pre></div>
</div>
<p>According to the version you&#8217;re installing, check if
<a class="reference internal" href="#specific-upgrade-instructions"><em>Specific upgrade instructions</em></a> are required.</p>
<p>To finish, restart the web server process according to the environment
you did choose. See <a class="reference internal" href="../integration/web_servers.html#webservers"><em>Web servers</em></a> for more details.</p>
</div>
<div class="section" id="specific-upgrade-instructions">
<span id="id1"></span><h2>Specific upgrade instructions<a class="headerlink" href="#specific-upgrade-instructions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="manual-learning-for-spamassassin">
<h3>1.1.7: manual learning for SpamAssassin<a class="headerlink" href="#manual-learning-for-spamassassin" title="Permalink to this headline">¶</a></h3>
<p>A new feature allows administrators and users to manually train
SpamAssassin in order to customize its behaviour.</p>
<p>Check <a class="reference internal" href="../plugins/amavis.html#sa-manual-learning"><em>Manual SpamAssassin learning</em></a> to know more about this feature.</p>
</div>
<div class="section" id="few-bugfixes">
<h3>1.1.6: Few bugfixes<a class="headerlink" href="#few-bugfixes" title="Permalink to this headline">¶</a></h3>
<p>Catchall aliases were not really functional until this version as they
were eating all domain traffic.</p>
<p>To fix them, a postfix map file (<tt class="docutils literal"><span class="pre">sql-mailboxes-self-aliases.cf</span></tt>)
has been re-introduced and must be listed into the
<tt class="docutils literal"><span class="pre">virtual_alias_maps</span></tt> setting. See <a class="reference internal" href="../integration/imap_and_smtp.html#postfix-config"><em>Configuration</em></a> for the
order.</p>
</div>
<div class="section" id="audit-trail-issues">
<h3>1.1.2: Audit trail issues<a class="headerlink" href="#audit-trail-issues" title="Permalink to this headline">¶</a></h3>
<p>Update the <tt class="file docutils literal"><span class="pre">settings.py</span></tt> file as follows:</p>
<ol class="arabic simple">
<li>Remove the <tt class="docutils literal"><span class="pre">'reversion.middleware.RevisionMiddleware'</span></tt>
middleware from the <tt class="docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt> variable</li>
<li>Add the new <tt class="docutils literal"><span class="pre">'modoboa.lib.middleware.RequestCatcherMiddleware'</span></tt>
middleware at the end of the <tt class="docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt> variable</li>
</ol>
</div>
<div class="section" id="id2">
<h3>1.1.1: Few bugfixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>For those who installed Dovecot in a non-standard location, it is now
possible to tell Modoboa where to find it. Just define a variable
named <tt class="docutils literal"><span class="pre">DOVECOT_LOOKUP_PATH</span></tt> in the <tt class="file docutils literal"><span class="pre">settings.py</span></tt> file and
include the appropriate lookup path inside:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DOVECOT_LOOKUP_PATH</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;/usr/sbin/dovecot&quot;</span><span class="p">,</span> <span class="s">&quot;/usr/local/sbin/dovecot&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="relay-domains-and-better-passwords-encryption">
<span id="id3"></span><h3>1.1.0: relay domains and better passwords encryption<a class="headerlink" href="#relay-domains-and-better-passwords-encryption" title="Permalink to this headline">¶</a></h3>
<p>Due to code refactoring, some modifications need to be done into
<tt class="file docutils literal"><span class="pre">settings.py</span></tt>:</p>
<ol class="arabic">
<li><p class="first"><tt class="docutils literal"><span class="pre">MODOBOA_APPS</span></tt> must contain the following applications:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MODOBOA_APPS</span> <span class="o">=</span> <span class="p">(</span>
  <span class="s">&#39;modoboa&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.core&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.lib&#39;</span><span class="p">,</span>

  <span class="s">&#39;modoboa.extensions.admin&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.extensions.limits&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.extensions.postfix_autoreply&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.extensions.webmail&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.extensions.stats&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.extensions.amavis&#39;</span><span class="p">,</span>
  <span class="s">&#39;modoboa.extensions.sievefilters&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Add <tt class="docutils literal"><span class="pre">'modoboa.extensions.postfix_relay_domains'</span></tt> to
<tt class="docutils literal"><span class="pre">MODOBOA_APPS</span></tt>, just before
<tt class="docutils literal"><span class="pre">'modoboa.extensions.limits'</span></tt></p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">AUTH_USER_MODEL</span></tt> must be set to <tt class="docutils literal"><span class="pre">core.User</span></tt></p>
</li>
<li><p class="first">Into <tt class="docutils literal"><span class="pre">LOGGING</span></tt>, replace <tt class="docutils literal"><span class="pre">modoboa.lib.logutils.SQLHandler</span></tt> by
<tt class="docutils literal"><span class="pre">modoboa.core.loggers.SQLHandler</span></tt></p>
</li>
</ol>
<p>Then, run the following commands to migrate your installation:</p>
<div class="highlight-python"><div class="highlight"><pre>$ python manage.py syncdb
$ python manage.py migrate core 0001 --fake
$ python manage.py migrate
$ python manage.py collectstatic
</pre></div>
</div>
<p>Finally, update both <a class="reference internal" href="../integration/imap_and_smtp.html#dovecot-authentication"><em>Dovecot</em></a> and
<a class="reference internal" href="../integration/imap_and_smtp.html#postfix"><em>Postfix</em></a> queries.</p>
</div>
<div class="section" id="operations-on-mailboxes">
<h3>1.0.1: operations on mailboxes<a class="headerlink" href="#operations-on-mailboxes" title="Permalink to this headline">¶</a></h3>
<p>The way Modoboa handles <strong>rename</strong> and <strong>delete</strong> operations on
mailboxes has been improved. Make sure to consult <a class="reference internal" href="../integration/imap_and_smtp.html#fs-operations"><em>Operations on the file system</em></a>
and <a class="reference internal" href="../integration/imap_and_smtp.html#postfix-config"><em>Postfix configuration</em></a>. Look at the
<tt class="docutils literal"><span class="pre">smtpd_recipient_restrictions</span></tt> setting.</p>
<p>Run <tt class="docutils literal"><span class="pre">modoboa-admin.py</span> <span class="pre">postfix_maps</span> <span class="pre">--dbtype</span> <span class="pre">&lt;mysql|postgres|sqlite&gt;</span>
<span class="pre">&lt;tempdir&gt;</span></tt> and compare the files with those that postfix currently
use. Make necessary updates in light of the differences</p>
</div>
<div class="section" id="production-ready-at-last">
<h3>1.0.0: production ready, at last<a class="headerlink" href="#production-ready-at-last" title="Permalink to this headline">¶</a></h3>
<div class="section" id="configuration-file-update">
<h4>Configuration file update<a class="headerlink" href="#configuration-file-update" title="Permalink to this headline">¶</a></h4>
<p>Several modifications need to be done into <tt class="file docutils literal"><span class="pre">settings.py</span></tt>.</p>
<ol class="arabic">
<li><p class="first">Add the following import statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">logging.handlers</span> <span class="kn">import</span> <span class="n">SysLogHandler</span>
</pre></div>
</div>
</li>
<li><p class="first">Set the <tt class="docutils literal"><span class="pre">ALLOWER_HOSTS</span></tt> variable:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s">&#39;&lt;your server fqdn&gt;&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">Activate the <tt class="docutils literal"><span class="pre">django.middleware.csrf.CsrfViewMiddleware</span></tt>
middleware and add the <tt class="docutils literal"><span class="pre">reversion.middleware.RevisionMiddleware</span></tt>
middleware to <tt class="docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.middleware.locale.LocaleMiddleware&#39;</span><span class="p">,</span>
    <span class="c"># Uncomment the next line for simple clickjacking protection:</span>
    <span class="c"># &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</span>
    <span class="s">&#39;reversion.middleware.RevisionMiddleware&#39;</span><span class="p">,</span>

    <span class="s">&#39;modoboa.lib.middleware.AjaxLoginRedirect&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.lib.middleware.CommonExceptionCatcher&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.lib.middleware.ExtControlMiddleware&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Add the <tt class="docutils literal"><span class="pre">reversion</span></tt> application to <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt></p>
</li>
<li><p class="first">Remove all modoboa&#8217;s application from <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> and put
them into the new <tt class="docutils literal"><span class="pre">MODOBOA_APPS</span></tt> variable like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s">&#39;south&#39;</span><span class="p">,</span>
    <span class="s">&#39;reversion&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># A dedicated place to register Modoboa applications</span>
<span class="c"># Do not delete it.</span>
<span class="c"># Do not change the order.</span>
<span class="n">MODOBOA_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;modoboa&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.admin&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.lib&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.userprefs&#39;</span><span class="p">,</span>

    <span class="s">&#39;modoboa.extensions.limits&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.extensions.postfix_autoreply&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.extensions.webmail&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.extensions.stats&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.extensions.amavis&#39;</span><span class="p">,</span>
    <span class="s">&#39;modoboa.extensions.sievefilters&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">INSTALLED_APPS</span> <span class="o">+=</span> <span class="n">MODOBOA_APPS</span>
</pre></div>
</div>
</li>
<li><p class="first">Set the <tt class="docutils literal"><span class="pre">AUTH_USER_MODEL</span></tt> variable like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">AUTH_USER_MODEL</span> <span class="o">=</span> <span class="s">&#39;admin.User&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">Modify the logging configuration as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;require_debug_false&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;()&#39;</span><span class="p">:</span> <span class="s">&#39;django.utils.log.RequireDebugFalse&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;syslog&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;format&#39;</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%(name)s</span><span class="s">: </span><span class="si">%(levelname)s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;require_debug_false&#39;</span><span class="p">],</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;django.utils.log.AdminEmailHandler&#39;</span>
        <span class="p">},</span>
        <span class="s">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c"># logging handler that outputs log messages to terminal</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
            <span class="c">#&#39;level&#39;: &#39;DEBUG&#39;, # message level to be written to console</span>
        <span class="p">},</span>
        <span class="s">&#39;syslog-auth&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;logging.handlers.SysLogHandler&#39;</span><span class="p">,</span>
            <span class="s">&#39;facility&#39;</span><span class="p">:</span> <span class="n">SysLogHandler</span><span class="o">.</span><span class="n">LOG_AUTH</span><span class="p">,</span>
            <span class="s">&#39;formatter&#39;</span><span class="p">:</span> <span class="s">&#39;syslog&#39;</span>
        <span class="p">},</span>
        <span class="s">&#39;modoboa&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;modoboa.lib.logutils.SQLHandler&#39;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s">&#39;modoboa.auth&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;syslog-auth&#39;</span><span class="p">,</span> <span class="s">&#39;modoboa&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">},</span>
        <span class="s">&#39;modoboa.admin&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;modoboa&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="postfix-and-dovecot-configuration-update">
<h4>Postfix and Dovecot configuration update<a class="headerlink" href="#postfix-and-dovecot-configuration-update" title="Permalink to this headline">¶</a></h4>
<p>It is necessary to update the queries used to retrieve users and mailboxes:</p>
<ol class="arabic simple">
<li>Run <tt class="docutils literal"><span class="pre">modoboa-admin.py</span> <span class="pre">postfix_maps</span> <span class="pre">--dbtype</span> <span class="pre">&lt;mysql|postgres&gt;</span> <span class="pre">&lt;tempdir&gt;</span></tt> and compare the files with those that postfix currently
use. Make necessary updates in light of the differences</li>
<li>Into <tt class="file docutils literal"><span class="pre">dovecot-sql.conf</span></tt>, update the <tt class="docutils literal"><span class="pre">user_query</span></tt> query, refer to
<a class="reference internal" href="../integration/imap_and_smtp.html#dovecot-mysql-queries"><em>MySQL users</em></a> or <a class="reference internal" href="../integration/imap_and_smtp.html#dovecot-pg-queries"><em>PostgreSQL users</em></a></li>
<li>Update dovecot&#8217;s configuration to activate the new <a class="reference internal" href="../integration/imap_and_smtp.html#dovecot-quota"><em>quota related features</em></a></li>
</ol>
</div>
<div class="section" id="migration-issues">
<h4>Migration issues<a class="headerlink" href="#migration-issues" title="Permalink to this headline">¶</a></h4>
<p>When running the <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">syncdb</span> <span class="pre">--migrate</span></tt> command, you
may encounter the following issues:</p>
<ol class="arabic">
<li><p class="first">Remove useless content types</p>
<p>If the script asks you this question, just reply <strong>no</strong>.</p>
</li>
<li><p class="first">South fails to migrate <tt class="docutils literal"><span class="pre">reversion</span></tt></p>
<p>Due to the admin user model change, the script <tt class="file docutils literal"><span class="pre">0001_initial.py</span></tt>
may fail. Just deactivate <tt class="docutils literal"><span class="pre">reversion</span></tt> from <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> and
run the command again. Once done, reactivate <tt class="docutils literal"><span class="pre">reversion</span></tt> and run
the command one last time.</p>
</li>
</ol>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Upgrading an existing installation</a><ul>
<li><a class="reference internal" href="#latest-version">Latest version</a></li>
<li><a class="reference internal" href="#specific-upgrade-instructions">Specific upgrade instructions</a><ul>
<li><a class="reference internal" href="#manual-learning-for-spamassassin">1.1.7: manual learning for SpamAssassin</a></li>
<li><a class="reference internal" href="#few-bugfixes">1.1.6: Few bugfixes</a></li>
<li><a class="reference internal" href="#audit-trail-issues">1.1.2: Audit trail issues</a></li>
<li><a class="reference internal" href="#id2">1.1.1: Few bugfixes</a></li>
<li><a class="reference internal" href="#relay-domains-and-better-passwords-encryption">1.1.0: relay domains and better passwords encryption</a></li>
<li><a class="reference internal" href="#operations-on-mailboxes">1.0.1: operations on mailboxes</a></li>
<li><a class="reference internal" href="#production-ready-at-last">1.0.0: production ready, at last</a><ul>
<li><a class="reference internal" href="#configuration-file-update">Configuration file update</a></li>
<li><a class="reference internal" href="#postfix-and-dovecot-configuration-update">Postfix and Dovecot configuration update</a></li>
<li><a class="reference internal" href="#migration-issues">Migration issues</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="next chapter">Configuration</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/getting_started/upgrade.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li><a href="../index.html">Modoboa 1.2.0-rc1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Antoine Nguyen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>